/*! cornerstone-tools - 3.0.0-b.0 - 2018-11-26 | (c) 2017 Chris Hafey | https://github.com/cornerstonejs/cornerstoneTools */
!function(e,t){"object"==typeof exports&&"object"==typeof module?module.exports=t():"function"==typeof define&&define.amd?define("cornerstoneTools",[],t):"object"==typeof exports?exports.cornerstoneTools=t():e.cornerstoneTools=t()}(window,function(){return function(e){var t={};function n(a){if(t[a])return t[a].exports;var o=t[a]={i:a,l:!1,exports:{}};return e[a].call(o.exports,o,o.exports,n),o.l=!0,o.exports}return n.m=e,n.c=t,n.d=function(e,t,a){n.o(e,t)||Object.defineProperty(e,t,{configurable:!1,enumerable:!0,get:a})},n.r=function(e){Object.defineProperty(e,"__esModule",{value:!0})},n.n=function(e){var t=e&&e.__esModule?function(){return e.default}:function(){return e};return n.d(t,"a",t),t},n.o=function(e,t){return Object.prototype.hasOwnProperty.call(e,t)},n.p="",n(n.s=10)}([function(e,t){e.exports=function(e){if(void 0===e)throw new ReferenceError("this hasn't been initialised - super() hasn't been called");return e}},function(e,t){e.exports=function(e,t){if(!(e instanceof t))throw new TypeError("Cannot call a class as a function")}},function(e,t){function n(e,t){for(var n=0;n<t.length;n++){var a=t[n];a.enumerable=a.enumerable||!1,a.configurable=!0,"value"in a&&(a.writable=!0),Object.defineProperty(e,a.key,a)}}e.exports=function(e,t,a){return t&&n(e.prototype,t),a&&n(e,a),e}},function(e,t,n){var a=n(16);e.exports=function(e,t){if("function"!=typeof t&&null!==t)throw new TypeError("Super expression must either be null or a function");e.prototype=Object.create(t&&t.prototype,{constructor:{value:e,writable:!0,configurable:!0}}),t&&a(e,t)}},function(e,t){function n(t){return e.exports=n=Object.setPrototypeOf?Object.getPrototypeOf:function(e){return e.__proto__||Object.getPrototypeOf(e)},n(t)}e.exports=n},function(e,t,n){var a=n(6),o=n(0);e.exports=function(e,t){return!t||"object"!==a(t)&&"function"!=typeof t?o(e):t}},function(e,t){function n(e){return(n="function"==typeof Symbol&&"symbol"==typeof Symbol.iterator?function(e){return typeof e}:function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e})(e)}function a(t){return"function"==typeof Symbol&&"symbol"===n(Symbol.iterator)?e.exports=a=function(e){return n(e)}:e.exports=a=function(e){return e&&"function"==typeof Symbol&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":n(e)},a(t)}e.exports=a},function(e,t,n){e.exports=n(12)},function(e,t){function n(e,t,n,a,o,i,r){try{var s=e[i](r),l=s.value}catch(e){return void n(e)}s.done?t(l):Promise.resolve(l).then(a,o)}e.exports=function(e){return function(){var t=this,a=arguments;return new Promise(function(o,i){var r=e.apply(t,a);function s(e){n(r,o,i,s,l,"next",e)}function l(e){n(r,o,i,s,l,"throw",e)}s(void 0)})}}},function(e,t,n){var a=n(15),o=n(14),i=n(13);e.exports=function(e){return a(e)||o(e)||i()}},function(e,t,n){"use strict";n.r(t);var a=n(1),o=n.n(a),i=n(2),r=n.n(i),s=n(5),l=n.n(s),c=n(4),u=n.n(c),d=n(3),h=n.n(d),v=window.cornerstone,g=window.cornerstoneMath,m=window.Hammer,f={set cornerstone(e){v=e},get cornerstone(){return v},set cornerstoneMath(e){g=e},get cornerstoneMath(){return g},set Hammer(e){m=e},get Hammer(){return m}},p=n(6),y=n.n(p),x={MOUSE_DOWN:"cornerstonetoolsmousedown",MOUSE_UP:"cornerstonetoolsmouseup",MOUSE_DOWN_ACTIVATE:"cornerstonetoolsmousedownactivate",MOUSE_DRAG:"cornerstonetoolsmousedrag",MOUSE_MOVE:"cornerstonetoolsmousemove",MOUSE_CLICK:"cornerstonetoolsmouseclick",MOUSE_DOUBLE_CLICK:"cornerstonetoolsmousedoubleclick",MOUSE_WHEEL:"cornerstonetoolsmousewheel",TOUCH_START:"cornerstonetoolstouchstart",TOUCH_START_ACTIVE:"cornerstonetoolstouchstartactive",TOUCH_END:"cornerstonetoolstouchend",TOUCH_DRAG:"cornerstonetoolstouchdrag",TOUCH_DRAG_END:"cornerstonetoolstouchdragend",TOUCH_PINCH:"cornerstonetoolstouchpinch",TOUCH_ROTATE:"cornerstonetoolstouchrotate",TOUCH_PRESS:"cornerstonetoolstouchpress",TAP:"cornerstonetoolstap",DOUBLE_TAP:"cornerstonetoolsdoubletap",MULTI_TOUCH_START:"cornerstonetoolsmultitouchstart",MULTI_TOUCH_START_ACTIVE:"cornerstonetoolsmultitouchstartactive",MULTI_TOUCH_DRAG:"cornerstonetoolsmultitouchdrag",KEY_DOWN:"cornerstonetoolskeydown",KEY_UP:"cornerstonetoolskeyup",KEY_PRESS:"cornerstonetoolskeypress",MEASUREMENT_ADDED:"cornerstonetoolsmeasurementadded",MEASUREMENT_MODIFIED:"cornerstonetoolsmeasurementmodified",MEASUREMENT_REMOVED:"cornerstonetoolsmeasurementremoved",TOOL_DEACTIVATED:"cornerstonetoolstooldeactivated",CLIP_STOPPED:"cornerstonetoolsclipstopped",STACK_SCROLL:"cornerstonetoolsstackscroll"};function T(e,t){var n,a=arguments.length>2&&void 0!==arguments[2]?arguments[2]:null;return"function"==typeof window.CustomEvent?n=new CustomEvent(t,{detail:a,cancelable:!0}):(n=document.createEvent("CustomEvent")).initCustomEvent(t,!0,!0,a),e.dispatchEvent(n)}var b={drawColorId:0,radius:10,minRadius:1,maxRadius:50,alpha:.4,renderBrushIfHiddenButActive:!0,hiddenButActiveAlpha:.2,colorMapId:"BrushColorMap",visibleSegmentations:{},imageBitmapCache:{},segmentationMetadata:{}},E={radius:function(e){b.radius=Math.min(Math.max(e,b.minRadius),b.maxRadius)},brushColorMap:function(e){var t=f.cornerstone.colors.getColormap(b.colorMapId);t.setNumberOfColors(e.length);for(var n=0;n<e.length;n++)t.setColor(n,e[n])},elementVisible:function(e){if(f.cornerstone){var t=f.cornerstone.getEnabledElement(e).uuid,n=f.cornerstone.colors.getColormap(b.colorMapId).getNumberOfColors();b.visibleSegmentations[t]=[];for(var a=0;a<n;a++)b.visibleSegmentations[t].push(!0)}},brushVisibilityForElement:function(e,t){var n=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];b.visibleSegmentations[e]||(b.imageBitmapCache[e]=[]),b.visibleSegmentations[e][t]=n},imageBitmapCacheForElement:function(e,t,n){b.imageBitmapCache[e]||(b.imageBitmapCache[e]=[]),b.imageBitmapCache[e][t]=n},clearImageBitmapCacheForElement:function(e){b.imageBitmapCache[e]=[]},metadata:function(e,t,n){b.segmentationMetadata[e]||(b.segmentationMetadata[e]=[]),b.segmentationMetadata[e][t]=n}};var M={state:b,onRegisterCallback:function(){!function(){var e=f.cornerstone.colors.getColormap(b.colorMapId);e.setNumberOfColors(19);for(var t=0;t<19;t++)t<C.length?e.setColor(t,C[t]):e.setColor(t,I())}()},enabledElementCallback:function(e){E.elementVisible(e)},getters:{imageBitmapCacheForElement:function(e){return b.imageBitmapCache[e]?b.imageBitmapCache[e]:null},visibleSegmentationsForElement:function(e){return b.visibleSegmentations[e]?b.visibleSegmentations[e]:null},metadata:function(e,t){if(b.segmentationMetadata[e])return void 0!==t?b.segmentationMetadata[e][t]:b.segmentationMetadata[e]}},setters:E},C=[[230,25,75,255],[60,180,175,255],[255,225,25,255],[0,130,200,255],[245,130,48,255],[145,30,180,255],[70,240,240,255],[240,50,230,255],[210,245,60,255],[250,190,190,255],[0,128,128,255],[230,190,255,255],[170,110,40,255],[255,250,200,255],[128,0,0,255],[170,255,195,255],[128,128,0,255],[255,215,180,255],[0,0,128,255]],w=0;function I(){for(var e=function(){var e=[w];w<C.length-1?(w++,e.push(w)):(w=0,e.push(w));return e}(),t=Math.random(),n=[],a=0;a<4;a++)n.push(Math.floor(t*C[e[0]][a]+(1-t)*C[e[1]][a]));return n}var k={globalTools:{},globalToolChangeHistory:[],tools:[],isToolLocked:!1,clickProximity:6,touchProximity:10,mousePositionImage:{},enabledElements:[],deleteIfHandleOutsideImage:!0,preventHandleOutsideImage:!1},P={mouseTools:function(){return k.tools.filter(function(e){return e.supportedInteractionTypes.includes("Mouse")})},touchTools:function(){return k.tools.filter(function(e){return e.supportedInteractionTypes.includes("Touch")})},enabledElementByUID:function(e){return k.enabledElements.filter(function(t){return t.uuid===e})}},S={brush:M,globalConfiguration:{state:{mouseEnabled:!0,touchEnabled:!0,globalToolSyncEnabled:!1},setters:{}}},_={modules:S,state:k,getters:P},O=function(e,t){return k.tools.find(function(n){return n.element===e&&n.name===t})},D=function(e,t,n,a){void 0===a&&Array.isArray(n)&&(a=n,n=null);var o=O(e,t);o&&(!function(e,t,n,a){t.supportedInteractionTypes.forEach(function(o){if(void 0===a||a.includes(o)){var i=z[o];i?i(t,e,n):console.warn("Unable to resolve input conflicts for type ".concat(o))}}),_.state.tools.filter(function(t){return t.element===e&&"active"===t.mode&&t.supportedInteractionTypes.length>0}).forEach(function(t){var n=!1;t.supportedInteractionTypes.forEach(function(e){t.options["is".concat(e,"Active")]&&(n=!0)}),n||(console.info("Setting tool ".concat(t.name,"'s to PASSIVE")),R(e,t.name))})}(e,o,n,a),o.supportedInteractionTypes.forEach(function(e){void 0===a||a.includes(e)?n["is".concat(e,"Active")]=!0:n["is".concat(e,"Active")]=!1})),F("active",null,e,t,n)},L=function(e,t,n){W("active",e,t,n),_.state.enabledElements.forEach(function(a){D(a,e,t,n)})},A=F.bind(null,"disabled",null),H=V.bind(null,"disabled",null),U=F.bind(null,"enabled",null),N=V.bind(null,"enabled",null),R=F.bind(null,"passive",x.TOOL_DEACTIVATED),B=V.bind(null,"passive",x.TOOL_DEACTIVATED);function F(e,t,n,a,o){var i=O(n,a);i?(o=G(o),Array.isArray(o.mouseButtonMask)&&0!==o.mouseButtonMask.length&&Array.isArray(i.options.mouseButtonMask)&&(o.mouseButtonMask=o.mouseButtonMask.concat(i.options.mouseButtonMask)),i.mode=e,i.mergeOptions(o),i["".concat(e,"Callback")]&&i["".concat(e,"Callback")](n,o),t&&T(n,t,{options:o,toolName:a,type:t})):console.warn("Unable to find tool '".concat(a,"' for enabledElement"))}function V(e,t,n,a){W(e,n,a),_.state.enabledElements.forEach(function(o){F(e,t,o,n,a)})}function j(e,t,n,a){var o=_.state.tools.find(function(t){return t.element===n&&"active"===t.mode&&!0===t.options["is".concat(e,"Active")]});o&&(console.info("Setting tool ".concat(o.name,"'s is").concat(e,"Active to false")),o.options["is".concat(e,"Active")]=!1)}function W(e,t,n,a){if(_.modules.globalConfiguration.state.globalToolSyncEnabled){var o={mode:e,args:[t,n]};a&&o.push(a),_.state.globalToolChangeHistory.push(o);_.state.globalToolChangeHistory.length>50&&_.state.globalToolChangeHistory.shift();var i=_.state.globalTools[t];if("active"===e){var r=function(e,t,n){void 0===n&&Array.isArray(t)&&(n=t,t=null);var a=[],o=_.state.globalTools[e];if(o){var i=new o.tool(o.configuration);i.supportedInteractionTypes.forEach(function(e){if(void 0===n||n.includes(e))if("Mouse"===e){var o=G(t).mouseButtonMask;Array.isArray(o)&&o.length>0?o.forEach(function(t){return a.push("".concat(e,"-").concat(t))}):Array.isArray(o)&&0===o.length&&a.push("".concat(e,"-DELETE"))}else"MultiTouch"===e?a.push("".concat(e,"-").concat(i.configuration.touchPointers)):a.push(e)})}return a}(t,n,a);Object.keys(_.state.globalTools).forEach(function(e){var t=_.state.globalTools[e];t.activeBindings=t.activeBindings.filter(function(e){return!r.includes(e)})}),r.some(function(e){return e.includes("Mouse-DELETE")})&&(i.activeBindings=i.activeBindings.filter(function(e){return!e.includes("Mouse")}),r=r.filter(function(e){return!e.includes("Mouse")})),i.activeBindings=i.activeBindings.concat(r)}else i.activeBindings=[]}}var z={Mouse:function(e,t,n){var a=G(n).mouseButtonMask;if(Array.isArray(a)&&a.length>0){var o=_.state.tools.find(function(e){return e.element===t&&"active"===e.mode&&!0===e.options.isMouseActive&&Array.isArray(e.options.mouseButtonMask)&&e.options.mouseButtonMask.some(function(e){return a.includes(e)})});o&&(o.options.mouseButtonMask=o.options.mouseButtonMask.filter(function(e){return!a.includes(e)}),0===o.options.mouseButtonMask.length&&(o.options.isMouseActive=!1))}},MouseWheel:j.bind(void 0,"MouseWheel"),Touch:function(e,t,n){var a=_.state.tools.find(function(e){return e.element===t&&"active"===e.mode&&!0===e.options.isTouchActive}),o=_.state.tools.find(function(e){return e.element===t&&"active"===e.mode&&!0===e.options.isMultiTouchActive&&1===e.configuration.touchPointers});a&&(console.info("Setting tool ".concat(a.name,"'s isTouchActive to false")),a.options.isTouchActive=!1),o&&(console.info("Setting tool ".concat(o.name,"'s isTouchActive to false")),o.options.isMultiTouchActive=!1)},TouchPinch:j.bind(void 0,"TouchPinch"),TouchRotate:j.bind(void 0,"TouchRotate"),DoubleTap:j.bind(void 0,"DoubleTap"),MultiTouch:function(e,t,n){var a,o=_.state.tools.find(function(n){return n.element===t&&"active"===n.mode&&!0===n.options.isMultiTouchActive&&n.configuration.touchPointers===e.configuration.touchPointers});1===e.configuration.touchPointers&&(a=_.state.tools.find(function(e){return e.element===t&&"active"===e.mode&&!0===e.options.isTouchActive})),o&&(console.info("Setting tool ".concat(o.name,"'s isMultiTouchActive to false")),o.options.isMultiTouchActive=!1),a&&(console.info("Setting tool ".concat(a.name,"'s isTouchActive to false")),a.options.isTouchActive=!1)}};function G(e){if(e!==Object(e)||Array.isArray(e))if("number"==typeof e){var t=[];t.push(e),e={mouseButtonMask:0===e?[]:t}}else null===e?e={mouseButtonMask:[]}:(console.info("No options provided when changing tool mode"),e={});else if(0===e.mouseButtonMask||null===e.mouseButtonMask)e.mouseButtonMask=[];else if("number"==typeof e.mouseButtonMask){var n=[];n.push(e.mouseButtonMask),e.mouseButtonMask=n}return e}var q={activeOrDisabledBinaryTool:{passiveCallback:function(e){A(e,this.name)},enabledCallback:function(e){D(e,this.name)}},enabledOrDisabledBinaryTool:{passiveCallback:function(e){A(e,this.name)},activeCallback:function(e){U(e,this.name)}}},Y=function(){function e(){var t=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{},n=t.name,a=t.strategies,i=t.defaultStrategy,r=t.configuration,s=t.supportedInteractionTypes,l=t.mixins;o()(this,e),this.name=n,this.mode="disabled",this.element=void 0,this.supportedInteractionTypes=s||[],this.strategies=a||{},this.defaultStrategy=i||Object.keys(this.strategies)[0]||void 0,this.activeStrategy=this.defaultStrategy,this._options={},this._configuration=Object.assign({},r),this.hasCursor=!1,l&&l.length&&this._applyMixins(l)}return r()(e,[{key:"mergeOptions",value:function(e){this._options=Object.assign({},this._options,e)}},{key:"clearOptions",value:function(){this._options={}}},{key:"applyActiveStrategy",value:function(e){return this.strategies[this.activeStrategy](e,this.configuration)}},{key:"_applyMixins",value:function(e){for(var t=0;t<e.length;t++){var n=q["".concat(e[t])];"object"===y()(n)?Object.assign(this,n):console.warn("".concat(this.name,": mixin ").concat(q[t]," does not exist."))}}},{key:"configuration",get:function(){return this._configuration},set:function(e){this._configuration=e}},{key:"options",get:function(){return this._options}}],[{key:"configuration",get:function(){}}]),e}();function K(){var e={};return{get:function(t,n){var a=f.cornerstone.getEnabledElement(t);if(a.image&&!1!==e.hasOwnProperty(a.image.imageId)){var o=e[a.image.imageId];if(!1!==o.hasOwnProperty(n))return o[n]}},add:function(t,n,a){var o=f.cornerstone.getEnabledElement(t);o.image&&!1!==e.hasOwnProperty(o.image.imageId)||(e[o.image.imageId]={});var i=e[o.image.imageId];!1===i.hasOwnProperty(n)&&(i[n]={data:[]}),i[n].data.push(a)},clear:function(t){var n=f.cornerstone.getEnabledElement(t);n.image&&!1!==e.hasOwnProperty(n.image.imageId)&&delete e[n.image.imageId]},saveImageIdToolState:function(t){return e[t]},restoreImageIdToolState:function(t,n){e[t]=n},saveToolState:function(){return e},restoreToolState:function(t){e=t},toolState:e}}var X=K();function Z(e){var t=f.cornerstone.getEnabledElement(e);return void 0===t.toolStateManager&&(t.toolStateManager=X),t.toolStateManager}function J(e,t,n){Z(e).add(e,t,n),T(e,x.MEASUREMENT_ADDED,{toolType:t,element:e,measurementData:n})}function Q(e,t){return Z(e).get(e,t)}function $(e,t,n){for(var a=Z(e).get(e,t),o=-1,i=0;i<a.data.length;i++)a.data[i]===n&&(o=i);-1!==o&&(a.data.splice(o,1),T(e,x.MEASUREMENT_REMOVED,{toolType:t,element:e,measurementData:n}))}function ee(e,t){var n=Z(e).get(e,t);void 0!==n&&(n.data=[])}function te(e,t){f.cornerstone.getEnabledElement(e).toolStateManager=t}var ne=function(e,t){if(e.boundingBox)return f.cornerstoneMath.point.insideRect(t,e.boundingBox)},ae=function(e,t,n,a){if(e.hasOwnProperty("pointNearHandle")){if(e.pointNearHandle(t,e,n))return!0}else if(!0===e.hasBoundingBox){if(ne(e,n))return!0}else{var o=f.cornerstone.pixelToCanvas(t,e);if(f.cornerstoneMath.point.distance(o,n)<=a)return!0}return!1},oe=function e(t,n,a,o){var i;if(n){if(Array.isArray(n))for(var r=Object.keys(n),s=0;s<r.length;s++){var l=n[r[s]];if(l.hasOwnProperty("x")&&l.hasOwnProperty("y")&&ae(l,t,a,o)){i=l;break}}else if("object"===y()(n))for(var c=Object.keys(n),u=0;u<c.length;u++){var d=c[u];if(Array.isArray(n[d])){if(i=e(t,n[d],a,o))break}else{var h=n[d];if(ae(h,t,a,o)){i=h;break}}}return i}},ie=function(e,t,n,a){a||(a=6);var o=function(e){var t;return Object.keys(e).forEach(function(n){var a=e[n];!0!==a.active||(t=a)}),t}(t),i=oe(e,t,n,a);return o!==i&&(void 0!==i&&(i.active=!0),void 0!==o&&(o.active=!1),!0)};var re=function(e,t){var n=e.image,a={left:0,top:0,width:n.width,height:n.height},o=!1;return Object.keys(t).forEach(function(e){var n=t[e];!0!==n.allowedOutsideImage&&!1===f.cornerstoneMath.point.insideRect(n,a)&&(o=!0)}),o};function se(e,t,n){return Math.min(Math.max(t,e),n)}function le(e,t){e.x=se(e.x,0,t.width),e.y=se(e.y,0,t.height)}var ce={mouse:[x.MOUSE_DRAG],touch:[x.TOUCH_DRAG]},ue={mouse:[x.MOUSE_UP,x.MOUSE_CLICK],touch:[x.TOUCH_END,x.TOUCH_DRAG_END,x.TOUCH_PINCH,x.TOUCH_PRESS,x.TAP]},de=function(e,t,n){var a=e.element,o=(arguments.length>3&&void 0!==arguments[3]&&arguments[3],arguments.length>4&&void 0!==arguments[4]?arguments[4]:{}),i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"mouse";o=Object.assign({deleteIfHandleOutsideImage:k.deleteIfHandleOutsideImage,preventHandleOutsideImage:k.preventHandleOutsideImage},o);var r=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=arguments.length>3?arguments[3]:void 0,o=a.detail,i=o.element,r=o.image,s=a.detail.deltaPoints.image,l=s.x,c=s.y;t.active=!0;for(var u=Object.keys(t.handles),d=0;d<u.length;d++){var h=u[d],v=t.handles[h];!0!==v.movesIndependently&&v.hasOwnProperty("x")&&v.hasOwnProperty("y")&&(v.x+=l,v.y+=c,n.preventHandleOutsideImage&&le(v,r))}f.cornerstone.updateImage(i);var g=x.MEASUREMENT_MODIFIED;T(i,g,{toolName:e,element:i,measurementData:t}),a.preventDefault(),a.stopPropagation()}.bind(this,t,n,o),s=function e(a){!function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:{},a=arguments.length>3?arguments[3]:void 0,o=arguments.length>4?arguments[4]:void 0,i=o.dragHandler,r=o.upOrEndHandler,s=arguments.length>5?arguments[5]:void 0,l=s.detail,c=s.detail.element;t.active=!1,t.invalidated=!0,k.isToolLocked=!1,ce[a].forEach(function(e){c.removeEventListener(e,i)}),ue[a].forEach(function(e){c.removeEventListener(e,r)}),n.deleteIfHandleOutsideImage&&re(l,t.handles)&&$(c,e,t);"function"==typeof n.doneMovingCallback&&n.doneMovingCallback();f.cornerstone.updateImage(c)}(t,n,o,i,{dragHandler:r,upOrEndHandler:e},a)};n.active=!0,k.isToolLocked=!0,ce[i].forEach(function(e){a.addEventListener(e,r)}),ue[i].forEach(function(e){a.addEventListener(e,s)})};var he={value:!1},ve={mouse:[x.MOUSE_DRAG],touch:[x.TOUCH_DRAG]},ge={mouse:[x.MOUSE_UP,x.MOUSE_CLICK],touch:[x.TOUCH_END,x.TOUCH_DRAG_END,x.TOUCH_PINCH,x.TOUCH_PRESS,x.TAP]},me=function(e,t,n,a){var o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"mouse";o=Object.assign({deleteIfHandleOutsideImage:k.deleteIfHandleOutsideImage,preventHandleOutsideImage:k.preventHandleOutsideImage},o);var r=e.element,s=function(e,t,n,a,o,i){var r=i.detail,s=r.image,l=r.currentPoints,c=r.element,u=l.page,d=f.cornerstone.pageToPixel(c,u.x,"touch"===o?u.y+-57:u.y);!1===n.hasMoved&&(n.hasMoved=!0);he.value=!1,n.active=!0,n.x=d.x,n.y=d.y,a.preventHandleOutsideImage&&le(n,s);f.cornerstone.updateImage(c);var h=x.MEASUREMENT_MODIFIED;T(c,h,{toolName:e,element:c,measurementData:t})}.bind(this,t,n,a,o,i),l=function r(l){!function(e,t,n,a){var o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:{},i=arguments.length>5?arguments[5]:void 0,r=arguments.length>6?arguments[6]:void 0,s=r.dragHandler,l=r.upOrEndHandler,c=arguments.length>7?arguments[7]:void 0,u=t.currentPoints.image,d=c.detail.element;a.active=!1,n.active=!1,n.invalidated=!0,k.isToolLocked=!1,he.value=!1,ve[i].forEach(function(e){d.removeEventListener(e,s)}),ge[i].forEach(function(e){d.removeEventListener(e,l)}),o.deleteIfHandleOutsideImage&&re(t,n.handles)&&$(d,e,n);c.type===x.TOUCH_PRESS&&(c.detail.handlePressed=n,a.x=u.x,a.y=u.y);"function"==typeof o.doneMovingCallback&&o.doneMovingCallback();f.cornerstone.updateImage(d)}(t,e,n,a,o,i,{dragHandler:s,upOrEndHandler:r},l)};if(a.active=!0,n.active=!0,k.isToolLocked=!0,ve[i].forEach(function(e){r.addEventListener(e,s)}),ge[i].forEach(function(e){r.addEventListener(e,l)}),"touch"===i){he.value=!0;var c=f.cornerstone.getEnabledElement(r),u={x:e.currentPoints.page.x,y:e.currentPoints.page.y+-57},d=f.cornerstone.pageToPixel(r,u.x,u.y);!function e(t,n,a,o){if(!n.value)return;var i=Math.abs(t.y-o.y);var r=i/10;if(i<1)return t.y=o.y,void(n.value=!1);t.y>o.y?t.y-=r:t.y<o.y&&(t.y+=r);f.cornerstone.updateImage(a.element);f.cornerstone.requestAnimationFrame(function(){e(t,n,a,o)})}(a,he,c,d)}};var fe={mouse:[x.MOUSE_MOVE,x.MOUSE_DRAG],touch:[x.TOUCH_DRAG]},pe={mouse:[x.MOUSE_UP,x.MOUSE_CLICK],touch:[x.TOUCH_END,x.TOUCH_PINCH,x.TAP]},ye=function(e,t,n,a,o){var i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"mouse";o=Object.assign({deleteIfHandleOutsideImage:k.deleteIfHandleOutsideImage,preventHandleOutsideImage:k.preventHandleOutsideImage},o);var r=e.element;k.isToolLocked=!0,a.active=!0,n.active=!0;var s=function(e,t,n,a,o,i){var r=i.detail,s=r.currentPoints,l=r.image,c=r.element,u=s.page,d=f.cornerstone.pageToPixel(c,"touch"===o?u.x+-57:u.x,"touch"===o?u.y+-57:u.y);n.active=!0,n.x=d.x,n.y=d.y,a&&a.preventHandleOutsideImage&&le(n,l);f.cornerstone.updateImage(c);var h=x.MEASUREMENT_MODIFIED;T(c,h,{toolName:e,element:c,measurementData:t})}.bind(this,t,n,a,o,i),l=function e(r){!function(e,t,n,a,o,i,r){var s=i.moveHandler,l=i.moveEndHandler,c=r.detail,u=c.element,d=c.currentPoints.page,h=f.cornerstone.pageToPixel(u,"touch"===o?d.x+-57:d.x,"touch"===o?d.y+-57:d.y);if(n.active=!1,t.active=!1,k.isToolLocked=!1,n.x=h.x,n.y=h.y,fe[o].forEach(function(e){u.removeEventListener(e,s)}),pe[o].forEach(function(e){u.removeEventListener(e,l)}),u.removeEventListener(x.TOUCH_START,xe),r.type===x.TOUCH_PINCH||r.type===x.TOUCH_PRESS)return n.active=!1,f.cornerstone.updateImage(u),void("function"==typeof a.doneMovingCallback&&a.doneMovingCallback());a.preventHandleOutsideImage&&le(n,r.detail.image);a.deleteIfHandleOutsideImage&&re(r.detail,t.handles)&&$(u,e,t);"function"==typeof a.doneMovingCallback&&a.doneMovingCallback();f.cornerstone.updateImage(u)}(t,n,a,o,i,{moveHandler:s,moveEndHandler:e},r)};fe[i].forEach(function(e){r.addEventListener(e,s)}),pe[i].forEach(function(e){r.addEventListener(e,l)}),r.addEventListener(x.TOUCH_START,xe)};function xe(e){return e.stopImmediatePropagation(),!1}var Te=function(e,t,n,a,o){n.active=!0,k.isToolLocked=!0,me(e.detail,t.name,n,a,t.options,o),e.stopImmediatePropagation(),e.stopPropagation(),e.preventDefault()},be=function(e,t,n,a){for(var o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"mouse",i=0;i<t.data.length;i++){var r=t.data[i],s=oe(e,r.handles,a,"mouse"===o?k.clickProximity:k.touchProximity);if(s)return{handle:s,data:r}}},Ee=function(e,t,n){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"mouse",o=Object.assign({},{doneMovingCallback:function(){n.active=!1,k.isToolLocked=!1}},t.options);n.active=!0,k.isToolLocked=!0,de(e.detail,t.name,n,null,o,a),e.stopImmediatePropagation(),e.stopPropagation(),e.preventDefault()},Me=function(e){function t(e){var n=e.name,a=e.strategies,i=e.defaultStrategy,r=e.configuration,s=e.supportedInteractionTypes,c=e.mixins;return o()(this,t),l()(this,u()(t).call(this,{name:n,strategies:a,defaultStrategy:i,configuration:r,supportedInteractionTypes:s,mixins:c}))}return h()(t,e),r()(t,[{key:"createNewMeasurement",value:function(e){throw new Error("Method createNewMeasurement not implemented for ".concat(this.name,"."))}},{key:"pointNearTool",value:function(e,t,n){arguments.length>3&&void 0!==arguments[3]&&arguments[3];throw new Error("Method pointNearTool not implemented for ".concat(this.name,"."))}},{key:"distanceFromPoint",value:function(e,t,n){throw new Error("Method distanceFromPoint not implemented for ".concat(this.name,"."))}},{key:"renderToolData",value:function(e){throw new Error("renderToolData not implemented for ".concat(this.name,"."))}},{key:"mouseMoveCallback",value:function(e){for(var t=e.detail,n=t.element,a=t.currentPoints.canvas,o=Q(n,this.name),i=!1,r=0;r<o.data.length;r++){var s=o.data[r];!0===ie(n,s.handles,a)&&(i=!0);var l=this.pointNearTool(n,s,a)&&!s.active,c=!this.pointNearTool(n,s,a)&&s.active;(l||c)&&(s.active=!s.active,i=!0)}return i}},{key:"handleSelectedCallback",value:function(e,t,n){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"mouse";Te(e,this,t,n,a)}},{key:"toolSelectedCallback",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"mouse";Ee(e,this,t,n)}}]),t}(Y),Ce=1,we=2;var Ie={setToolWidth:function(e){Ce=e},getToolWidth:function(){return Ce},setActiveWidth:function(e){we=e},getActiveWidth:function(){return we}},ke="white",Pe="greenyellow",Se="transparent";var _e={setFillColor:function(e){Se=e},getFillColor:function(){return Se},setToolColor:function(e){ke=e},getToolColor:function(){return ke},setActiveColor:function(e){Pe=e},getActiveColor:function(){return Pe},getColorIfActive:function(e){return e.color?e.color:e.active?Pe:ke}},Oe=function(e,t){e.save(),t(e),e.restore()},De=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{},n=arguments.length>2?arguments[2]:void 0,a=t.color,o=t.lineWidth,i=t.fillStyle,r=t.lineDash;e.beginPath(),e.strokeStyle=a||e.strokeStyle,e.lineWidth=o||void 0===o&&Ie.getToolWidth()||e.lineWidth,r&&e.setLineDash(r),n(e),i&&(e.fillStyle=i,e.fill()),e.stroke(),r&&e.setLineDash([])};function Le(e,t,n,a,o){var i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"pixel";De(e,o,function(e){"pixel"===i&&(n=f.cornerstone.pixelToCanvas(t,n),a=f.cornerstone.pixelToCanvas(t,a)),e.moveTo(n.x,n.y),e.lineTo(a.x,a.y)})}var Ae=function(e,t,n,a,o){var i=arguments.length>5&&void 0!==arguments[5]?arguments[5]:"pixel";De(e,o,function(e){"pixel"===i&&(n=f.cornerstone.pixelToCanvas(t,n),a=a.map(function(e){return f.cornerstone.pixelToCanvas(t,e)})),e.moveTo(n.x,n.y),a.forEach(function(t){var n=t.x,a=t.y;e.lineTo(n,a)})})},He=function(e,t,n,a,o){var i=Math.atan2(n.y-t.y,n.x-t.x),r={color:a,lineWidth:o};Le(e,void 0,t,n,r,"canvas"),r={color:a,lineWidth:o,fillStyle:a};var s=[{x:n.x-10*Math.cos(i-Math.PI/7),y:n.y-10*Math.sin(i-Math.PI/7)},{x:n.x-10*Math.cos(i+Math.PI/7),y:n.y-10*Math.sin(i+Math.PI/7)},n];Ae(e,void 0,n,s,r,"canvas")},Ue=function(e,t,n,a,o){"pixel"===(arguments.length>5&&void 0!==arguments[5]?arguments[5]:"pixel")&&(n=f.cornerstone.pixelToCanvas(t,n)),De(e,o,function(e){e.arc(n.x,n.y,a,0,2*Math.PI)})},Ne=function(e,t,n,a,o){"pixel"===(arguments.length>5&&void 0!==arguments[5]?arguments[5]:"pixel")&&(n=f.cornerstone.pixelToCanvas(t,n),a=f.cornerstone.pixelToCanvas(t,a));var i=Math.min(n.x,a.x),r=Math.min(n.y,a.y),s=Math.abs(n.x-a.x),l=Math.abs(n.y-a.y),c=s/2*.5522848,u=l/2*.5522848,d=i+s,h=r+l,v=i+s/2,g=r+l/2;De(e,o,function(e){e.moveTo(i,g),e.bezierCurveTo(i,g-u,v-c,r,v,r),e.bezierCurveTo(v+c,r,d,g-u,d,g),e.bezierCurveTo(d,g+u,v+c,h,v,h),e.bezierCurveTo(v-c,h,i,g+u,i,g),e.closePath()})},Re=6,Be=function(e,t,n,a,o){e.strokeStyle=a,Object.keys(n).forEach(function(a){var i=n[a];if(!0!==i.drawnIndependently&&(!o||!0!==o.drawHandlesIfActive||i.active)){var r=i.active?Ie.getActiveWidth():Ie.getToolWidth(),s=o&&o.fill;De(e,{lineWidth:r,fillStyle:s},function(e){var n=f.cornerstone.pixelToCanvas(t.element,i),a=function(e){var t;t=e&&e.handleRadius?e.handleRadius:Re;return t}(o);e.arc(n.x,n.y,a,0,2*Math.PI)})}})};var Fe=function(e,t,n,a,o,i){var r=e.length>0?f.cornerstoneMath.point.findClosestPoint(e,t):t,s=[{x:n.left+n.width/2,y:n.top},{x:n.left,y:n.top+n.height/2},{x:n.left+n.width/2,y:n.top+n.height},{x:n.left+n.width,y:n.top+n.height/2}];Le(a,void 0,r,f.cornerstoneMath.point.findClosestPoint(s,r),{color:o,lineWidth:i,lineDash:[2,3]},"canvas")},Ve=15,je="".concat(Ve,"px Arial"),We="transparent";var ze={setFont:function(e){je=e},getFont:function(){return je},setFontSize:function(e){Ve=e},getFontSize:function(){return Ve},setBackgroundColor:function(e){We=e},getBackgroundColor:function(){return We}},Ge=function(e,t,n,a,o){var i=ze.getFontSize();e.font=ze.getFont(),e.textBaseline="top",e.fillStyle=a,n.forEach(function(n,a){e.fillText(n,t.left+o,t.top+o+a*(i+o))})},qe=function(e,t,n){e.fillStyle=n,e.fillRect(t.left,t.top,t.width,t.height)};function Ye(e,t,n){var a=ze.getFont(),o=e.font;a&&a!==o&&(e.font=a);var i=e.measureText(t).width;return a&&a!==o&&(e.font=o),i+2*n}var Ke=function(e,t,n,a,o,i){"[object Array]"!==Object.prototype.toString.call(t)&&(t=[t]);var r=ze.getFontSize(),s=ze.getBackgroundColor(),l=0;t.forEach(function(t){var n=Ye(e,t,5);l=Math.max(l,n)});var c={width:l,height:5+t.length*(r+5)};return Oe(e,function(e){e.strokeStyle=o,i&&i.centering&&!0===i.centering.x&&(n-=c.width/2),i&&i.centering&&!0===i.centering.y&&(a-=c.height/2),c.left=n,c.top=a;var r=i&&!0===i.debug?"#FF0000":s;qe(e,c,r),Ge(e,c,t,o,5)}),c},Xe=function(e,t,n,a,o,i,r,s,l,c){var u=f.cornerstone,d=u.pixelToCanvas(t,n);l&&(d.x+=l);var h={centering:{x:!1,y:c}};if(n.boundingBox=Ke(e,a,d.x,d.y,r,h),n.hasMoved){var v=i(o).map(function(e){return u.pixelToCanvas(t,e)});Fe(v,d,n.boundingBox,e,r,s)}},Ze=function(e,t,n,a,o){if("pixel"===(arguments.length>5&&void 0!==arguments[5]?arguments[5]:"pixel")){var i=f.cornerstone;n=i.pixelToCanvas(t,n),a=i.pixelToCanvas(t,a)}var r=Math.min(n.x,a.x),s=Math.min(n.y,a.y),l=Math.abs(n.x-a.x),c=Math.abs(n.y-a.y);De(e,o,function(e){e.rect(r,s,l,c)})},Je=function(e){var t=e.getContext("2d");return t.setTransform(1,0,0,1,0,0),t},Qe=function(e,t){return void 0===e?t:e},$e=function(e){var t=arguments.length>1&&void 0!==arguments[1]?arguments[1]:{};t.shadow&&(e.shadowColor=Qe(t.shadowColor,"#000000"),e.shadowBlur=Qe(t.shadowBlur,0),e.shadowOffsetX=Qe(t.shadowOffsetX,1),e.shadowOffsetY=Qe(t.shadowOffsetY,1))},et=function(e,t,n,a){var o=f.cornerstone,i={start:o.pixelToCanvas(e,t),end:o.pixelToCanvas(e,n)};return f.cornerstoneMath.lineSegment.distanceToPoint(i,a)},tt=function(e,t){var n=Math.pow(10,t);return Math.round(e*n)/n};function nt(e){return Math.sqrt(Math.pow(e.x,2)+Math.pow(e.y,2))}var at=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};o()(this,t);var a=Object.assign({name:"Angle",supportedInteractionTypes:["Mouse","Touch"]},n);return(e=l()(this,u()(t).call(this,a))).initialConfiguration=a,e.preventNewMeasurement=!1,e}return h()(t,e),r()(t,[{key:"createNewMeasurement",value:function(e){return{visible:!0,active:!0,color:void 0,handles:{start:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!1},middle:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!0},end:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!1},textBox:{active:!1,hasMoved:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0}}}}},{key:"pointNearTool",value:function(e,t,n){return!1!==t.visible&&(et(e,t.handles.start,t.handles.middle,n)<25||et(e,t.handles.middle,t.handles.end,n)<25)}},{key:"renderToolData",value:function(e){var t=e.detail,n=t.enabledElement,a=Q(e.currentTarget,this.name);if(a)for(var o=Je(t.canvasContext.canvas),i=Ie.getToolWidth(),r=this.configuration,s=function(e){var s=a.data[e];if(!1===s.visible)return"continue";Oe(o,function(e){$e(e,r);var a=_e.getColorIfActive(s),o=f.cornerstone.pixelToCanvas(t.element,s.handles.start),l=f.cornerstone.pixelToCanvas(t.element,s.handles.middle);Ae(e,t.element,s.handles.start,[s.handles.middle,s.handles.end],{color:a});var u={drawHandlesIfActive:r&&r.drawHandlesOnHover};Be(e,t,s.handles,a,u);var d=t.image.columnPixelSpacing||1,h=t.image.rowPixelSpacing||1,v={x:(s.handles.middle.x-s.handles.start.x)*d,y:(s.handles.middle.y-s.handles.start.y)*h},g={x:(s.handles.end.x-s.handles.middle.x)*d,y:(s.handles.end.y-s.handles.middle.y)*h},m={x:(s.handles.end.x-s.handles.start.x)*d,y:(s.handles.end.y-s.handles.start.y)*h},p=nt(v),y=nt(g),x=nt(m),T=Math.acos((Math.pow(p,2)+Math.pow(y,2)-Math.pow(x,2))/(2*p*y));if(T*=180/Math.PI,s.rAngle=tt(T,2),s.rAngle){var b,E=function(e,t,n){var a=t&&n?"":" (isotropic)";return e.rAngle.toString()+String.fromCharCode(parseInt("00B0",16))+a}(s,t.image.rowPixelSpacing,t.image.columnPixelSpacing);if(!s.handles.textBox.hasMoved){b={x:l.x,y:l.y};var M=Ye(e,E,5);l.x<o.x?b.x-=15+M+10:b.x+=15;var C=f.cornerstone.internal.getTransform(n);C.invert();var w=C.transformPoint(b.x,b.y);s.handles.textBox.x=w.x,s.handles.textBox.y=w.y}Xe(e,t.element,s.handles.textBox,E,s.handles,c,a,i,0,!0)}})},l=0;l<a.data.length;l++)s(l);function c(e){return[e.start,e.middle,e.end]}}},{key:"addNewMeasurement",value:function(e,t){var n=this;if(!this.preventNewMeasurement){this.preventNewMeasurement=!0,e.preventDefault(),e.stopPropagation();var a=e.detail,o=this.createNewMeasurement(a),i=e.detail.element;J(i,this.name,o),f.cornerstone.updateImage(i);var r=Object.assign({},{doneMovingCallback:function(){o.active=!1,n.preventNewMeasurement=!1,f.cornerstone.updateImage(i)}},this.options),s=Object.assign({},{doneMovingCallback:function(){o.active=!1,o.handles.end.active=!0,f.cornerstone.updateImage(i),ye(a,n.name,o,o.handles.end,r,t)}},this.options);ye(a,this.name,o,o.handles.middle,s,t)}}}]),t}(Me),ot=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};o()(this,t);var a={name:"ArrowAnnotate",supportedInteractionTypes:["Mouse","Touch"],configuration:{getTextCallback:it,changeTextCallback:rt,drawHandles:!1,drawHandlesOnHover:!0,arrowFirst:!0}},i=Object.assign(a,n);return(e=l()(this,u()(t).call(this,i))).initialConfiguration=i,e.preventNewMeasurement=!1,e}return h()(t,e),r()(t,[{key:"createNewMeasurement",value:function(e){return{visible:!0,active:!0,color:void 0,handles:{start:{x:e.detail.currentPoints.image.x,y:e.detail.currentPoints.image.y,highlight:!0,active:!1},end:{x:e.detail.currentPoints.image.x,y:e.detail.currentPoints.image.y,highlight:!0,active:!1},textBox:{active:!1,hasMoved:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0}}}}},{key:"pointNearTool",value:function(e,t,n){return!1!==t.visible&&et(e,t.handles.start,t.handles.end,n)<25}},{key:"renderToolData",value:function(e){var t=this,n=e.detail,a=n.element,o=n.enabledElement,i=Q(a,this.name);if(i)for(var r=e.detail.canvasContext.canvas,s=Je(r),l=Ie.getToolWidth(),c=function(n){var r=i.data[n];if(!1===r.visible)return"continue";Oe(s,function(n){$e(n,t.configuration);var i=_e.getColorIfActive(r),s=f.cornerstone.pixelToCanvas(a,r.handles.start),c=f.cornerstone.pixelToCanvas(a,r.handles.end);t.configuration.arrowFirst?He(n,c,s,i,l):He(n,s,c,i,l);var u={drawHandlesIfActive:t.configuration.drawHandlesOnHover};t.configuration.drawHandles&&Be(n,e.detail,r.handles,i,u);var h=function(e){return e.text}(r);if(h&&""!==h){var v=Ye(n,h,5),g=ze.getFontSize()+10,m=Math.max(v,g)/2+5;if(c.x<s.x&&(m=-m),!r.handles.textBox.hasMoved){var p;p=t.configuration.arrowFirst?{x:c.x-v/2+m,y:c.y-g/2}:{x:s.x-v/2-m,y:s.y-g/2};var y=f.cornerstone.internal.getTransform(o);y.invert();var x=y.transformPoint(p.x,p.y);r.handles.textBox.x=x.x,r.handles.textBox.y=x.y}Xe(n,a,r.handles.textBox,h,r.handles,d,i,l,0,!1)}})},u=0;u<i.data.length;u++)c(u);function d(e){var t={x:(e.start.x+e.end.x)/2,y:(e.start.y+e.end.y)/2};return[e.start,t,e.end]}}},{key:"addNewMeasurement",value:function(e,t){var n=this,a=e.detail.element,o=this.createNewMeasurement(e);J(a,this.name,o),f.cornerstone.updateImage(a);var i=Object.assign({},{doneMovingCallback:function(){void 0===o.text&&n.configuration.getTextCallback(function(e){e?o.text=e:$(a,n.name,o),o.active=!1,f.cornerstone.updateImage(a)}),f.cornerstone.updateImage(a)}},this.options);ye(e.detail,this.name,o,o.handles.end,i,t)}},{key:"doubleClickCallback",value:function(e){if(Array.isArray(this.options.mouseButtonMask)&&this.options.mouseButtonMask.includes(e.detail.buttons))return this._updateTextForNearbyAnnotation(e)}},{key:"touchPressCallback",value:function(e){return this._updateTextForNearbyAnnotation(e)}},{key:"_updateTextForNearbyAnnotation",value:function(e){var t=e.detail.element,n=e.detail.currentPoints.canvas,a=Q(t,this.name);if(!a)return!1;for(var o=0;o<a.data.length;o++){var i=a.data[o];if(this.pointNearTool(t,i,n)||ne(i.handles.textBox,n))return i.active=!0,f.cornerstone.updateImage(t),this.configuration.changeTextCallback(i,e.detail,this._doneChangingTextCallback.bind(this,t,i)),e.stopImmediatePropagation(),e.preventDefault(),e.stopPropagation(),!0}}},{key:"_doneChangingTextCallback",value:function(e,t,n,a){!0===a?$(e,this.name,t):t.text=n,t.active=!1,f.cornerstone.updateImage(e)}}]),t}(Me);function it(e){e(prompt("Enter your annotation:"))}function rt(e,t,n){n(prompt("Change your annotation:"))}var st,lt=n(0),ct=n.n(lt),ut=function(e,t,n){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:{};return Object.assign({x:e,y:t,index:n,drawnIndependently:!1,allowedOutsideImage:!1,highlight:!0,active:!1},a)},dt=function(e){var t=e.currentPoints.image,n=t.x,a=t.y;return{toolType:this.name,isCreating:!0,visible:!0,active:!0,handles:{start:ut(n,a,0),end:ut(n,a,1,{active:!0}),perpendicularStart:ut(n,a,2,{locked:!0}),perpendicularEnd:ut(n,a,3),textBox:ut(n-50,a-70,null,{highlight:!1,hasMoved:!0,active:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0})},longestDiameter:0,shortestDiameter:0}},ht=function(e,t,n){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"mouse",o=f.cornerstone,i=f.cornerstoneMath,r=t.handles,s={start:o.pixelToCanvas(e,r.start),end:o.pixelToCanvas(e,r.end)},l=i.lineSegment.distanceToPoint(s,n);if(ne(r.textBox,n))return!0;var c="mouse"===a?k.clickProximity:k.touchProximity;return!!function(e,t,n,a){var o=f.cornerstone,i=f.cornerstoneMath,r={start:o.pixelToCanvas(e,t.perpendicularStart),end:o.pixelToCanvas(e,t.perpendicularEnd)};return i.lineSegment.distanceToPoint(r,n)<a}(e,r,n,c)||l<c},vt=function(e){var t=e.detail,n=t.element,a=t.canvasContext,o=t.image,i=Q(n,this.name);if(i){var r=f.cornerstone.metaData.get("imagePlaneModule",o.imageId),s=o.rowPixelSpacing,l=o.columnPixelSpacing;if(r&&(s=r.rowPixelSpacing||r.rowImagePixelSpacing,l=r.columnPixelSpacing||r.colImagePixelSpacing),s&&l)for(var c,u=Je(a.canvas),d=_e.getActiveColor(),h=Ie.getToolWidth(),v=this.configuration,g=function(e){var a=i.data[e];if(!1===a.visible)return"continue";c=a.active?d:_e.getToolColor(),gt(a,s,l),Oe(u,function(e){$e(e,v);var o=a.handles,i=o.start,r=o.end,u=o.perpendicularStart,d=o.perpendicularEnd,g=o.textBox;Le(e,n,i,r,{color:c});var m=h;!function(e,t){if(t.handles.perpendicularStart.locked){var n,a,o,i,r=t.handles,s=r.start,l=r.end;if(s.x===l.x&&s.y===l.y)n=s.x,a=s.y,o=l.x,i=l.y;else{var c={x:(s.x+l.x)/2,y:(s.y+l.y)/2},u=(s.x-l.x)*(e.image.columnPixelSpacing||1),d=(s.y-l.y)*(e.image.rowPixelSpacing||1),h=Math.sqrt(u*u+d*d),v=(s.x-l.x)/h,g=(s.y-l.y)/h,m=h/2;n=c.x+m/2*g,a=c.y-m/2*v,o=c.x-m/2*g,i=c.y+m/2*v}t.handles.perpendicularStart.x=n,t.handles.perpendicularStart.y=a,t.handles.perpendicularEnd.x=o,t.handles.perpendicularEnd.y=i}}(t,a),Le(e,n,u,d,{color:c,strokeWidth:m});var f={drawHandlesIfActive:v&&v.drawHandlesOnHover};Be(e,t,a.handles,c,f);var p=mt(a,s,l);a.additionalData&&Array.isArray(a.additionalData)&&(p=a.additionalData.concat(p)),Xe(e,n,g,p,a.handles,function(e){return[e.start,e.end,e.perpendicularStart,e.perpendicularEnd]},c,h,10,!0)})},m=0;m<i.data.length;m++)g(m)}},gt=function(e,t,n){var a=e.handles,o=a.start,i=a.end,r=a.perpendicularStart,s=a.perpendicularEnd,l=(o.x-i.x)*(n||1),c=(o.y-i.y)*(t||1),u=Math.sqrt(l*l+c*c),d=(r.x-s.x)*(n||1),h=(r.y-s.y)*(t||1),v=Math.sqrt(d*d+h*h);if(v||(v=0),v>u){var g=u;u=v,v=g}e.longestDiameter=u.toFixed(1),e.shortestDiameter=v.toFixed(1)},mt=function(e,t,n){var a=" mm";return t&&n||(a=" pixels"),[" L ".concat(e.longestDiameter).concat(a)," W ".concat(e.shortestDiameter).concat(a)]},ft=function(e,t){var n=this,a=e.detail,o=a.element,i=a.image,r=this.configuration;if(!pt(i)){var s=this.createNewMeasurement(a),l=function(){s.active=!1,f.cornerstone.updateImage(o)};J(o,this.name,s),f.cornerstone.updateImage(o);var c=(new Date).getTime(),u=s.handles,d=u.end,h=u.perpendicularStart;ye(a,this.name,s,d,{doneMovingCallback:function(){var e=s.handles,t=s.longestDiameter,i=s.shortestDiameter,u=re(a,e),d=parseFloat(t)||0,v=parseFloat(i)||0,g=d<1||v<1,m=(new Date).getTime()-c<150;u||g||m?(s.cancelled=!0,$(o,n.name,s)):r.getMeasurementLocationCallback(s,a,l),h.locked=!1,f.cornerstone.updateImage(o)}},t)}},pt=function(e){var t=f.cornerstone.metaData.get("imagePlaneModule",e.imageId),n=e.rowPixelSpacing,a=e.columnPixelSpacing;return t&&(n=t.rowPixelSpacing||t.rowImagePixelSpacing,a=t.columnPixelSpacing||t.colImagePixelSpacing),!n||!a};var yt={setCoords:function(e){st=e.currentPoints.canvas},getCoords:function(){return st}},xt=function(e){var t=this,n=e.detail,a=n.element;yt.setCoords(n);var o=Q(a,this.name);if(o){for(var i=!1,r=function(e){var r=n.currentPoints.canvas,s=o.data[e],l=function(e,t,n){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:6,o=oe(e,t,n,a),i=!1;return Object.keys(t).forEach(function(e){if("textBox"!==e){var n=t[e],a=n===o;n.active!==a&&(i=!0),n.active=a}}),i}(a,s.handles,r);Object.keys(s.handles).forEach(function(e){if("textBox"!==e){var t=s.handles[e];t.hover=t.active}}),l&&(i=!0);var c=t.pointNearTool(a,s,r,"mouse"),u=c&&!s.active,d=!c&&s.active;(u||d)&&(s.active=!s.active,i=!0)},s=0;s<o.data.length;s++)r(s);!0===i&&f.cornerstone.updateImage(a)}},Tt=function(e,t,n,a){var o,i,r,s,l={},c={},u={x:t.currentPoints.image.x+a.x,y:t.currentPoints.image.y+a.y};0===e.index?function(e,t){var n=f.cornerstoneMath.point.distance,a=t.handles,o=a.start,i=a.end,r=a.perpendicularStart,s=a.perpendicularEnd,l={start:{x:o.x,y:o.y},end:{x:i.x,y:i.y}},c={start:{x:r.x,y:r.y},end:{x:s.x,y:s.y}},u=f.cornerstoneMath.lineSegment.intersectLine(l,c),d=n(r,u),h=n(s,u),v=n(i,u),g=n(i,e);if(g<=v)return!1;var m=(i.x-e.x)/g,p=(i.y-e.y)/g,y=v/g,x=i.x+(e.x-i.x)*y,T=i.y+(e.y-i.y)*y;return r.x=x-d*p,r.y=T+d*m,s.x=x+h*p,s.y=T-h*m,!0}(u,n)?(e.x=u.x,e.y=u.y):(t.currentPoints.image.x=e.x,t.currentPoints.image.y=e.y):1===e.index?function(e,t){var n=f.cornerstoneMath.point.distance,a=t.handles,o=a.start,i=a.end,r=a.perpendicularStart,s=a.perpendicularEnd,l={start:{x:o.x,y:o.y},end:{x:i.x,y:i.y}},c={start:{x:r.x,y:r.y},end:{x:s.x,y:s.y}},u=f.cornerstoneMath.lineSegment.intersectLine(l,c),d=n(r,u),h=n(s,u),v=n(o,u),g=n(o,e);if(g<=v)return!1;var m=(o.x-e.x)/g,p=(o.y-e.y)/g,y=v/g,x=o.x+(e.x-o.x)*y,T=o.y+(e.y-o.y)*y;return r.x=x+d*p,r.y=T-d*m,s.x=x-h*p,s.y=T+h*m,!0}(u,n)?(e.x=u.x,e.y=u.y):(t.currentPoints.image.x=e.x,t.currentPoints.image.y=e.y):2===e.index?(o=!1,l.start={x:n.handles.start.x,y:n.handles.start.y},l.end={x:n.handles.end.x,y:n.handles.end.y},c.start={x:n.handles.perpendicularEnd.x,y:n.handles.perpendicularEnd.y},c.end={x:u.x,y:u.y},(i=f.cornerstoneMath.lineSegment.intersectLine(l,c))||(c.end={x:n.handles.perpendicularStart.x,y:n.handles.perpendicularStart.y},i=f.cornerstoneMath.lineSegment.intersectLine(l,c),r=f.cornerstoneMath.point.distance(i,n.handles.start),s=f.cornerstoneMath.point.distance(i,n.handles.end),(!i||r<3||s<3)&&(o=!0)),!1,o||function(e,t){var n=f.cornerstoneMath.point.distance,a=t.handles,o=a.start,i=a.end,r=a.perpendicularStart,s=a.perpendicularEnd,l=s,c=f.cornerstoneMath.lineSegment.distanceToPoint(t.handles,l),u=f.cornerstoneMath.lineSegment.distanceToPoint(t.handles,e),d=c+u;if(n(l,e)<=c)return!1;var h=n(o,i);if(0===h)return!1;var v=(o.x-i.x)/h,g=(o.y-i.y)/h,m=o.x-1*v,p=o.y-1*g,y=i.x+1*v,x=i.y+1*g;r.x=e.x,r.y=e.y,s.x=e.x-d*g,s.y=e.y+d*v;var T={start:{x:o.x,y:o.y},end:{x:i.x,y:i.y}},b={start:{x:r.x,y:r.y},end:{x:s.x,y:s.y}};return f.cornerstoneMath.lineSegment.intersectLine(T,b)||(n(e,o)>n(e,i)?(r.x=y+u*g,r.y=x-u*v,s.x=r.x-d*g,s.y=r.y+d*v):(r.x=m+u*g,r.y=p-u*v,s.x=r.x-d*g,s.y=r.y+d*v)),!0}(u,n)||(t.currentPoints.image.x=n.handles.perpendicularStart.x,t.currentPoints.image.y=n.handles.perpendicularStart.y)):3===e.index&&(o=!1,l.start={x:n.handles.start.x,y:n.handles.start.y},l.end={x:n.handles.end.x,y:n.handles.end.y},c.start={x:n.handles.perpendicularStart.x,y:n.handles.perpendicularStart.y},c.end={x:u.x,y:u.y},(i=f.cornerstoneMath.lineSegment.intersectLine(l,c))||(c.end={x:n.handles.perpendicularEnd.x,y:n.handles.perpendicularEnd.y},i=f.cornerstoneMath.lineSegment.intersectLine(l,c),r=f.cornerstoneMath.point.distance(i,n.handles.start),s=f.cornerstoneMath.point.distance(i,n.handles.end),(!i||r<3||s<3)&&(o=!0)),!1,o||function(e,t){var n=f.cornerstoneMath.point.distance,a=t.handles,o=a.start,i=a.end,r=a.perpendicularStart,s=a.perpendicularEnd,l=r,c=f.cornerstoneMath.lineSegment.distanceToPoint(t.handles,l),u=f.cornerstoneMath.lineSegment.distanceToPoint(t.handles,e),d=c+u;if(n(l,e)<=c)return!1;var h=n(o,i),v=(o.x-i.x)/h,g=(o.y-i.y)/h,m=o.x-1*v,p=o.y-1*g,y=i.x+1*v,x=i.y+1*g;r.x=e.x+d*g,r.y=e.y-d*v,s.x=e.x,s.y=e.y,s.locked=!1,r.locked=!1;var T={start:{x:o.x,y:o.y},end:{x:i.x,y:i.y}},b={start:{x:r.x,y:r.y},end:{x:s.x,y:s.y}};return f.cornerstoneMath.lineSegment.intersectLine(T,b)||(n(e,o)>n(e,i)?(s.x=y-u*g,s.y=x+u*v,r.x=s.x+d*g,r.y=s.y-d*v):(s.x=m-u*g,s.y=p+u*v,r.x=s.x+d*g,r.y=s.y-d*v)),!0}(u,n)||(t.currentPoints.image.x=n.handles.perpendicularEnd.x,t.currentPoints.image.y=n.handles.perpendicularEnd.y))},bt=function(e,t,n){var a=e[n],o=t[n];e[n]=o,t[n]=a},Et=function(e,t){bt(e,t,"x"),bt(e,t,"y"),bt(e,t,"moving"),bt(e,t,"hover"),bt(e,t,"active"),bt(e,t,"selected")};var Mt=function(e){var t,n=this,a=e.detail,o=a.element,i=k.clickProximity,r=function(e){t.invalidated=!0,re(a,t.handles)&&$(o,n.name,t),e&&(e.moving=!1,e.selected=!0),o.style.cursor="",f.cornerstone.updateImage(o),o.addEventListener(x.MOUSE_MOVE,n._moveCallback),o.addEventListener(x.TOUCH_START,n._moveCallback)},s=a.startPoints.canvas,l=Q(e.currentTarget,this.name);if(l){for(var c=function(c){t=l.data[c];var u=[o,t.handles,s,i],d=oe.apply(void 0,u);if(d)return o.removeEventListener(x.MOUSE_MOVE,n._moveCallback),o.removeEventListener(x.TOUCH_START,n._moveCallback),t.active=!0,Ct(t.handles),d.moving=!0,d=function(e,t,n){var a=e.image,o=a.rowPixelSpacing,i=a.columnPixelSpacing,r=t.handles,s=r.start,l=r.end,c=r.perpendicularStart,u=r.perpendicularEnd,d=(s.x-l.x)*(i||1),h=(s.y-l.y)*(o||1),v=Math.sqrt(d*d+h*h),g=(c.x-u.x)*(i||1),m=(c.y-u.y)*(o||1);return(Math.sqrt(g*g+m*m)||0)>v?(Et(s,l),Et(s,c),Et(l,u),Object.values(r).find(function(e){return!0===e.moving})):n}(a,t,d),o.style.cursor=d.hasBoundingBox?"move":"none",function(e,t,n,a,o,i){var r=e.element,s={x:a.x-e.currentPoints.image.x,y:a.y-e.currentPoints.image.y},l=function(e){var o=e.detail;a.active=!0,a.hasMoved=!0,void 0===a.index||null===a.index?(a.x=o.currentPoints.image.x+s.x,a.y=o.currentPoints.image.y+s.y):Tt(a,o,n,s),i&&(a.x=Math.max(a.x,0),a.x=Math.min(a.x,o.image.width),a.y=Math.max(a.y,0),a.y=Math.min(a.y,o.image.height)),f.cornerstone.updateImage(r);var l={toolType:t,element:r,measurementData:n};f.cornerstone.triggerEvent(r,x.MEASUREMENT_MODIFIED,l)};r.addEventListener(x.MOUSE_DRAG,l),r.addEventListener(x.TOUCH_DRAG,l);var c=f.cornerstone.getImage(r),u=function(){f.cornerstone.getImage(r).imageId!==c.imageId&&d()};r.addEventListener(f.cornerstone.EVENTS.IMAGE_RENDERED,u);var d=function e(){r.removeEventListener(f.cornerstone.EVENTS.IMAGE_RENDERED,u),r.removeEventListener(x.MOUSE_DRAG,l),r.removeEventListener(x.MOUSE_UP,e),r.removeEventListener(x.MOUSE_CLICK,e),r.removeEventListener(x.TOUCH_DRAG,l),r.removeEventListener(x.TOUCH_DRAG_END,e),r.removeEventListener(x.TAP,e),f.cornerstone.updateImage(r),"function"==typeof o&&o()};r.addEventListener(x.MOUSE_UP,d),r.addEventListener(x.MOUSE_CLICK,d),r.addEventListener(x.TOUCH_DRAG_END,d),r.addEventListener(x.TAP,d)}(a,n.name,t,d,function(){return r(d)}),It(e),{v:!0}},u=0;u<l.data.length;u++){var d=c(u);if("object"===y()(d))return d.v}var h=function(e){return function(){wt(e,!1),r()}};for(u=0;u<l.data.length;u++)if(t=l.data[u],this.pointNearTool(o,t,s,"mouse")){o.removeEventListener(x.MOUSE_MOVE,this._moveCallback),o.removeEventListener(x.TOUCH_START,this._moveCallback),t.active=!0,Ct(t.handles),wt(t.handles,!0);var v=h(t.handles);return de(a,this.name,t,null,{deleteIfHandleOutsideImage:!0,preventHandleOutsideImage:!1,doneMovingCallback:v},"mouse"),It(e),!0}}},Ct=function(e){var t=!1;return Object.keys(e).forEach(function(n){"textBox"!==n&&(e[n].selected=!1,t=e[n].active||t,e[n].active=!1)}),t},wt=function(e,t){Object.keys(e).forEach(function(n){"textBox"!==n&&(e[n].moving=t)})},It=function(e){e.stopImmediatePropagation(),e.stopPropagation(),e.preventDefault()},kt=[x.TOUCH_END,x.TOUCH_DRAG_END,x.TOUCH_PINCH,x.TOUCH_PRESS,x.TAP],Pt=function(e){var t,n=this,a=e.detail,o=a.element,i=k.touchProximity,r=function(e){t.invalidated=!0,re(a,t.handles)&&$(o,n.name,t),e&&(e.moving=!1,e.selected=!0),f.cornerstone.updateImage(o),o.addEventListener(x.TOUCH_DRAG,n._moveCallback)},s=a.startPoints.canvas,l=Q(e.currentTarget,this.name);if(l){for(var c=function(c){t=l.data[c];var u=[o,t.handles,s,i],d=oe.apply(void 0,u);if(d)return o.removeEventListener(x.TOUCH_DRAG,n._moveCallback),t.active=!0,St(t.handles),d.moving=!0,function(e,t,n,a,o,i){var r=e.element,s={x:a.x-e.currentPoints.image.x,y:a.y-e.currentPoints.image.y},l=function(e){var o=e.detail;a.active=!0,a.hasMoved=!0,void 0===a.index||null===a.index?(a.x=o.currentPoints.image.x+s.x,a.y=o.currentPoints.image.y+s.y):Tt(a,o,n,s),i&&(a.x=Math.max(a.x,0),a.x=Math.min(a.x,o.image.width),a.y=Math.max(a.y,0),a.y=Math.min(a.y,o.image.height)),f.cornerstone.updateImage(r);var l=x.MEASUREMENT_MODIFIED,c={toolType:t,element:r,measurementData:n};f.cornerstone.triggerEvent(r,l,c)};r.addEventListener(x.TOUCH_DRAG,l);var c=function e(){r.removeEventListener(x.TOUCH_DRAG,l),kt.forEach(function(t){r.removeEventListener(t,e)}),f.cornerstone.updateImage(r),"function"==typeof o&&o()};kt.forEach(function(e){r.addEventListener(e,c)})}(a,n.name,t,d,function(){return r(d)}),Ot(e),{v:!0}},u=0;u<l.data.length;u++){var d=c(u);if("object"===y()(d))return d.v}var h=function(e){return function(){_t(e,!1),r()}};for(u=0;u<l.data.length;u++)if(t=l.data[u],this.pointNearTool(o,t,s,"touch")){o.removeEventListener(x.TOUCH_DRAG,this._moveCallback),t.active=!0,St(t.handles),_t(t.handles,!0);var v=h(t.handles);return de(a,this.name,t,null,{deleteIfHandleOutsideImage:!0,preventHandleOutsideImage:!1,doneMovingCallback:v},"touch"),Ot(e),!0}}},St=function(e){var t=!1;return Object.keys(e).forEach(function(n){"textBox"!==n&&(e[n].selected=!1,t=e[n].active||t,e[n].active=!1)}),t},_t=function(e,t){Object.keys(e).forEach(function(n){"textBox"!==n&&(e[n].moving=t)})},Ot=function(e){e.stopImmediatePropagation(),e.stopPropagation(),e.preventDefault()},Dt=function(e,t,n){return n()},Lt=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};o()(this,t);var a={name:"Bidirectional",supportedInteractionTypes:["Mouse","Touch"],configuration:{changeMeasurementLocationCallback:Dt,getMeasurementLocationCallback:Dt,textBox:"",shadow:"",drawHandlesOnHover:!0,additionalData:[]}},i=Object.assign(a.configuration,n),r=Object.assign(a,{configuration:i});return(e=l()(this,u()(t).call(this,r))).createNewMeasurement=dt.bind(ct()(ct()(e))),e.pointNearTool=ht.bind(ct()(ct()(e))),e.renderToolData=vt.bind(ct()(ct()(e))),e.addNewMeasurement=ft.bind(ct()(ct()(e))),e._moveCallback=xt.bind(ct()(ct()(e))),e.preMouseDownCallback=Mt.bind(ct()(ct()(e))),e.preTouchStartCallback=Pt.bind(ct()(ct()(e))),e}return h()(t,e),t}(Me),At=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};o()(this,t);var a=Object.assign({name:"CobbAngle",supportedInteractionTypes:["Mouse","Touch"]},n);return(e=l()(this,u()(t).call(this,a))).initialConfiguration=a,e.hasIncomplete=!1,e}return h()(t,e),r()(t,[{key:"createNewMeasurement",value:function(e){return this.hasIncomplete=!0,{visible:!0,active:!0,color:void 0,complete:!1,value:"",handles:{start:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!1},end:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!0},start2:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!1,drawnIndependently:!0},end2:{x:e.currentPoints.image.x+1,y:e.currentPoints.image.y,highlight:!0,active:!1,drawnIndependently:!0},textBox:{active:!1,hasMoved:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0}}}}},{key:"pointNearTool",value:function(e,t,n){return!1!==t.visible&&(!this.hasIncomplete&&(et(e,t.handles.start,t.handles.end,n)<25||et(e,t.handles.start2,t.handles.end2,n)<25))}},{key:"renderToolData",value:function(e){var t=e.detail,n=Q(e.currentTarget,this.name);if(n)for(var a=Je(t.canvasContext.canvas),o=Ie.getToolWidth(),i=ze.getFont(),r=this.configuration,s=function(e){var s=n.data[e];if(!1===s.visible)return"continue";Oe(a,function(e){$e(e,r);var n=_e.getColorIfActive(s);Le(e,t.element,s.handles.start,s.handles.end,{color:n}),s.complete&&Le(e,t.element,s.handles.start2,s.handles.end2,{color:n});var a={drawHandlesIfActive:r&&r.drawHandlesOnHover};Be(e,t,s.handles,n,a),e.fillStyle=n;var l=s.value;if(!s.handles.textBox.hasMoved){var u={x:(s.handles.start.x+s.handles.end.x)/2,y:(s.handles.start.y+s.handles.end.y)/2-10};e.font=i,s.handles.textBox.x=u.x,s.handles.textBox.y=u.y}Xe(e,t.element,s.handles.textBox,l,s.handles,c,n,o,0,!0)})},l=0;l<n.data.length;l++)s(l);function c(e){return[e.start,e.start2,e.end,e.end2]}}},{key:"getIncomplete",value:function(e){var t=Q(e,this.name);if(void 0!==t)for(var n=0;n<t.data.length;n++)if(!1===t.data[n].complete)return t.data[n]}},{key:"addNewMeasurement",value:function(e,t){e.preventDefault(),e.stopPropagation();var n,a,o=e.detail,i=e.detail.element,r=this.getIncomplete(i);r?((n=r).complete=!0,n.handles.start2={x:o.currentPoints.image.x,y:o.currentPoints.image.y,drawnIndependently:!1,highlight:!0,active:!1},n.handles.end2={x:o.currentPoints.image.x,y:o.currentPoints.image.y,drawnIndependently:!1,highlight:!0,active:!0},a=n.handles.end2,this.hasIncomplete=!1):(n=this.createNewMeasurement(o),J(i,this.name,n),a=n.handles.end),f.cornerstone.updateImage(i),ye(o,this.name,n,a,this.options,t)}},{key:"onMeasureModified",value:function(e){var t=f.cornerstone.getEnabledElement(e.detail.element).image;if(e.detail.toolType===this.name){var n=e.detail.measurementData;n.value=function(e,t){var n=t.columnPixelSpacing||1,a=t.rowPixelSpacing||1,o=(Math.ceil(e.handles.start.x)-Math.ceil(e.handles.end.x))*n,i=(Math.ceil(e.handles.start.y)-Math.ceil(e.handles.end.y))*a,r=(Math.ceil(e.handles.start2.x)-Math.ceil(e.handles.end2.x))*n,s=(Math.ceil(e.handles.start2.y)-Math.ceil(e.handles.end2.y))*a,l=Math.acos(Math.abs((o*r+i*s)/(Math.sqrt(o*o+i*i)*Math.sqrt(r*r+s*s))));l*=180/Math.PI;var c=tt(l,2);if(!Number.isNaN(e.rAngle))return function(e,t,n){var a=t&&n?"":" (isotropic)";return e.toString()+String.fromCharCode(parseInt("00B0",16))+a}(c,t.rowPixelSpacing,t.columnPixelSpacing);return""}(n,t)}}},{key:"activeCallback",value:function(e){this.onMeasureModified=this.onMeasureModified.bind(this),e.addEventListener(x.MEASUREMENT_MODIFIED,this.onMeasureModified)}},{key:"passiveCallback",value:function(e){this.onMeasureModified=this.onMeasureModified.bind(this),e.addEventListener(x.MEASUREMENT_MODIFIED,this.onMeasureModified)}},{key:"enabledCallback",value:function(e){e.removeEventListener(x.MEASUREMENT_MODIFIED,this.onMeasureModified)}},{key:"disabledCallback",value:function(e){e.removeEventListener(x.MEASUREMENT_MODIFIED,this.onMeasureModified)}}]),t}(Me),Ht=function(e,t){var n=f.cornerstone,a=n.metaData.get("patientStudyModule",e.imageId),o=n.metaData.get("generalSeriesModule",e.imageId);if(a&&o&&"PT"===o.modality){var i=t*e.slope+e.intercept,r=a.patientWeight;if(r){var s=n.metaData.get("petIsotopeModule",e.imageId);if(s){var l=s.radiopharmaceuticalInfo,c=l.radiopharmaceuticalStartTime,u=l.radionuclideTotalDose,d=l.radionuclideHalfLife,h=o.seriesTime;if(c&&u&&d&&h){var v=Ut(h.fractionalSeconds||0)+h.seconds+60*h.minutes+60*h.hours*60-(Ut(c.fractionalSeconds)+c.seconds+60*c.minutes+60*c.hours*60);return i*r/(u*Math.exp(-v*Math.log(2)/d))*1e3}}}}};function Ut(e){return parseFloat(".".concat(e))}var Nt=function(e){var t=e.toString().split(".");return t[0]=t[0].replace(/\B(?=(\d{3})+(?!\d))/g,","),t.join(".")},Rt=function(e,t){var n=e.width/2,a=e.height/2;if(n<=0||a<=0)return!1;var o=e.left+n,i=e.top+a,r=t.x-o,s=t.y-i;return r*r/(n*n)+s*s/(a*a)<=1},Bt={calculateEllipseStatistics:function(e,t){for(var n=0,a=0,o=0,i=0,r=t.top;r<t.top+t.height;r++)for(var s=t.left;s<t.left+t.width;s++)Rt(t,{x:s,y:r})&&(n+=e[i],a+=e[i]*e[i],o++),i++;if(0===o)return{count:o,mean:0,variance:0,stdDev:0};var l=n/o,c=a/o-l*l;return{count:o,mean:l,variance:c,stdDev:Math.sqrt(c)}},pointInEllipse:Rt},Ft=Bt.pointInEllipse,Vt=Bt.calculateEllipseStatistics,jt=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};o()(this,t);var a=Object.assign({name:"EllipticalRoi",supportedInteractionTypes:["Mouse","Touch"]},n);return(e=l()(this,u()(t).call(this,a))).initialConfiguration=a,e}return h()(t,e),r()(t,[{key:"createNewMeasurement",value:function(e){if(e&&e.currentPoints&&e.currentPoints.image)return{visible:!0,active:!0,color:void 0,invalidated:!0,handles:{start:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!1},end:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!0},textBox:{active:!1,hasMoved:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0}}};console.error("required eventData not supplied to tool ".concat(this.name,"'s createNewMeasurement"))}},{key:"pointNearTool",value:function(e,t,n){var a=t&&t.handles&&t.handles.start&&t.handles.end;if(a||console.warn("invalid parameters supplieed to tool ".concat(this.name,"'s pointNearTool")),!a||!1===t.visible)return!1;var o=f.cornerstone.pixelToCanvas(e,t.handles.start),i=f.cornerstone.pixelToCanvas(e,t.handles.end),r={left:Math.min(o.x,i.x)+7.5,top:Math.min(o.y,i.y)+7.5,width:Math.abs(o.x-i.x)-15,height:Math.abs(o.y-i.y)-15},s={left:Math.min(o.x,i.x)-7.5,top:Math.min(o.y,i.y)-7.5,width:Math.abs(o.x-i.x)+15,height:Math.abs(o.y-i.y)+15},l=Ft(r,n);return!(!Ft(s,n)||l)}},{key:"renderToolData",value:function(e){var t=e.detail,n=Q(e.currentTarget,this.name);if(n){var a,o=Je(t.canvasContext.canvas),i=t.image,r=t.element,s=Ie.getToolWidth(),l=this.configuration,c=f.cornerstone.metaData.get("generalSeriesModule",i.imageId),u=f.cornerstone.metaData.get("imagePlaneModule",i.imageId),d=i.rowPixelSpacing,h=i.columnPixelSpacing;u&&(d=u.rowPixelSpacing||u.rowImagePixelSpacing,h=u.columnPixelSpacing||u.colImagePixelSpacing),c&&(a=c.modality);for(var v=function(e){var c=n.data[e];if(!1===c.visible)return"continue";Oe(o,function(e){$e(e,l);var n=_e.getColorIfActive(c);Ne(e,r,c.handles.start,c.handles.end,{color:n});var o,u,v,g={drawHandlesIfActive:l&&l.drawHandlesOnHover};if(Be(e,t,c.handles,n,g),!1===c.invalidated)u=c.meanStdDev,v=c.meanStdDevSUV,o=c.area;else{var p={left:Math.round(Math.min(c.handles.start.x,c.handles.end.x)),top:Math.round(Math.min(c.handles.start.y,c.handles.end.y)),width:Math.round(Math.abs(c.handles.start.x-c.handles.end.x)),height:Math.round(Math.abs(c.handles.start.y-c.handles.end.y))};if(!i.color){var y=f.cornerstone.getPixels(r,p.left,p.top,p.width,p.height);u=Vt(y,p),"PT"===a&&(v={mean:Ht(i,(u.mean-i.intercept)/i.slope),stdDev:Ht(i,(u.stdDev-i.intercept)/i.slope)}),u&&!isNaN(u.mean)&&(c.meanStdDev=u,c.meanStdDevSUV=v)}o=Math.PI*(p.width*(h||1)/2)*(p.height*(d||1)/2),isNaN(o)||(c.area=o),c.invalidated=!1}c.handles.textBox.hasMoved||(c.handles.textBox.x=Math.max(c.handles.start.x,c.handles.end.x),c.handles.textBox.y=(c.handles.start.y+c.handles.end.y)/2);var x=function(e){var t=e.meanStdDev,n=e.meanStdDevSUV,o=e.area,i=[];if(t&&void 0!==t.mean){var r="";"CT"===a&&(r=" HU");var s="Mean: ".concat(Nt(t.mean.toFixed(2))).concat(r),l="StdDev: ".concat(Nt(t.stdDev.toFixed(2))).concat(r);if(n&&void 0!==n.mean){s+=" SUV: "+Nt(n.mean.toFixed(2)),l+=" SUV: "+Nt(n.stdDev.toFixed(2))}i.push(s),i.push(l)}if(o){var c=" mm".concat(String.fromCharCode(178));d&&h||(c=" pixels".concat(String.fromCharCode(178)));var u="Area: ".concat(Nt(o.toFixed(2))).concat(c);i.push(u)}return i}(c);Xe(e,r,c.handles.textBox,x,c.handles,m,n,s,0,!0)})},g=0;g<n.data.length;g++)v(g)}function m(e){var t=Math.min(e.start.x,e.end.x),n=Math.min(e.start.y,e.end.y),a=Math.abs(e.start.x-e.end.x),o=Math.abs(e.start.y-e.end.y);return[{x:t+a/2,y:n},{x:t,y:n+o/2},{x:t+a/2,y:n+o},{x:t+a,y:n+o/2}]}}}]),t}(Me),Wt=n(9),zt=n.n(Wt),Gt=function(e,t){for(var n=!1,a=e.length-1,o=0;o<e.length;o++)qt(t,e[o],e[a])&&(n=!n),a=o;return n};function qt(e,t,n){return a=e.y,o=t.y,i=n.y,!(!(o<a&&a<i||i<a&&a<o)||!function(e,t,n){if(t.x>e.x&&n.x>e.x)return!0;if(t.x===n.x)return e.x<t.x;if(t.x>n.x){var a=t;t=n,n=a}var o=function(e,t,n){var a=(n.y-t.y)/(n.x-t.x);return{value:t.x+a*(e.x-t.x),gradient:a}}(e,t,n);return Math.sign(o.gradient)*e.y>o.value}(e,t,n));var a,o,i}function Yt(e,t,n,a){Gt(e,t)&&(n.value+=a,n.squared+=a*a,n.count++)}var Kt=function e(t,n){o()(this,e),this.toolIndex=t,this.handleIndexArray=n},Xt=function e(t){var n=!(arguments.length>1&&void 0!==arguments[1])||arguments[1],a=!(arguments.length>2&&void 0!==arguments[2])||arguments[2];o()(this,e),this.x=t.x,this.y=t.y,this.highlight=n,this.active=a,this.lines=[]};function Zt(e,t,n,a){for(var o=e.length-1,i=0;i<e.length;i++)if(-1===a.indexOf(i)&&-1===a.indexOf(o)){if(Jt(t,n,Qt(e[o]),Qt(e[i])))return!0;o=i}else o=i;return!1}function Jt(e,t,n,a){var o=!1,i=[$t(e,t,n),$t(e,t,a),$t(n,a,e),$t(n,a,t)];return i[0]!==i[1]&&i[2]!==i[3]||(0===i[0]&&en(e,n,t)?o=!0:0===i[1]&&en(e,a,t)?o=!0:0===i[2]&&en(n,e,a)?o=!0:0===i[3]&&en(n,t,a)&&(o=!0),o)}function Qt(e){return{x:e.x,y:e.y}}function $t(e,t,n){var a=(t.y-e.y)*(n.x-t.x)-(t.x-e.x)*(n.y-t.y);return 0===a?0:a>0?1:2}function en(e,t,n){return t.x<=Math.max(e.x,n.x)&&t.x>=Math.min(e.x,n.x)&&t.y<=Math.max(e.y,n.y)&&t.y>=Math.min(e.y,n.y)}var tn={newHandle:function(e,t){var n=t.length-1;return Zt(t,Qt(t[n]),Qt(e),[n])},end:function(e){var t=e.length-1;return Zt(e,Qt(e[t]),Qt(e[0]),[t,0])},modify:function(e,t){var n=Qt(e[t]),a=t-1;0===t&&(a=e.length-1);var o=Qt(e[a]);return!!Zt(e,n,o,[t,a])||Zt(e,n,o=Qt(e[a=t===e.length-1?0:t+1]),[t,a])}},nn=function(){function e(t){o()(this,e),this._eventData=t}return r()(e,[{key:"findLine",value:function(){var e=this.findTool();if(null===e)return null;var t=this._getCloseLinesInTool(e);return t?this._findCorrectLine(e,t):null}},{key:"findTool",value:function(){return this._toolData=Q(this._eventData.element,"FreehandMouse"),this._mousePoint=this._eventData.currentPoints.canvas,this._toolData?this._nearestHandleToPointAllTools().toolIndex:null}},{key:"_nearestHandleToPointAllTools",value:function(){for(var e=this._toolData,t={toolIndex:null,handleIndex:null,distance:1/0},n=0;n<e.data.length;n++){var a=this._nearestHandleToPoint(n);null!==a&&(a.distance<t.distance&&(t=a))}return t}},{key:"_nearestHandleToPoint",value:function(e){var t=this._eventData,n=this._toolData.data[e];if(void 0===n.handles)return null;if(!1===n.visible)return null;for(var a={toolIndex:e,handleIndex:null,distance:1/0},o=0;o<n.handles.length;o++){var i=f.cornerstone.pixelToCanvas(t.element,n.handles[o]),r=f.cornerstoneMath.point.distance(i,this._mousePoint);r<a.distance&&(a.handleIndex=o,a.distance=r)}return a}},{key:"_getCloseLinesInTool",value:function(t){for(var n=this._toolData.data[t].handles,a=[],o=0;o<n.length;o++){var i=e.getNextHandleIndex(o,n.length);this._distanceOfPointfromLine(n[o],n[i])<10&&a.push([o,i])}return a}},{key:"_findCorrectLine",value:function(e,t){for(var n=0;n<t.length;n++)if(this._pointProjectsToLineSegment(e,t[n]))return new Kt(e,t[n]);return null}},{key:"_pointProjectsToLineSegment",value:function(t,n){var a=this._eventData,o=this._toolData.data[t];if(void 0!==o.handles){if(!1===o.visible)return!1;var i=o.handles[n[0]],r=o.handles[n[1]],s=e.getCanvasPointsFromHandles(i,r,a.element),l=e.getLineAsVector(s),c=this._getLineOriginToMouseAsVector(s),u=(c[0]*l[0]+c[1]*l[1])/l.magnitude;return u>0&&u<l.magnitude}}},{key:"_getLineOriginToMouseAsVector",value:function(e){return[this._mousePoint.x-e[0].x,this._mousePoint.y-e[0].y]}},{key:"_distanceOfPointfromLine",value:function(e,t){var n=this._eventData,a=f.cornerstone.pixelToCanvas(n.element,e),o=f.cornerstone.pixelToCanvas(n.element,t),i=this._mousePoint;return Math.abs((o.y-a.y)*i.x-(o.x-a.x)*i.y+o.x*a.y-o.y*a.x)/f.cornerstoneMath.point.distance(a,o)}}],[{key:"getCanvasPointsFromHandles",value:function(e,t,n){var a=[];return e.x<t.x?(a.push(f.cornerstone.pixelToCanvas(n,e)),a.push(f.cornerstone.pixelToCanvas(n,t))):(a.push(f.cornerstone.pixelToCanvas(n,t)),a.push(f.cornerstone.pixelToCanvas(n,e))),a}},{key:"getLineAsVector",value:function(e){var t=[e[1].x-e[0].x,e[1].y-e[0].y];return t.magnitude=f.cornerstoneMath.point.distance(e[0],e[1]),t}},{key:"getNextHandleIndex",value:function(e,t){return e<t-1?e+1:0}}]),e}(),an="FreehandMouse";var on={calculateFreehandStatistics:function(e,t,n){var a={count:0,mean:0,variance:0,stdDev:0},o=function(e,t,n){for(var a={value:0,squared:0,count:0},o=0,i=t.top;i<t.top+t.height;i++)for(var r=t.left;r<t.left+t.width;r++){var s={x:r,y:i};Yt(n,s,a,e[o]),o++}return a}(e,t,n);return 0===o.count?a:(a.count=o.count,a.mean=o.value/o.count,a.variance=o.squared/o.count-a.mean*a.mean,a.stdDev=Math.sqrt(a.variance),a)},ClickedLineData:Kt,freehandArea:function(e,t){var n=0,a=e.length-1;t=t||1;for(var o=0;o<e.length;o++)n+=(e[a].x+e[o].x)*(e[a].y-e[o].y),a=o;return Math.abs(n*t/2)},FreehandHandleData:Xt,freehandIntersect:tn,FreehandLineFinder:nn,insertOrDelete:function(e,t){var n=e.detail;if(t&&null!==t.handleNearby)!function(e,t){var n=Q(e.element,an);if(void 0!==n){var a=t.handleIndex,o=t.toolIndex,i=n.data[o];i.handles.length<=3||(a===i.handles.length-1?(i.handles[a-1].lines.pop(),i.handles[a-1].lines.push(i.handles[0])):0===a?(i.handles[i.handles.length-1].lines.pop(),i.handles[i.handles.length-1].lines.push(i.handles[a+1])):(i.handles[a-1].lines.pop(),i.handles[a-1].lines.push(i.handles[a+1])),i.handles.splice(a,1),i.invalidated=!0,i.active=!0,i.highlight=!0,f.cornerstone.updateImage(e.element))}}(n,{toolIndex:t.toolIndex,handleIndex:t.handleNearby});else{var a=new nn(n).findLine();a&&function(e,t){var n=Q(e.element,an);if(void 0!==n){var a=n.data[t.toolIndex],o=function(e){for(var t=e.handleIndexArray,n=1/0,a=t.includes(0),o=0;o<t.length;o++){var i=t[o];0!==i&&i<n&&(n=i)}return a&&1===n&&(n=0),++n}(t);if(o!==1/0){var i=new Xt(e.currentPoints.image);a.handles.splice(o,0,i),a.handles[o-1].lines.pop(),a.handles[o-1].lines.push(e.currentPoints.image),o===a.handles.length-1?a.handles[o].lines.push(a.handles[0]):a.handles[o].lines.push(a.handles[o+1]),a.active=!0,a.highlight=!0,a.invalidated=!0,f.cornerstone.updateImage(e.element)}}}(n,a)}},pointInFreehand:Gt},rn=on.insertOrDelete,sn=on.freehandArea,ln=on.calculateFreehandStatistics,cn=on.freehandIntersect,un=on.FreehandHandleData,dn=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};o()(this,t);var a={name:"FreehandMouse",supportedInteractionTypes:["Mouse"],configuration:{mouseLocation:{handles:{start:{highlight:!0,active:!0}}},spacing:5,activeHandleRadius:3,completeHandleRadius:6,alwaysShowHandles:!1,invalidColor:"crimson",currentHandle:0,currentTool:-1}},i=Object.assign(a,n);return(e=l()(this,u()(t).call(this,i))).initialConfiguration=i,e._drawing=!1,e._dragging=!1,e._modifying=!1,e._drawingMouseDownCallback=e._drawingMouseDownCallback.bind(ct()(ct()(e))),e._drawingMouseMoveCallback=e._drawingMouseMoveCallback.bind(ct()(ct()(e))),e._drawingMouseDragCallback=e._drawingMouseDragCallback.bind(ct()(ct()(e))),e._drawingMouseUpCallback=e._drawingMouseUpCallback.bind(ct()(ct()(e))),e._editMouseUpCallback=e._editMouseUpCallback.bind(ct()(ct()(e))),e._editMouseDragCallback=e._editMouseDragCallback.bind(ct()(ct()(e))),e}return h()(t,e),r()(t,[{key:"createNewMeasurement",value:function(e){if(e&&e.currentPoints&&e.currentPoints.image){var t={visible:!0,active:!0,invalidated:!0,color:void 0,handles:[]};return t.handles.textBox={active:!1,hasMoved:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0},t}console.error("required eventData not supplied to tool ".concat(this.name,"'s createNewMeasurement"))}},{key:"pointNearTool",value:function(e,t,n){var a=t&&t.handles;if(!a)throw new Error("invalid parameters supplied to tool ".concat(this.name,"'s pointNearTool"));return!(!a||!1===t.visible)&&void 0!==this._pointNearHandle(e,t,n)}},{key:"distanceFromPoint",value:function(e,t,n){for(var a=1/0,o=0;o<t.handles.length;o++){var i=f.cornerstoneMath.point.distance(t.handles[o],n);a=Math.min(a,i)}return a===1/0?-1:a}},{key:"distanceFromPointCanvas",value:function(e,t,n){for(var a=1/0,o=f.cornerstone.pixelToCanvas(e,n),i=t.handles,r=0;r<i.length;r++){var s=f.cornerstone.pixelToCanvas(e,i[r]),l=f.cornerstoneMath.point.distance(s,o);a=Math.min(a,l)}return a===1/0?-1:a}},{key:"renderToolData",value:function(e){var t=this,n=e.detail,a=Q(e.currentTarget,this.name);if(a){var o,i=n.image,r=n.element,s=this.configuration,l=f.cornerstone.metaData.get("generalSeriesModule",i.imageId);l&&(o=l.modality);for(var c=Je(n.canvasContext.canvas),u=Ie.getToolWidth(),d=function(e){var l=a.data[e];if(!1===l.visible)return"continue";Oe(c,function(e){var a,c=_e.getColorIfActive(l);if(l.active?l.handles.invalidHandlePlacement?(c=s.invalidColor,a=s.invalidColor):(c=_e.getColorIfActive(l),a=_e.getFillColor()):a=_e.getToolColor(),l.handles.length)for(var d=0;d<l.handles.length;d++){var h=zt()(l.handles[d].lines);d!==l.handles.length-1||l.polyBoundingBox||h.push(s.mouseLocation.handles.start),Ae(e,n.element,l.handles[d],h,{color:c})}var g,m,p,y={fill:a};if((s.alwaysShowHandles||l.active&&l.polyBoundingBox)&&(y.handleRadius=s.activeHandleRadius,Be(e,n,l.handles,c,y)),l.canComplete&&(y.handleRadius=s.completeHandleRadius,Be(e,n,[l.handles[0]],c,y)),l.active&&!l.polyBoundingBox&&(y.handleRadius=s.activeHandleRadius,Be(e,n,s.mouseLocation.handles,c,y),Be(e,n,[l.handles[0]],c,y)),!1===l.invalidated)m=l.meanStdDev,p=l.meanStdDevSUV,g=l.area;else if(!l.active){for(var x={left:l.handles[0].x,right:l.handles[0].x,bottom:l.handles[0].y,top:l.handles[0].x},T=0;T<l.handles.length;T++)x.left=Math.min(x.left,l.handles[T].x),x.right=Math.max(x.right,l.handles[T].x),x.bottom=Math.min(x.bottom,l.handles[T].y),x.top=Math.max(x.top,l.handles[T].y);var b={left:x.left,top:x.bottom,width:Math.abs(x.right-x.left),height:Math.abs(x.top-x.bottom)};if(l.polyBoundingBox=b,!i.color){var E=f.cornerstone.getPixels(r,b.left,b.top,b.width,b.height);m=ln.call(t,E,b,l.handles),"PT"===o&&(p={mean:Ht(i,(m.mean-i.intercept)/i.slope),stdDev:Ht(i,(m.stdDev-i.intercept)/i.slope)}),m&&!isNaN(m.mean)&&(l.meanStdDev=m,l.meanStdDevSUV=p)}var M=(i.columnPixelSpacing||1)*(i.rowPixelSpacing||1);g=sn(l.handles,M),isNaN(g)||(l.area=g),l.invalidated=!1}if(l.polyBoundingBox&&!l.handles.textBox.freehand){l.handles.textBox.hasMoved||(l.handles.textBox.x=l.polyBoundingBox.left+l.polyBoundingBox.width,l.handles.textBox.y=l.polyBoundingBox.top+l.polyBoundingBox.height/2);var C=function(e){var t=e.meanStdDev,n=e.meanStdDevSUV,a=e.area,r=[];if(t&&void 0!==t.mean){var s="";"CT"===o&&(s=" HU");var l="Mean: ".concat(Nt(t.mean.toFixed(2))).concat(s),c="StdDev: ".concat(Nt(t.stdDev.toFixed(2))).concat(s);if(n&&void 0!==n.mean){l+=" SUV: "+Nt(n.mean.toFixed(2)),c+=" SUV: "+Nt(n.stdDev.toFixed(2))}r.push(l),r.push(c)}if(a){var u=" mm".concat(String.fromCharCode(178));i.rowPixelSpacing&&i.columnPixelSpacing||(u=" pixels".concat(String.fromCharCode(178)));var d="Area: ".concat(Nt(a.toFixed(2))).concat(u);r.push(d)}return r}.call(t,l);Xe(e,r,l.handles.textBox,C,l.handles,v,c,u,0,!0)}})},h=0;h<a.data.length;h++)d(h)}function v(e){return e}}},{key:"addNewMeasurement",value:function(e,t){var n=e.detail;this.configuration;this._drawing=!0,this._startDrawing(n),this._addPoint(n),hn(e)}},{key:"preMouseDownCallback",value:function(e){var t=e.detail,n=this._pointNearHandleAllTools(t);return!!t.event.ctrlKey&&(void 0!==n&&n.handleNearby.hasBoundingBox||rn.call(this,e,n),hn(e),!0)}},{key:"handleSelectedCallback",value:function(e,t,n){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:"mouse",o=e.detail,i=o.element;if(n.hasBoundingBox)Te(e,this,t,n,a);else{var r=this.configuration;r.dragOrigin={x:n.x,y:n.y};var s=this._pointNearHandleAllTools(o),l=s.handleNearby,c=s.toolIndex;this._modifying=!0,r.currentHandle=l,r.currentTool=c,this._activateModify(i),k.isToolLocked=!0,hn(e)}}},{key:"_drawingMouseMoveCallback",value:function(e){var t=e.detail,n=t.element,a=Q(t.element,this.name),o=this.configuration,i=o.currentTool,r=a.data[i],s=t.currentPoints.canvas;this._getMouseLocation(t),this._checkInvalidHandleLocation(r,t);var l=this._pointNearHandle(n,r,s);void 0!==l&&!l.hasBoundingBox&&l<r.handles.length-1&&(o.mouseLocation.handles.start.x=r.handles[l].x,o.mouseLocation.handles.start.y=r.handles[l].y),f.cornerstone.updateImage(t.element)}},{key:"_drawingMouseDragCallback",value:function(e){var t=e.detail,n=(t.element,Q(t.element,this.name)),a=this.configuration.currentTool,o=n.data[a];t.currentPoints.canvas;this._getMouseLocation(t),this._checkInvalidHandleLocation(o,t),this._addPointPencilMode(t,o.handles),this._dragging=!0,f.cornerstone.updateImage(t.element)}},{key:"_drawingMouseUpCallback",value:function(e){if(this._dragging){this._dragging=!1;var t=e.detail,n=t.element,a=t.currentPoints.canvas,o=this.configuration,i=o.currentTool,r=Q(t.element,this.name).data[i];this._pointNearHandle(n,r,a);if(!cn.end(r.handles)&&r.canComplete){var s=o.currentHandle;this._endDrawing(n,s)}hn(e)}}},{key:"_drawingMouseDownCallback",value:function(e){var t=e.detail,n=t.element,a=t.currentPoints.canvas,o=this.configuration,i=o.currentTool,r=Q(t.element,this.name).data[i],s=this._pointNearHandle(n,r,a);if(!cn.end(r.handles)&&r.canComplete){var l=o.currentHandle;this._endDrawing(n,l)}else void 0===s&&this._addPoint(t);hn(e)}},{key:"_editMouseDragCallback",value:function(e){var t=e.detail,n=Q(t.element,this.name),a=this.configuration,o=n.data[a.currentTool],i=a.currentHandle;if(this._getMouseLocation(t),o.handles.invalidHandlePlacement=cn.modify(o.handles,i),o.active=!0,o.highlight=!0,o.handles[i].x=a.mouseLocation.handles.start.x,o.handles[i].y=a.mouseLocation.handles.start.y,0!==i){var r=o.handles[i-1].lines.length-1,s=o.handles[i-1].lines[r];s.x=a.mouseLocation.handles.start.x,s.y=a.mouseLocation.handles.start.y}f.cornerstone.updateImage(t.element)}},{key:"_editMouseUpCallback",value:function(e){var t=e.detail,n=t.element,a=Q(t.element,this.name);this._deactivateModify(n),this._dropHandle(t,a),this._endDrawing(n),k.isToolLocked=!1,f.cornerstone.updateImage(t.element)}},{key:"_dropHandle",value:function(e,t){var n=this.configuration,a=n.currentTool,o=t.data[a].handles;if(o.invalidHandlePlacement){var i,r=n.currentHandle,s=o[r];if(0===r)i=o[o.length-1];else i=o[r-1];s.x=n.dragOrigin.x,s.y=n.dragOrigin.y,i.lines[0]=s,o.invalidHandlePlacement=!1}}},{key:"_startDrawing",value:function(e){var t=this.createNewMeasurement(e),n=e.element,a=this.configuration;k.isToolLocked=!0,this._referencedElement=n,this._activateDraw(n),this._getMouseLocation(e),J(e.element,this.name,t);var o=Q(e.element,this.name);a.currentTool=o.data.length-1}},{key:"_addPoint",value:function(e){var t=Q(e.element,this.name),n=this.configuration,a=t.data[n.currentTool];if(!a.handles.invalidHandlePlacement){var o=new un(e.currentPoints.image);a.handles.length&&a.handles[n.currentHandle-1].lines.push(e.currentPoints.image),a.handles.push(o),n.currentHandle+=1,f.cornerstone.updateImage(e.element)}}},{key:"_addPointPencilMode",value:function(e,t){var n=this,a=this.configuration,o=e.element,i=a.mouseLocation.handles.start;t.every(function(e){return n._isDistanceLargerThanSpacingCanvas(o,e,i)})&&this._addPoint(e)}},{key:"_endDrawing",value:function(e,t){var n=Q(e,this.name),a=this.configuration,o=n.data[a.currentTool];o.active=!1,o.highlight=!1,o.handles.invalidHandlePlacement=!1,void 0!==t&&o.handles[a.currentHandle-1].lines.push(o.handles[0]),this._modifying&&(this._modifying=!1,o.invalidated=!0),a.currentHandle=0,a.currentTool=-1,o.canComplete=!1,this._drawing&&(this._drawing=!1,k.isToolLocked=!1,this._deactivateDraw(e)),f.cornerstone.updateImage(e)}},{key:"_pointNearHandle",value:function(e,t,n){var a=this.configuration;if(void 0!==t.handles&&!1!==t.visible){for(var o=0;o<t.handles.length;o++){var i=f.cornerstone.pixelToCanvas(e,t.handles[o]);if(f.cornerstoneMath.point.distance(i,n)<a.spacing)return o}return t.handles.textBox&&ne(t.handles.textBox,n)?t.handles.textBox:void 0}}},{key:"_pointNearHandleAllTools",value:function(e){var t=e.element,n=e.currentPoints.canvas,a=Q(t,this.name);if(a)for(var o,i=0;i<a.data.length;i++)if(void 0!==(o=this._pointNearHandle(t,a.data[i],n)))return{handleNearby:o,toolIndex:i}}},{key:"_getMouseLocation",value:function(e){var t=this.configuration;t.mouseLocation.handles.start.x=e.currentPoints.image.x,t.mouseLocation.handles.start.y=e.currentPoints.image.y,le(t.mouseLocation.handles.start,e.image)}},{key:"_checkInvalidHandleLocation",value:function(e,t){var n;this.configuration;if(e.handles.length<2)return!0;n=this._dragging?this._checkHandlesPencilMode(e,t):this._checkHandlesPolygonMode(e,t),e.handles.invalidHandlePlacement=n}},{key:"_checkHandlesPolygonMode",value:function(e,t){var n=this.configuration,a=t.element,o=n.mouseLocation.handles.start,i=e.handles,r=!1;return e.canComplete=!1,this._isDistanceSmallerThanSpacingCanvas(a,i[0],o)&&!cn.end(i)?(e.canComplete=!0,r=!1):r=cn.newHandle(o,i),r}},{key:"_checkHandlesPencilMode",value:function(e,t){var n=this.configuration.mouseLocation.handles.start,a=e.handles,o=cn.newHandle(n,a);return!1===o&&(o=this._invalidHandlePencilMode(e,t)),o}},{key:"_invalidHandlePencilMode",value:function(e,t){var n=this.configuration,a=t.element,o=n.mouseLocation.handles.start,i=e.handles;if(this._isDistanceSmallerThanSpacingCanvas(a,i[0],o))return e.canComplete=!0,!1;e.canComplete=!1;for(var r=1;r<i.length-1;r++)if(this._isDistanceSmallerThanSpacingCanvas(a,i[r],o))return!0;return!1}},{key:"_isDistanceSmallerThanSpacingCanvas",value:function(e,t,n){return this._compareDistanceToSpacingCanvas(e,t,n,"<")}},{key:"_isDistanceLargerThanSpacingCanvas",value:function(e,t,n){return this._compareDistanceToSpacingCanvas(e,t,n,">")}},{key:"_compareDistanceToSpacingCanvas",value:function(e,t,n){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:">",o=this.configuration;f.cornerstone.pixelToCanvas(e,t),f.cornerstone.pixelToCanvas(e,n);return">"===a?f.cornerstoneMath.point.distance(t,n)>o.spacing:f.cornerstoneMath.point.distance(t,n)<o.spacing}},{key:"_activateDraw",value:function(e){e.addEventListener(x.MOUSE_DOWN,this._drawingMouseDownCallback),e.addEventListener(x.MOUSE_MOVE,this._drawingMouseMoveCallback),e.addEventListener(x.MOUSE_DRAG,this._drawingMouseDragCallback),e.addEventListener(x.MOUSE_UP,this._drawingMouseUpCallback),f.cornerstone.updateImage(e)}},{key:"_deactivateDraw",value:function(e){e.removeEventListener(x.MOUSE_DOWN,this._drawingMouseDownCallback),e.removeEventListener(x.MOUSE_MOVE,this._drawingMouseMoveCallback),e.removeEventListener(x.MOUSE_DRAG,this._drawingMouseDragCallback),e.removeEventListener(x.MOUSE_UP,this._drawingMouseUpCallback),f.cornerstone.updateImage(e)}},{key:"_activateModify",value:function(e){e.addEventListener(x.MOUSE_UP,this._editMouseUpCallback),e.addEventListener(x.MOUSE_DRAG,this._editMouseDragCallback),e.addEventListener(x.MOUSE_CLICK,this._editMouseUpCallback),f.cornerstone.updateImage(e)}},{key:"_deactivateModify",value:function(e){e.removeEventListener(x.MOUSE_UP,this._editMouseUpCallback),e.removeEventListener(x.MOUSE_DRAG,this._editMouseDragCallback),e.removeEventListener(x.MOUSE_CLICK,this._editMouseUpCallback),f.cornerstone.updateImage(e)}},{key:"passiveCallback",value:function(e){this._closeToolIfDrawing(e)}},{key:"enabledCallback",value:function(e){this._closeToolIfDrawing(e)}},{key:"disabledCallback",value:function(e){this._closeToolIfDrawing(e)}},{key:"_closeToolIfDrawing",value:function(e){if(this._drawing){var t=this.configuration.currentHandle;this._endDrawing(e,t),f.cornerstone.updateImage(e)}}},{key:"spacing",get:function(){return this.configuration.spacing},set:function(e){if("number"!=typeof e)throw new Error("Attempting to set freehand spacing to a value other than a number.");this.configuration.spacing=e,f.cornerstone.updateImage(this.element)}},{key:"activeHandleRadius",get:function(){return this.configuration.activeHandleRadius},set:function(e){if("number"!=typeof e)throw new Error("Attempting to set freehand activeHandleRadius to a value other than a number.");this.configuration.activeHandleRadius=e,f.cornerstone.updateImage(this.element)}},{key:"completeHandleRadius",get:function(){return this.configuration.completeHandleRadius},set:function(e){if("number"!=typeof e)throw new Error("Attempting to set freehand completeHandleRadius to a value other than a number.");this.configuration.completeHandleRadius=e,f.cornerstone.updateImage(this.element)}},{key:"alwaysShowHandles",get:function(){return this.configuration.alwaysShowHandles},set:function(e){if("boolean"!=typeof e)throw new Error("Attempting to set freehand alwaysShowHandles to a value other than a boolean.");this.configuration.alwaysShowHandles=e,f.cornerstone.updateImage(this.element)}},{key:"invalidColor",get:function(){return this.configuration.invalidColor},set:function(e){this.configuration.invalidColor=e,f.cornerstone.updateImage(this.element)}}]),t}(Me);function hn(e){e.stopImmediatePropagation(),e.stopPropagation(),e.preventDefault()}var vn=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};o()(this,t);var a=Object.assign({name:"Length",supportedInteractionTypes:["Mouse","Touch"]},n);return(e=l()(this,u()(t).call(this,a))).initialConfiguration=a,e}return h()(t,e),r()(t,[{key:"createNewMeasurement",value:function(e){if(e&&e.currentPoints&&e.currentPoints.image){var t=e.currentPoints.image,n=t.x,a=t.y;return{visible:!0,active:!0,color:void 0,handles:{start:{x:n,y:a,highlight:!0,active:!1},end:{x:n,y:a,highlight:!0,active:!0},textBox:{active:!1,hasMoved:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0}}}}console.error("required eventData not supplied to tool ".concat(this.name,"'s createNewMeasurement"))}},{key:"pointNearTool",value:function(e,t,n){var a=t&&t.handles&&t.handles.start&&t.handles.end;return a||console.warn("invalid parameters supplieed to tool ".concat(this.name,"'s pointNearTool")),!(!a||!1===t.visible)&&et(e,t.handles.start,t.handles.end,n)<25}},{key:"renderToolData",value:function(e){var t=e.detail,n=Q(e.currentTarget,this.name);if(n){var a,o,i=Je(t.canvasContext.canvas),r=t.image,s=t.element,l=Ie.getToolWidth(),c=this.configuration,u=f.cornerstone.metaData.get("imagePlaneModule",r.imageId);u?(a=u.rowPixelSpacing||u.rowImagePixelSpacing,o=u.columnPixelSpacing||u.colImagePixelSpacing):(a=r.rowPixelSpacing,o=r.columnPixelSpacing);for(var d=function(e){var r=n.data[e];if(!1===r.visible)return"continue";Oe(i,function(e){$e(e,c);var n=_e.getColorIfActive(r);Le(e,s,r.handles.start,r.handles.end,{color:n});var i={drawHandlesIfActive:c&&c.drawHandlesOnHover};Be(e,t,r.handles,n,i);var u=(r.handles.end.x-r.handles.start.x)*(o||1),d=(r.handles.end.y-r.handles.start.y)*(a||1),h=Math.sqrt(u*u+d*d);if(r.length=h,!r.handles.textBox.hasMoved){var g={x:Math.max(r.handles.start.x,r.handles.end.x)};g.x===r.handles.start.x?g.y=r.handles.start.y:g.y=r.handles.end.y,r.handles.textBox.x=g.x,r.handles.textBox.y=g.y}var m=function(e,t,n){var a=" mm";t&&n||(a=" pixels");return"".concat(e.length.toFixed(2)).concat(a)}(r,a,o);Xe(e,s,r.handles.textBox,m,r.handles,v,n,l,10,!0)})},h=0;h<n.data.length;h++)d(h)}function v(e){var t={x:(e.start.x+e.end.x)/2,y:(e.start.y+e.end.y)/2};return[e.start,t,e.end]}}}]),t}(Me),gn=function(e,t,n,a,o){if(!e)throw new Error("getRGBPixels: parameter element must not be undefined");t=Math.round(t),n=Math.round(n);var i,r,s,l=f.cornerstone.getEnabledElement(e),c=[],u=0,d=l.image.getPixelData();if(l.image.color)for(r=0;r<o;r++)for(s=0;s<a;s++){var h=d[i=4*((r+n)*l.image.columns+(s+t))],v=d[i+1],g=d[i+2],m=d[i+3];c[u++]=h,c[u++]=v,c[u++]=g,c[u++]=m}return c},mn=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};o()(this,t);var a=Object.assign({name:"Probe",supportedInteractionTypes:["Mouse","Touch"]},n);return(e=l()(this,u()(t).call(this,a))).initialConfiguration=a,e}return h()(t,e),r()(t,[{key:"createNewMeasurement",value:function(e){if(e&&e.currentPoints&&e.currentPoints.image)return{visible:!0,active:!0,color:void 0,handles:{end:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!0}}};console.error("required eventData not supplieed to tool ".concat(this.name,"'s createNewMeasurement"))}},{key:"pointNearTool",value:function(e,t,n){var a=t&&t.handles&&t.handles.end;if(a||console.warn("invalid parameters supplieed to tool ".concat(this.name,"'s pointNearTool")),!a||!1===t.visible)return!1;var o=f.cornerstone.pixelToCanvas(e,t.handles.end);return f.cornerstoneMath.point.distance(o,n)<5}},{key:"renderToolData",value:function(e){var t=e.detail,n=Q(e.currentTarget,this.name);if(n)for(var a=Je(t.canvasContext.canvas),o=t.image,i=ze.getFontSize(),r=function(e){var r=n.data[e];if(!1===r.visible)return"continue";Oe(a,function(e){var n=_e.getColorIfActive(r);Be(e,t,r.handles,n);var a,s,l,c=Math.round(r.handles.end.x),u=Math.round(r.handles.end.y);if(c>=0&&u>=0&&c<o.columns&&u<o.rows){if(s="".concat(c,", ").concat(u),o.color)a=gn(t.element,c,u,1,1),l="R: ".concat(a[0]," G: ").concat(a[1]," B: ").concat(a[2]);else{var d=(a=f.cornerstone.getStoredPixels(t.element,c,u,1,1))[0],h=d*o.slope+o.intercept,v=Ht(o,d);l="SP: ".concat(d," MO: ").concat(parseFloat(h.toFixed(3))),v&&(l+=" SUV: ".concat(parseFloat(v.toFixed(3))))}var g={x:r.handles.end.x+3,y:r.handles.end.y-3},m=f.cornerstone.pixelToCanvas(t.element,g);Ke(e,l,m.x,m.y+i+5,n),Ke(e,s,m.x,m.y,n)}})},s=0;s<n.data.length;s++)r(s)}}]),t}(Me),fn=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};o()(this,t);var a=Object.assign({name:"RectangleRoi",supportedInteractionTypes:["Mouse","Touch"]},n);return(e=l()(this,u()(t).call(this,a))).initialConfiguration=a,e}return h()(t,e),r()(t,[{key:"createNewMeasurement",value:function(e){if(e&&e.currentPoints&&e.currentPoints.image)return{visible:!0,active:!0,color:void 0,invalidated:!0,handles:{start:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!1},end:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!0},textBox:{active:!1,hasMoved:!1,movesIndependently:!1,drawnIndependently:!0,allowedOutsideImage:!0,hasBoundingBox:!0}}};console.error("required eventData not supplied to tool ".concat(this.name,"'s createNewMeasurement"))}},{key:"pointNearTool",value:function(e,t,n){var a=t&&t.handles&&t.handles.start&&t.handles.end;if(a||console.warn("invalid parameters supplieed to tool ".concat(this.name,"'s pointNearTool")),!a||!1===t.visible)return!1;var o=f.cornerstone.pixelToCanvas(e,t.handles.start),i=f.cornerstone.pixelToCanvas(e,t.handles.end),r={left:Math.min(o.x,i.x),top:Math.min(o.y,i.y),width:Math.abs(o.x-i.x),height:Math.abs(o.y-i.y)};return f.cornerstoneMath.rect.distanceToPoint(r,n)<5}},{key:"renderToolData",value:function(e){var t=e.detail,n=Q(e.currentTarget,this.name);if(n){var a,o=Je(t.canvasContext.canvas),i=t.image,r=t.element,s=Ie.getToolWidth(),l=this.configuration,c=f.cornerstone.metaData.get("generalSeriesModule",i.imageId),u=f.cornerstone.metaData.get("imagePlaneModule",i.imageId),d=i.rowPixelSpacing,h=i.columnPixelSpacing;u&&(d=u.rowPixelSpacing||u.rowImagePixelSpacing,h=u.columnPixelSpacing||u.colImagePixelSpacing),c&&(a=c.modality);for(var v=function(e){var c=n.data[e];if(!1===c.visible)return"continue";Oe(o,function(e){$e(e,l);var n=_e.getColorIfActive(c);Ze(e,r,c.handles.start,c.handles.end,{color:n});var o,u,v,g={drawHandlesIfActive:l&&l.drawHandlesOnHover};if(Be(e,t,c.handles,n,g),!1===c.invalidated)u=c.meanStdDev,v=c.meanStdDevSUV,o=c.area;else{var p={left:Math.min(c.handles.start.x,c.handles.end.x),top:Math.min(c.handles.start.y,c.handles.end.y),width:Math.abs(c.handles.start.x-c.handles.end.x),height:Math.abs(c.handles.start.y-c.handles.end.y)};if(!i.color){var y=f.cornerstone.getPixels(r,p.left,p.top,p.width,p.height);u=pn(y,p),"PT"===a&&(v={mean:Ht(i,(u.mean-i.intercept)/i.slope),stdDev:Ht(i,(u.stdDev-i.intercept)/i.slope)}),u&&!isNaN(u.mean)&&(c.meanStdDev=u,c.meanStdDevSUV=v)}o=p.width*(h||1)*(p.height*(d||1)),isNaN(o)||(c.area=o),c.invalidated=!1}var x=function(e){var t=e.meanStdDev,n=e.meanStdDevSUV,o=e.area,i=[];if(t&&void 0!==t.mean){var r="";"CT"===a&&(r=" HU");var s="Mean: ".concat(Nt(t.mean.toFixed(2))).concat(r),l="StdDev: ".concat(Nt(t.stdDev.toFixed(2))).concat(r);if(n&&void 0!==n.mean){s+=" SUV: "+Nt(n.mean.toFixed(2)),l+=" SUV: "+Nt(n.stdDev.toFixed(2))}i.push(s),i.push(l)}if(o){var c=" mm".concat(String.fromCharCode(178));d&&h||(c=" pixels".concat(String.fromCharCode(178)));var u="Area: ".concat(Nt(o.toFixed(2))).concat(c);i.push(u)}return i}(c);c.handles.textBox.hasMoved||(c.handles.textBox.x=Math.max(c.handles.start.x,c.handles.end.x),c.handles.textBox.y=(c.handles.start.y+c.handles.end.y)/2),Xe(e,r,c.handles.textBox,x,c.handles,m,n,s,0,!0)})},g=0;g<n.data.length;g++)v(g)}function m(e){var t=Math.min(e.start.x,e.end.x),n=Math.min(e.start.y,e.end.y),a=Math.abs(e.start.x-e.end.x),o=Math.abs(e.start.y-e.end.y);return[{x:t+a/2,y:n},{x:t,y:n+o/2},{x:t+a/2,y:n+o},{x:t+a,y:n+o/2}]}}}]),t}(Me),pn=function(e,t){for(var n=0,a=0,o=0,i=0,r=t.top;r<t.top+t.height;r++)for(var s=t.left;s<t.left+t.width;s++)n+=e[i],a+=e[i]*e[i],o++,i++;if(0===o)return{count:o,mean:0,variance:0,stdDev:0};var l=n/o,c=a/o-l*l;return{count:o,mean:l,variance:c,stdDev:Math.sqrt(c)}},yn=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};o()(this,t);var a={name:"TextMarker",supportedInteractionTypes:["Mouse","Touch"],configuration:{markers:[],current:"",ascending:!0,loop:!1,changeTextCallback:xn}},i=Object.assign(a,n);return(e=l()(this,u()(t).call(this,i))).initialConfiguration=i,e.touchPressCallback=e._changeText.bind(ct()(ct()(e))),e.doubleClickCallback=e._changeText.bind(ct()(ct()(e))),e}return h()(t,e),r()(t,[{key:"createNewMeasurement",value:function(e){var t=this.configuration;if(t.current){var n={visible:!0,active:!0,text:t.current,color:void 0,handles:{end:{x:e.currentPoints.image.x,y:e.currentPoints.image.y,highlight:!0,active:!0,hasBoundingBox:!0}}},a={left:0,top:0,width:e.image.width,height:e.image.height};if(f.cornerstoneMath.point.insideRect(n.handles.end,a)){var o=t.markers.indexOf(t.current);return(o+=t.ascending?1:-1)>=t.markers.length?o=t.loop?0:-1:o<0&&(o=t.loop?t.markers.length:-1),t.current=t.markers[o],n}}}},{key:"pointNearTool",value:function(e,t,n){if(!1===t.visible)return!1;if(t.handles.end.boundingBox){var a=f.cornerstoneMath.rect.distanceToPoint(t.handles.end.boundingBox,n),o=ne(t.handles.end,n);return a<10||o}}},{key:"renderToolData",value:function(e){var t=e.detail,n=this.configuration,a=Q(t.element,this.name);if(a)for(var o=Je(t.canvasContext.canvas),i=function(e){var i=a.data[e];if(!1===i.visible)return"continue";var r=_e.getColorIfActive(i);Oe(o,function(e){$e(e,n);var a=f.cornerstone.pixelToCanvas(t.element,i.handles.end);i.handles.end.boundingBox=Ke(e,i.text,a.x,a.y-10,r,{centering:{x:!0,y:!0}})})},r=0;r<a.data.length;r++)i(r)}},{key:"_changeText",value:function(e){var t,n=e.detail,a=n.element,o=n.currentPoints;function i(e,t,n){!0===n?$(a,this.name,e):e.text=t,e.active=!1,f.cornerstone.updateImage(a)}var r=this.configuration,s=o.canvas,l=Q(a,this.name);if(l)for(var c=0;c<l.data.length;c++)if(t=l.data[c],this.pointNearTool(a,t,s))return t.active=!0,f.cornerstone.updateImage(a),r.changeTextCallback(t,n,i),e.stopImmediatePropagation(),e.preventDefault(),void e.stopPropagation()}}]),t}(Me),xn=function(e,t,n){n(e,prompt("Change your annotation:"))},Tn=_.modules.brush,bn=Tn.state,En=Tn.setters,Mn=function(e){function t(e){var n,a=e.name,i=e.strategies,r=e.defaultStrategy,s=e.configuration,c=e.supportedInteractionTypes,d=e.mixins;return o()(this,t),(n=l()(this,u()(t).call(this,{name:a,strategies:i,defaultStrategy:r,configuration:s,supportedInteractionTypes:c,mixins:d}))).hasCursor=!0,n.referencedToolData="brush",n._drawing=!1,n._drawingMouseUpCallback=n._drawingMouseUpCallback.bind(ct()(ct()(n))),n}return h()(t,e),r()(t,[{key:"renderBrush",value:function(e){throw new Error("Method renderBrush not implemented for ".concat(this.name,"."))}},{key:"_paint",value:function(e){throw new Error("Method _paint not implemented for ".concat(this.name,"."))}},{key:"mouseDragCallback",value:function(e){this._startPainting(e)}},{key:"preMouseDownCallback",value:function(e){return this._startPainting(e),!0}},{key:"_startPainting",value:function(e){var t=e.detail,n=t.element;this._paint(t),this._drawing=!0,this._startListeningForMouseUp(n),this._lastImageCoords=t.currentPoints.image}},{key:"mouseMoveCallback",value:function(e){var t=e.detail.currentPoints;this._lastImageCoords=t.image}},{key:"passiveCallback",value:function(e){f.cornerstone.updateImage(this.element)}},{key:"renderToolData",value:function(e){(function(e,t){return"active"===O(e,t).mode})(e.detail.element,this.name)&&this.renderBrush(e)}},{key:"_getBrushColor",value:function(e){var t=f.cornerstone.colors.getColormap(bn.colorMapId).getColor(e);return this._drawing?"rgba(".concat(t[[0]],", ").concat(t[[1]],", ").concat(t[[2]],", 1.0 )"):"rgba(".concat(t[[0]],", ").concat(t[[1]],", ").concat(t[[2]],", 0.8 )")}},{key:"_drawingMouseUpCallback",value:function(e){var t=e.detail.element;this._drawing=!1,this._mouseUpRender=!0,this._stopListeningForMouseUp(t)}},{key:"_startListeningForMouseUp",value:function(e){e.removeEventListener(x.MOUSE_UP,this._drawingMouseUpCallback),e.removeEventListener(x.MOUSE_CLICK,this._drawingMouseUpCallback),e.addEventListener(x.MOUSE_UP,this._drawingMouseUpCallback),e.addEventListener(x.MOUSE_CLICK,this._drawingMouseUpCallback),f.cornerstone.updateImage(e)}},{key:"_stopListeningForMouseUp",value:function(e){e.removeEventListener(x.MOUSE_UP,this._drawingMouseUpCallback),e.removeEventListener(x.MOUSE_CLICK,this._drawingMouseUpCallback),f.cornerstone.updateImage(e)}},{key:"nextSegmentation",value:function(){var e=this.constructor.getNumberOfColors(),t=bn.drawColorId+1;t===e&&(t=0),bn.drawColorId=t}},{key:"previousSegmentation",value:function(){var e=this.constructor.getNumberOfColors(),t=bn.drawColorId-1;t<0&&(t=e-1),bn.drawColorId=t}},{key:"increaseBrushSize",value:function(){var e=bn.radius,t=Math.floor(1.2*e);t===e&&(t+=1),En.radius(t)}},{key:"decreaseBrushSize",value:function(){var e=bn.radius,t=Math.floor(.8*e);En.radius(t)}},{key:"showSegmentationOnElement",value:function(e){var t=this._getEnabledElement(),n=t.uuid;En.brushVisibilityForElement(n,e,!0),f.cornerstone.updateImage(t.element)}},{key:"hideSegmentationOnElement",value:function(e){var t=this._getEnabledElement(),n=t.uuid;En.brushVisibilityForElement(n,e,!1),f.cornerstone.updateImage(t.element)}},{key:"showAllSegmentationsOnElement",value:function(){for(var e=this._getEnabledElement(),t=e.uuid,n=f.cornerstone.colors.getColormap(bn.colorMapId).getNumberOfColors(),a=0;a<n;a++)En.brushVisibilityForElement(t,a,!0);f.cornerstone.updateImage(e.element)}},{key:"hideAllSegmentationsOnElement",value:function(){for(var e=this._getEnabledElement(),t=e.uuid,n=f.cornerstone.colors.getColormap(bn.colorMapId).getNumberOfColors(),a=0;a<n;a++)En.brushVisibilityForElement(t,a,!1);f.cornerstone.updateImage(e.element)}},{key:"_getEnabledElement",value:function(){return f.cornerstone.getEnabledElement(this.element)}},{key:"alpha",get:function(){bn.alpha},set:function(e){var t=this._getEnabledElement();bn.alpha=e,f.cornerstone.updateImage(t.element)}},{key:"hiddenButActiveAlpha",get:function(){bn.hiddenButActiveAlpha},set:function(e){var t=this._getEnabledElement();bn.hiddenButActiveAlpha=e,f.cornerstone.updateImage(t.element)}}],[{key:"getNumberOfColors",value:function(){return f.cornerstone.colors.getColormap(bn.colorMapId).getNumberOfColors()}},{key:"getReferencedToolDataName",value:function(){return"brush"}}]),t}(Y);var Cn,wn,In,kn={drawBrushPixels:function(e,t,n){var a=arguments.length>3&&void 0!==arguments[3]&&arguments[3];e.forEach(function(e){var o,i=(o=e[0],e[1]*n+o);t[i]=a?0:1})},drawBrushOnCanvas:function(e,t,n,a){var o=f.cornerstone.pixelToCanvas(a,{x:0,y:0}),i=f.cornerstone.pixelToCanvas(a,{x:1,y:1}),r=i.x-o.x,s=i.y-o.y;Oe(t,function(t){e.forEach(function(e){var o=f.cornerstone.pixelToCanvas(a,{x:e[0],y:e[1]}),i={left:o.x,top:o.y,width:r,height:s};qe(t,i,n)})})},getCircle:function(e,t,n){var a=arguments.length>3&&void 0!==arguments[3]?arguments[3]:0,o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:0,i=Math.round(a),r=Math.round(o);if(1===e)return[[i,r]];for(var s=[],l=0,c=-e;c<=e;c++){var u=r+c;if(!(u>t||u<0))for(var d=-e;d<=e;d++){var h=i+d;h>n||h<0||d*d+c*c<e*e&&(s[l++]=[i+d,r+c])}}return s}},Pn=kn.drawBrushPixels,Sn=kn.getCircle,_n=_.modules.brush.state,On=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};o()(this,t);var a=Object.assign({name:"Brush",supportedInteractionTypes:["Mouse"],configuration:{}},n);return(e=l()(this,u()(t).call(this,a))).initialConfiguration=a,e}return h()(t,e),r()(t,[{key:"renderBrush",value:function(e){var t,n=e.detail;if(this._drawing?t=this._lastImageCoords:this._mouseUpRender?(t=this._lastImageCoords,this._mouseUpRender=!1):t=_.state.mousePositionImage,t){var a=n.image,o=a.rows,i=a.columns,r=t,s=r.x,l=r.y;if(!(s<0||s>i||l<0||l>o)){this._configuration;var c=_n.radius,u=n.canvasContext,d=n.element,h=_n.drawColorId,v=this._getBrushColor(h);u.setTransform(1,0,0,1,0,0);var g=f.cornerstone,m=g.pixelToCanvas(d,t),p=g.pixelToCanvas(d,{x:0,y:0}),y=g.pixelToCanvas(d,{x:c,y:0}),x=Math.abs(y.x-p.x);u.beginPath(),u.strokeStyle=v,u.ellipse(m.x,m.y,x,x,0,0,2*Math.PI),u.stroke()}}}},{key:"_paint",value:function(e){var t=e.element,n=e.image,a=n.rows,o=n.columns,i=e.currentPoints.image,r=i.x,s=i.y,l=Q(t,this.referencedToolData),c=!1;this._isCtrlDown(e)&&(console.log("ctrlDown"),c=!0);var u=_n.drawColorId;if(!l.data[u].pixelData){var d=new Uint8ClampedArray(e.image.width*e.image.height);l.data[u].pixelData=d}var h=l.data[u].pixelData,v=_n.radius;if(!(r<0||r>o||s<0||s>a)){var g=Sn(v,a,o,r,s);Pn(g,h,o,c),l.data[u].invalidated=!0,f.cornerstone.updateImage(e.element)}}},{key:"_isCtrlDown",value:function(e){return e.event&&e.event.ctrlKey||e.ctrlKey}}]),t}(Mn);var Dn={setStartLoadHandler:function(e){Cn=e},getStartLoadHandler:function(){return Cn},setEndLoadHandler:function(e){wn=e},getEndLoadHandler:function(){return wn},setErrorLoadingHandler:function(e){In=e},getErrorLoadingHandler:function(){return In}};function Ln(e){var t=f.cornerstoneMath;return e instanceof t.Vector3?e:new t.Vector3(e[0],e[1],e[2])}function An(e,t){var n=Ln(t.rowCosines),a=Ln(t.columnCosines),o=Ln(t.imagePositionPatient),i=e.clone().sub(o);return{x:n.dot(i)/t.columnPixelSpacing,y:a.dot(i)/t.rowPixelSpacing}}function Hn(e,t){var n=Ln(t.rowCosines),a=Ln(t.columnCosines),o=Ln(t.imagePositionPatient),i=n.clone().multiplyScalar(e.x);i.multiplyScalar(t.columnPixelSpacing);var r=a.clone().multiplyScalar(e.y);r.multiplyScalar(t.rowPixelSpacing);var s=i.add(r);return s.add(o),s}function Un(e,t){var n=Ln(e.rowCosines),a=Ln(e.columnCosines),o=Ln(e.imagePositionPatient),i=Ln(t.rowCosines),r=Ln(t.columnCosines),s=Ln(t.imagePositionPatient),l=n.clone().cross(a),c=new f.cornerstoneMath.Plane;c.setFromNormalAndCoplanarPoint(l,o);var u=i.clone().cross(r),d=new f.cornerstoneMath.Plane;d.setFromNormalAndCoplanarPoint(u,s);var h=d.clone().intersectPlane(c),v=h.origin,g=h.direction,m=Hn({x:t.columns,y:t.rows},t),p=s.distanceTo(m),y=new f.cornerstoneMath.Line3;y.start=v,y.end=v.clone().add(g.multiplyScalar(p));var x=function(e,t){var n=[];return Object.keys(t).forEach(function(a){var o=t[a],i=e.intersectLine(o);i&&n.push(i)}),n}(y,function(e){var t=Hn({x:0,y:0},e),n=Hn({x:e.columns,y:0},e),a=Hn({x:0,y:e.rows},e),o=Hn({x:e.columns,y:e.rows},e);return{top:new f.cornerstoneMath.Line3(t,n),left:new f.cornerstoneMath.Line3(t,a),right:new f.cornerstoneMath.Line3(n,o),bottom:new f.cornerstoneMath.Line3(a,o)}}(t));if(2===x.length)return{start:x[0],end:x[1]}}var Nn={};function Rn(e,t){if(!Nn[e])return{};var n=Nn[e].find(function(e){return e.element===t});return n?n.options:{}}function Bn(e,t,n){if(Nn[e]){var a=Nn[e].findIndex(function(e){return e.element===t});if(-1===a)Nn[e].push({element:t,options:n});else{var o=Nn[e][a].options||{};Nn[e][a].options=Object.assign(o,n)}}else Nn[e]=[{element:t,options:n}]}var Fn=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};o()(this,t);var a=Object.assign({name:"Crosshairs",supportedInteractionTypes:["Mouse","Touch"]},n);return(e=l()(this,u()(t).call(this,a))).initialConfiguration=a,e.mouseDownCallback=e._chooseLocation.bind(ct()(ct()(e))),e.mouseDragCallback=e._chooseLocation.bind(ct()(ct()(e))),e.touchDragCallback=e._chooseLocation.bind(ct()(ct()(e))),e}return h()(t,e),r()(t,[{key:"_chooseLocation",value:function(e){var t=e.detail,n=t.element;e.stopImmediatePropagation();var a=Q(n,this.name);if(a){var o=n,i=f.cornerstone.getEnabledElement(o).image.imageId,r=f.cornerstone.metaData.get("imagePlaneModule",i);if(r){var s=Hn(t.currentPoints.image,r);a.data[0].synchronizationContext.getSourceElements().forEach(function(e){if(e!==o){var t=Number.MAX_VALUE,n=-1,a=Q(e,"stack");if(void 0!==a){var i=a.data[0];if(i.imageIds.forEach(function(e,a){var o=f.cornerstone.metaData.get("imagePlaneModule",e);if(o&&o.imagePositionPatient&&o.rowCosines&&o.columnCosines){var i=Ln(o.imagePositionPatient),r=Ln(o.rowCosines),l=Ln(o.columnCosines).clone().cross(r.clone()),c=Math.abs(l.clone().dot(i)-l.clone().dot(s));c<t&&(t=c,n=a)}}),n!==i.currentImageIdIndex&&-1!==n&&void 0!==i.imageIds[n]){var r=Dn.getStartLoadHandler(),l=Dn.getEndLoadHandler(),c=Dn.getErrorLoadingHandler();r&&r(e),(!0===i.preventCache?f.cornerstone.loadImage(i.imageIds[n]):f.cornerstone.loadAndCacheImage(i.imageIds[n])).then(function(t){var a=f.cornerstone.getViewport(e);i.currentImageIdIndex=n,f.cornerstone.displayImage(e,t,a),l&&l(e,t)},function(t){var a=i.imageIds[n];c&&c(e,a,t)})}}}})}}}},{key:"activeCallback",value:function(e,t){var n=t.mouseButtonMask,a=t.synchronizationContext;Bn(this.name,e,{mouseButtonMask:n}),ee(e,this.name),J(e,this.name,{synchronizationContext:a})}}]),t}(Y),Vn=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};o()(this,t);var a=Object.assign({name:"DoubleTapFitToWindow",supportedInteractionTypes:["DoubleTap"]},n);return(e=l()(this,u()(t).call(this,a))).initialConfiguration=a,e}return h()(t,e),r()(t,[{key:"doubleTapCallback",value:function(e){var t=e.detail;f.cornerstone.fitToWindow(t.element)}}]),t}(Y),jn=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};o()(this,t);var a={name:"DragProbe",strategies:{default:Wn,minimal:zn},defaultStrategy:"default",supportedInteractionTypes:["Mouse","Touch"],configuration:{}},i=Object.assign(a,n);return(e=l()(this,u()(t).call(this,i))).touchDragCallback=e._movingEventCallback.bind(ct()(ct()(e))),e.touchEndCallback=e._endMovingEventCallback.bind(ct()(ct()(e))),e.mouseDragCallback=e._movingEventCallback.bind(ct()(ct()(e))),e.mouseUpCallback=e._endMovingEventCallback.bind(ct()(ct()(e))),e.initialConfiguration=i,e.dragEventData={},e}return h()(t,e),r()(t,[{key:"_movingEventCallback",value:function(e){var t=e.detail,n=t.element;this.dragEventData=t,f.cornerstone.updateImage(n)}},{key:"_endMovingEventCallback",value:function(e){var t=e.detail.element;this.dragEventData={},f.cornerstone.updateImage(t)}},{key:"renderToolData",value:function(e){this.dragEventData.currentPoints&&e&&e.detail&&Boolean(Object.keys(this.dragEventData.currentPoints).length)&&(e.detail.currentPoints=this.dragEventData.currentPoints,this.applyActiveStrategy(e))}}]),t}(Y),Wn=function(e,t){var n=f.cornerstone,a=e.detail,o=a.element,i=a.image,r=a.currentPoints,s=a.canvasContext,l=Je(s.canvas),c=_e.getActiveColor(),u=ze.getFontSize(),d=Math.round(r.image.x),h=Math.round(r.image.y);d<0||h<0||d>=i.columns||h>=i.rows||Oe(l,function(e){$e(e,t);var a,s,l="".concat(d,", ").concat(h);if(i.color)a=gn(o,d,h,1,1),s="R: ".concat(a[0]," G: ").concat(a[1]," B: ").concat(a[2]," A: ").concat(a[3]);else{var v=(a=n.getStoredPixels(o,d,h,1,1))[0],g=v*i.slope+i.intercept,m=Ht(i,v);s="SP: ".concat(v," MO: ").concat(parseFloat(g.toFixed(3))),m&&(s+=" SUV: ".concat(parseFloat(m.toFixed(3))))}var f={x:r.canvas.x+5,y:r.canvas.y-5};Ke(e,s,f.x,f.y+u+5,c),Ke(e,l,f.x,f.y,c)})},zn=function(e,t){var n=f.cornerstone,a=e.detail,o=a.element,i=a.image,r=a.currentPoints,s=a.canvasContext,l=a.isTouchEvent,c=Je(s.canvas),u=_e.getActiveColor(),d=r.page.y-ze.getFontSize()/2;l&&(d=r.page.y-4*ze.getFontSize());var h=n.pageToPixel(o,r.page.x,d);h.x<0||h.y<0||h.x>=i.columns||h.y>=i.rows||Oe(c,function(e){$e(e,t);var a,r=n.metaData.get("generalSeriesModule",i.imageId),s=r&&r.modality,c="";if(i.color)a=gn(o,h.x,h.y,1,1),c="R: ".concat(a[0]," G: ").concat(a[1]," B: ").concat(a[2]);else{var d=(a=n.getStoredPixels(o,h.x,h.y,1,1))[0],v=d*i.slope+i.intercept,g=parseFloat(v.toFixed(2));if("CT"===s)c+="HU: ".concat(g);else if("PT"===s){c+=g;var m=Ht(i,d);m&&(c+=" SUV: ".concat(parseFloat(m.toFixed(2))))}else c+=g}var f=n.pixelToCanvas(o,h),p={x:12,y:-(ze.getFontSize()+10)/2},y=Ye(e,c,5);l&&(p={x:-y/2,y:-ze.getFontSize()-10-12}),Ue(e,o,f,6,{color:u},"canvas"),Ke(e,c,f.x+p.x,f.y+p.y,u)})},Gn=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};o()(this,t);var a=Object.assign({name:"Eraser",supportedInteractionTypes:["Mouse","Touch"]},n);return(e=l()(this,u()(t).call(this,a))).initialConfiguration=a,e.preMouseDownCallback=e._deleteAllNearbyTools.bind(ct()(ct()(e))),e.preTouchStartCallback=e._deleteAllNearbyTools.bind(ct()(ct()(e))),e}return h()(t,e),r()(t,[{key:"_deleteAllNearbyTools",value:function(e){var t=e.detail.currentPoints.canvas,n=e.detail.element;k.tools.forEach(function(e){var a=Q(n,e.name);a&&a.data.forEach(function(a){"function"==typeof e.pointNearTool&&e.pointNearTool(n,a,t)&&($(n,e.name,a),f.cornerstone.updateImage(n))})});return!0}}]),t}(Y),qn=on.FreehandHandleData,Yn=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};o()(this,t);var a={name:"FreehandSculpterMouse",referencedToolName:"FreehandMouse",supportedInteractionTypes:["Mouse"],mixins:["activeOrDisabledBinaryTool"],configuration:{mouseLocation:{handles:{start:{highlight:!0,active:!0}}},minSpacing:5,maxSpacing:20,currentTool:null,dragColor:_e.getActiveColor(),hoverColor:_e.getToolColor(),showCursorOnHover:!0,limitRadiusOutsideRegion:!0,hoverCursorFadeAlpha:.5,hoverCursorFadeDistance:1.2}},i=Object.assign(a,n);return(e=l()(this,u()(t).call(this,i))).hasCursor=!0,e.initialConfiguration=i,e.referencedToolName=i.referencedToolName,e._active=!1,e.activeMouseUpCallback=e.activeMouseUpCallback.bind(ct()(ct()(e))),e.activeMouseDragCallback=e.activeMouseDragCallback.bind(ct()(ct()(e))),e}return h()(t,e),r()(t,[{key:"renderToolData",value:function(e){var t=e.detail,n=this.configuration;if(null===n.currentTool)return!1;if(this._active){var a=t.canvasContext.canvas.getContext("2d"),o={fill:null,handleRadius:this._toolSizeCanvas};Be(a,t,n.mouseLocation.handles,n.dragColor,o)}else n.showCursorOnHover&&this._renderHoverCursor(e)}},{key:"doubleClickCallback",value:function(e){var t=e.detail;this._selectFreehandTool(t),f.cornerstone.updateImage(t.element)}},{key:"preMouseDownCallback",value:function(e){var t=e.detail;return null===this.configuration.currentTool?this._selectFreehandTool(t):this._initialiseSculpting(t),f.cornerstone.updateImage(t.element),!0}},{key:"activeMouseDragCallback",value:function(e){var t=this.configuration;if(this._active){var n=e.detail,a=Q(n.element,this.referencedToolName);if(a){var o=a.data[t.currentTool].handles;this._getMouseLocation(n),this._sculpt(n,o),f.cornerstone.updateImage(n.element)}}}},{key:"activeMouseUpCallback",value:function(e){var t=e.detail,n=t.element,a=this.configuration;this._active=!1,k.isToolLocked=!1,this._getMouseLocation(t),this._invalidateToolData(t),a.mouseUpRender=!0,this._deactivateSculpt(n),f.cornerstone.updateImage(t.element),function(e){e.stopImmediatePropagation(),e.stopPropagation(),e.preventDefault()}(e)}},{key:"_renderHoverCursor",value:function(e){var t,n=e.detail,a=n.element,o=this.configuration,i=n.canvasContext.canvas.getContext("2d"),r=Q(a,this.referencedToolName).data[o.currentTool];o.mouseUpRender?(t=o.mouseLocation.handles.start,o.mouseUpRender=!1):t=k.mousePositionImage;var s=O(a,this.referencedToolName).distanceFromPointCanvas(a,r,t);if(o.mouseLocation.handles.start.x=t.x,o.mouseLocation.handles.start.y=t.y,o.limitRadiusOutsideRegion){var l=s;s=this._limitCursorRadiusCanvas(n,s),l>o.hoverCursorFadeDistance*s&&(i.globalAlpha=o.hoverCursorFadeAlpha)}var c={fill:null,handleRadius:s};Be(i,n,o.mouseLocation.handles,o.hoverColor,c),o.limitRadiusOutsideRegion&&(i.globalAlpha=1)}},{key:"newImageCallback",value:function(e){this._deselectAllTools(e)}},{key:"enabledCallback",value:function(e){this._deselectAllTools(e)}},{key:"passiveCallback",value:function(e){this._deselectAllTools(e)}},{key:"disabledCallback",value:function(e){this._deselectAllTools(e)}},{key:"_selectFreehandTool",value:function(e){var t=this.configuration,n=e.element,a=this._getClosestFreehandToolOnElement(n,e);void 0!==a&&(t.currentTool=a)}},{key:"_activateFreehandTool",value:function(e,t){var n=Q(e,this.referencedToolName).data;this.configuration.currentTool=t;for(var a=0;a<n.length;a++)n[a].active=a===t}},{key:"_initialiseSculpting",value:function(e){var t=e.element,n=this.configuration;this._active=!0,k.isToolLocked=!0,this._configureToolSize(e),this._getMouseLocation(e),this._activateFreehandTool(t,n.currentTool),this._activateSculpt(t)}},{key:"_sculpt",value:function(e,t){var n=this.configuration,a={element:e.element,image:e.image,mousePoint:e.currentPoints.image,dataHandles:t,toolSize:this._toolSizeImage,minSpacing:n.minSpacing,maxSpacing:n.maxSpacing};this._pushHandles(a),this._insertNewHandles(a),this._consolidateHandles(a)}},{key:"_pushHandles",value:function(e){for(var t=e.dataHandles,n=e.mousePoint,a=e.toolSize,o=0;o<t.length;o++){var i=f.cornerstoneMath.point.distance(t[o],n);i<a&&this._pushOneHandle(e,o,i)}}},{key:"_pushOneHandle",value:function(e,t,n){var a=e.dataHandles,o=a[t],i=e.mousePoint,r=e.toolSize,s=e.image,l=(o.x-i.x)/n,c=(o.y-i.y)/n,u={x:i.x+r*l,y:i.y+r*c};le(u,s),o.x=u.x,o.y=u.y;var d=this.constructor._getPreviousHandleIndex(t,a.length);a[d].lines.pop(),a[d].lines.push(o)}},{key:"_insertNewHandles",value:function(e){for(var t=this._findNewHandleIndicies(e),n=0,a=0;a<t.length;a++){var o=t[a]+1+n;this._insertHandleRadially(e,o),n++}}},{key:"_findNewHandleIndicies",value:function(e){for(var t=e.element,n=e.dataHandles,a=[],o=0;o<n.length;o++){var i=f.cornerstone.pixelToCanvas(t,n[o]),r=this.constructor._getNextHandleIndex(o,n.length),s=f.cornerstone.pixelToCanvas(t,n[r]);f.cornerstoneMath.point.distance(i,s)>e.maxSpacing&&a.push(o)}return a}},{key:"_insertHandleRadially",value:function(e,t){var n=e.dataHandles,a=t-1,o=this.constructor._getNextHandleIndexBeforeInsert(t,n.length),i=this.constructor._getInsertPosition(e,t,a,o),r=new qn(i);n.splice(t,0,r),n[a].lines.pop(),n[a].lines.push(n[t]),t===n.length-1?n[t].lines.push(n[0]):n[t].lines.push(n[t+1])}},{key:"_consolidateHandles",value:function(e){if(e.dataHandles.length>3){var t=this._findCloseHandlePairs(e);this._mergeCloseHandles(e,t)}}},{key:"_findCloseHandlePairs",value:function(e){for(var t=e.dataHandles,n=e.element,a=e.minSpacing,o=[],i=t.length,r=0;r<i;r++){var s=f.cornerstone.pixelToCanvas(n,t[r]),l=this.constructor._getNextHandleIndex(r,t.length),c=f.cornerstone.pixelToCanvas(n,t[l]);if(f.cornerstoneMath.point.distance(s,c)<a){var u=[r,l];o.push(u),0===r&&(i-=1),r++}}return o}},{key:"_mergeCloseHandles",value:function(e,t){for(var n=0,a=0;a<t.length;a++){var o=this.constructor._getCorrectedPair(t[a],n);this._combineHandles(e,o),n++}var i=this._findCloseHandlePairs(e);i.length&&this._mergeCloseHandles(e,i)}},{key:"_combineHandles",value:function(e,t){var n=e.dataHandles,a=e.image,o={x:(n[t[0]].x+n[t[1]].x)/2,y:(n[t[0]].y+n[t[1]].y)/2};le(o,a),n[t[0]].x=o.x,n[t[0]].y=o.y;var i=this.constructor._getNextHandleIndex(t[1],n.length);n[t[0]].lines.pop(),n[t[0]].lines.push(n[i]),n.splice(t[1],1)}},{key:"_configureToolSize",value:function(e){var t=e.element,n=this.configuration,a=n.currentTool,o=e.currentPoints.image,i=Q(t,this.referencedToolName).data[a],r=O(t,this.referencedToolName),s=r.distanceFromPoint(t,i,o),l=r.distanceFromPointCanvas(t,i,o);n.limitRadiusOutsideRegion&&(s=this._limitCursorRadiusImage(e,s),l=this._limitCursorRadiusCanvas(e,l)),this._toolSizeImage=s,this._toolSizeCanvas=l}},{key:"_getMouseLocation",value:function(e){var t=this.configuration;t.mouseLocation.handles.start.x=e.currentPoints.image.x,t.mouseLocation.handles.start.y=e.currentPoints.image.y,le(t.mouseLocation.handles.start,e.image)}},{key:"_activateSculpt",value:function(e){this._deactivateSculpt(e),e.addEventListener(x.MOUSE_UP,this.activeMouseUpCallback),e.addEventListener(x.MOUSE_CLICK,this.activeMouseUpCallback),e.addEventListener(x.MOUSE_DRAG,this.activeMouseDragCallback),f.cornerstone.updateImage(e)}},{key:"_deactivateSculpt",value:function(e){e.removeEventListener(x.MOUSE_UP,this.activeMouseUpCallback),e.removeEventListener(x.MOUSE_CLICK,this.activeMouseUpCallback),e.removeEventListener(x.MOUSE_DRAG,this.activeMouseDragCallback),f.cornerstone.updateImage(e)}},{key:"_invalidateToolData",value:function(e){var t=this.configuration;Q(e.element,this.referencedToolName).data[t.currentTool].invalidated=!0}},{key:"_deselectAllTools",value:function(e){var t=this.configuration,n=Q(this.element,this.referencedToolName);if(t.currentTool=null,n)for(var a=0;a<n.data.length;a++)n.data[a].active=!1;f.cornerstone.updateImage(this.element)}},{key:"_limitCursorRadiusCanvas",value:function(e,t){return this._limitCursorRadius(e,t,!0)}},{key:"_limitCursorRadiusImage",value:function(e,t){return this._limitCursorRadius(e,t,!1)}},{key:"_limitCursorRadius",value:function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=e.element,o=e.image,i=this.configuration,r=Q(a,this.referencedToolName).data[i.currentTool],s=1;if(n){var l=f.cornerstone.pixelToCanvas(a,{x:0,y:0}),c=f.cornerstone.pixelToCanvas(a,{x:o.width,y:o.height});s=(c.x-l.x)*(c.y-l.y)/(o.width*o.height)}var u=r.area*s,d=Math.pow(u/Math.PI,.5);return Math.min(t,d)}},{key:"_getClosestFreehandToolOnElement",value:function(e,t){var n=O(e,this.referencedToolName),a=Q(e,this.referencedToolName);if(a){for(var o=a.data,i=t.currentPoints.image,r={distance:1/0,toolIndex:null},s=0;s<o.length;s++){var l=n.distanceFromPoint(e,o[s],i);-1!==l&&(l<r.distance&&(r.distance=l,r.toolIndex=s))}return r.toolIndex}}},{key:"minSpacing",get:function(){return this.configuration.minSpacing},set:function(e){if("number"!=typeof e)throw new Error("Attempting to set freehandSculpter minSpacing to a value other than a number.");this.configuration.minSpacing=e}},{key:"maxSpacing",get:function(){return this.configuration.maxSpacing},set:function(e){if("number"!=typeof e)throw new Error("Attempting to set freehandSculpter maxSpacing to a value other than a number.");this.configuration.maxSpacing=e}},{key:"showCursorOnHover",get:function(){return this.configuration.showCursorOnHover},set:function(e){if("boolean"!=typeof e)throw new Error("Attempting to set freehandSculpter showCursorOnHover to a value other than a boolean.");this.configuration.showCursorOnHover=e,f.cornerstone.updateImage(this.element)}},{key:"limitRadiusOutsideRegion",get:function(){return this.configuration.limitRadiusOutsideRegion},set:function(e){if("boolean"!=typeof e)throw new Error("Attempting to set freehandSculpter limitRadiusOutsideRegion to a value other than a boolean.");this.configuration.limitRadiusOutsideRegion=e,f.cornerstone.updateImage(this.element)}},{key:"hoverCursorFadeAlpha",get:function(){return this.configuration.hoverCursorFadeAlpha},set:function(e){if("number"!=typeof e)throw new Error("Attempting to set freehandSculpter hoverCursorFadeAlpha to a value other than a number.");e=Math.max(Math.min(e,1),0),this.configuration.hoverCursorFadeAlpha=e,f.cornerstone.updateImage(this.element)}},{key:"hoverCursorFadeDistance",get:function(){return this.configuration.hoverCursorFadeDistance},set:function(e){if("number"!=typeof e)throw new Error("Attempting to set freehandSculpter hoverCursorFadeDistance to a value other than a number.");e=Math.max(e,1),this.configuration.hoverCursorFadeDistance=e,f.cornerstone.updateImage(this.element)}}],[{key:"_getCorrectedPair",value:function(e,t){var n=[e[0]-t,e[1]-t];return n[1]<0&&(n[1]=0),n}},{key:"_getNextHandleIndex",value:function(e,t){return e===t-1?0:e+1}},{key:"_getPreviousHandleIndex",value:function(e,t){return 0===e?t-1:e-1}},{key:"_getNextHandleIndexBeforeInsert",value:function(e,t){return e===t?0:e}},{key:"_getInsertPosition",value:function(e,t,n,a){var o,i=e.toolSize,r=e.mousePoint,s=e.dataHandles,l=e.image,c={x:(s[n].x+s[a].x)/2,y:(s[n].y+s[a].y)/2},u=f.cornerstoneMath.point.distance(r,c);if(u<i){var d={x:(c.x-r.x)/u,y:(c.y-r.y)/u};o={x:r.x+i*d.x,y:r.y+i*d.y}}else o=c;return le(o,l),o}}]),t}(Y);var Kn=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};o()(this,t);var a=Object.assign({name:"Magnify",supportedInteractionTypes:["Mouse","Touch"],configuration:{magnifySize:300,magnificationLevel:2}},n);return(e=l()(this,u()(t).call(this,a))).initialConfiguration=a,e.zoomCanvas=void 0,e.zoomElement=void 0,e.activeCallback=e._createMagnificationCanvas.bind(ct()(ct()(e))),e.enabledCallback=e._createMagnificationCanvas.bind(ct()(ct()(e))),e.disabledCallback=e._destroyMagnificationCanvas.bind(ct()(ct()(e))),e.postTouchStartCallback=e._addMagnifyingGlass.bind(ct()(ct()(e))),e.touchDragCallback=e._updateMagnifyingGlass.bind(ct()(ct()(e))),e.touchEndCallback=e._removeMagnifyingGlass.bind(ct()(ct()(e))),e.touchDragEndCallback=e._removeMagnifyingGlass.bind(ct()(ct()(e))),e.postMouseDownCallback=e._addMagnifyingGlass.bind(ct()(ct()(e))),e.mouseDragCallback=e._updateMagnifyingGlass.bind(ct()(ct()(e))),e.mouseUpCallback=e._removeMagnifyingGlass.bind(ct()(ct()(e))),e.mouseClickCallback=e._removeMagnifyingGlass.bind(ct()(ct()(e))),e.newImageCallback=e._drawMagnificationTool.bind(ct()(ct()(e))),e}return h()(t,e),r()(t,[{key:"_addMagnifyingGlass",value:function(e){var t=this;this._removeZoomElement(),this._drawZoomedElement(e),window.requestAnimationFrame(function(){return t._drawMagnificationTool(e)}),e.preventDefault(),e.stopPropagation()}},{key:"_updateMagnifyingGlass",value:function(e){this._drawMagnificationTool(e),e.preventDefault(),e.stopPropagation()}},{key:"_removeMagnifyingGlass",value:function(e){e.detail.element.querySelector(".magnifyTool").style.display="none",document.body.style.cursor="default",this._removeZoomElement()}},{key:"_drawMagnificationTool",value:function(e){var t=e.detail.element,n=t.querySelector(".magnifyTool");if(n||this._createMagnificationCanvas(t),void 0!==this.zoomCanvas){var a=t.querySelector("canvas:not(.magnifyTool)"),o=Je(n),i=f.cornerstone.pixelToCanvas(e.detail.element,e.detail.currentPoints.image),r=Math.min(this.configuration.magnifySize,a.width,a.height),s=this.configuration.magnificationLevel;n.width=r,n.height=r,i.x=Math.max(i.x,.5*r/s),i.x=Math.min(i.x,a.width-.5*r/s),i.y=Math.max(i.y,.5*r/s),i.y=Math.min(i.y,a.height-.5*r/s);var l={x:i.x*s-.5*r,y:i.y*s-.5*r};l.x=Math.max(l.x,0),l.y=Math.max(l.y,0),o.drawImage(this.zoomCanvas,l.x,l.y,r,r,0,0,r,r);var c=e.detail.isTouchEvent?120:0,u={top:Math.max(i.y-.5*r-c,0),left:Math.max(i.x-.5*r,0)},d=n.getBoundingClientRect();u.top=Math.min(u.top,a.height-d.height),u.left=Math.min(u.left,a.width-d.width),n.style.top="".concat(u.top,"px"),n.style.left="".concat(u.left,"px"),n.style.display="block",document.body.style.cursor="none"}}},{key:"_drawZoomedElement",value:function(e){var t=e.detail.element,n=e.detail.enabledElement;void 0===n&&(n=f.cornerstone.getEnabledElement(t));var a=this.configuration.magnificationLevel,o=n.canvas,i=n.image;this.zoomElement=document.createElement("div"),this.zoomElement.width=o.width*a,this.zoomElement.height=o.height*a,f.cornerstone.enable(this.zoomElement);var r=f.cornerstone.getEnabledElement(this.zoomElement),s=f.cornerstone.getViewport(n.element);this.zoomCanvas=r.canvas,this.zoomCanvas.width=o.width*a,this.zoomCanvas.height=o.height*a,r.viewport=Object.assign({},s),s.scale*=a,f.cornerstone.displayImage(this.zoomElement,i),f.cornerstone.setViewport(this.zoomElement,s)}},{key:"_removeZoomElement",value:function(){void 0!==this.zoomElement&&(f.cornerstone.disable(this.zoomCanvas),this.zoomElement=void 0,this.zoomCanvas=void 0)}},{key:"_createMagnificationCanvas",value:function(e){if(null===e.querySelector(".magnifyTool")){var t=document.createElement("canvas");t.classList.add("magnifyTool"),t.width=this.configuration.magnifySize,t.height=this.configuration.magnifySize,t.style.position="absolute",t.style.display="none",e.appendChild(t)}}},{key:"_destroyMagnificationCanvas",value:function(e){var t=e.detail.element,n=t.querySelector(".magnifyTool");n&&t.removeChild(n)}}]),t}(Y),Xn=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};o()(this,t);var a=Object.assign({name:"PanMultiTouch",supportedInteractionTypes:["MultiTouch"],configuration:{touchPointers:2}},n);return(e=l()(this,u()(t).call(this,a))).initialConfiguration=a,e.multiTouchDragCallback=e._dragCallback.bind(ct()(ct()(e))),e}return h()(t,e),r()(t,[{key:"_dragCallback",value:function(e){var t=e.detail,n=t.element,a=t.viewport;if(t.numPointers===this.configuration.touchPointers){var o=this._getTranslation(t);this._applyTranslation(a,o),f.cornerstone.setViewport(n,a)}}},{key:"_getTranslation",value:function(e){var t=e.viewport,n=e.image,a=e.deltaPoints,o=t.scale,i=t.scale;return n.rowPixelSpacing<n.columnPixelSpacing?o*=n.columnPixelSpacing/n.rowPixelSpacing:n.columnPixelSpacing<n.rowPixelSpacing&&(i*=n.rowPixelSpacing/n.columnPixelSpacing),{x:a.page.x/o,y:a.page.y/i}}},{key:"_applyTranslation",value:function(e,t){e.translation.x+=t.x,e.translation.y+=t.y}}]),t}(Y),Zn=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};o()(this,t);var a=Object.assign({name:"Pan",supportedInteractionTypes:["Mouse","Touch"]},n);return(e=l()(this,u()(t).call(this,a))).initialConfiguration=a,e.touchDragCallback=e._dragCallback.bind(ct()(ct()(e))),e.mouseDragCallback=e._dragCallback.bind(ct()(ct()(e))),e}return h()(t,e),r()(t,[{key:"_dragCallback",value:function(e){var t=e.detail,n=t.element,a=t.viewport,o=this._getTranslation(t);this._applyTranslation(a,o),f.cornerstone.setViewport(n,a)}},{key:"_getTranslation",value:function(e){var t=e.viewport,n=e.image,a=e.deltaPoints,o=t.scale,i=t.scale;return n.rowPixelSpacing<n.columnPixelSpacing?o*=n.columnPixelSpacing/n.rowPixelSpacing:n.columnPixelSpacing<n.rowPixelSpacing&&(i*=n.rowPixelSpacing/n.columnPixelSpacing),{x:a.page.x/o,y:a.page.y/i}}},{key:"_applyTranslation",value:function(e,t){e.translation.x+=t.x,e.translation.y+=t.y}}]),t}(Y),Jn=n(7),Qn=n.n(Jn),$n=n(8),ea=n.n($n),ta=function(e,t,n,a){var o=f.cornerstone,i=o.getEnabledElement(n).image,r=o.getEnabledElement(a).image;if(i&&r){var s=o.metaData.get("imagePlaneModule",i.imageId),l=o.metaData.get("imagePlaneModule",r.imageId);if(s&&l&&s.rowCosines&&s.columnCosines&&s.imagePositionPatient&&l.rowCosines&&l.columnCosines&&l.imagePositionPatient&&s.frameOfReferenceUID===l.frameOfReferenceUID){s.rowCosines=Ln(s.rowCosines),s.columnCosines=Ln(s.columnCosines),s.imagePositionPatient=Ln(s.imagePositionPatient),l.rowCosines=Ln(l.rowCosines),l.columnCosines=Ln(l.columnCosines),l.imagePositionPatient=Ln(l.imagePositionPatient);var c=s.rowCosines.clone().cross(s.columnCosines),u=l.rowCosines.clone().cross(l.columnCosines),d=c.angleTo(u);if(!((d=Math.abs(d))<.5)){var h=function(e,t){var n=Un(e,t);if(n)return{start:An(n.start,e),end:An(n.end,e)}}(s,l);if(h){var v=_e.getActiveColor();e.setTransform(1,0,0,1,0,0),Oe(e,function(e){Le(e,t.element,h.start,h.end,{color:v})})}}}}},na=function(e){return new Promise(function(t){return setTimeout(t,e)})};function aa(e){try{var t=f.cornerstone.getEnabledElement(e);return t.image?t:na(250).then(function(){return aa(e)})}catch(e){return null}}var oa,ia=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};o()(this,t);var a={name:"ReferenceLines",mixins:["enabledOrDisabledBinaryTool"],configuration:{renderer:ta}},i=Object.assign(a,n);return(e=l()(this,u()(t).call(this,i))).initialConfiguration=i,e.renderer=null,e.synchronizationContext=null,e}var n;return h()(t,e),r()(t,[{key:"enabledCallback",value:(n=ea()(Qn.a.mark(function e(t){var n,a,o,i=arguments;return Qn.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return n=i.length>1&&void 0!==i[1]?i[1]:{},a=n.synchronizationContext,o=this.configuration.renderer,e.next=4,aa(t);case 4:if(e.sent&&o&&a){e.next=8;break}return console.warn("Unable to enable ".concat(this.name,". Exiting enable callback. Tool will be enabled, but will not render.")),e.abrupt("return");case 8:this.renderer=o,this.synchronizationContext=a,this.forceImageUpdate(t);case 11:case"end":return e.stop()}},e,this)})),function(e){return n.apply(this,arguments)})},{key:"disabledCallback",value:function(e){this.forceImageUpdate(e)}},{key:"forceImageUpdate",value:function(e){f.cornerstone.getEnabledElement(e).image&&f.cornerstone.updateImage(e)}},{key:"renderToolData",value:function(e){var t=this,n=e.detail;if(this.renderer&&this.synchronizationContext){var a=this.synchronizationContext.getSourceElements(),o=Je(n.canvasContext.canvas);f.cornerstone.setToPixelCoordinateSystem(n.enabledElement,o),a.forEach(function(a){a!==e.currentTarget&&t.renderer(o,n,e.currentTarget,a)})}}}]),t}(Y),ra=function(e,t,n){var a=Math.sqrt(Math.pow(e.x-t.x,2)+Math.pow(e.y-t.y,2)),o=Math.sqrt(Math.pow(e.x-n.x,2)+Math.pow(e.y-n.y,2)),i=Math.sqrt(Math.pow(t.x-n.x,2)+Math.pow(t.y-n.y,2));return{angle:180*Math.acos((Math.pow(a,2)+Math.pow(o,2)-Math.pow(i,2))/(2*a*o))/Math.PI,direction:(t.x-e.x)*(n.y-e.y)-(t.y-e.y)*(n.x-e.x)}},sa=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};o()(this,t);var a={name:"Rotate",strategies:{default:la,horizontal:ca,vertical:ua},defaultStrategy:"default",supportedInteractionTypes:["Mouse","Touch"]},i=Object.assign(a,n);return(e=l()(this,u()(t).call(this,i))).initialConfiguration=i,e}return h()(t,e),r()(t,[{key:"touchDragCallback",value:function(e){this.dragCallback(e)}},{key:"mouseDragCallback",value:function(e){this.dragCallback(e)}},{key:"postMouseDownCallback",value:function(e){this.initialRotation=e.detail.viewport.rotation}},{key:"dragCallback",value:function(e){e.detail.viewport.initialRotation=this.initialRotation,this.applyActiveStrategy(e,this.configuration),f.cornerstone.setViewport(e.detail.element,e.detail.viewport)}}]),t}(Y),la=function(e){var t=e.detail,n=t.element,a=t.viewport,o=a.initialRotation,i=n.getBoundingClientRect(n),r=n.clientWidth,s=n.clientHeight,l={x:t.startPoints.client.x,y:t.startPoints.client.y},c=a.scale,u=a.translation,d={x:i.left+r/2+u.x*c,y:i.top+s/2+u.y*c},h={x:t.currentPoints.client.x,y:t.currentPoints.client.y},v=ra(d,l,h);v.direction<0&&(v.angle=-v.angle),a.rotation=o+v.angle},ca=function(e){var t=e.detail,n=t.viewport,a=t.deltaPoints;n.rotation+=a.page.x/n.scale},ua=function(e){var t=e.detail,n=t.viewport,a=t.deltaPoints;n.rotation+=a.page.y/n.scale},da=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};o()(this,t);var a=Object.assign({name:"RotateTouch",supportedInteractionTypes:["TouchRotate"]},n);return(e=l()(this,u()(t).call(this,a))).initialConfiguration=a,e}return h()(t,e),r()(t,[{key:"touchRotateCallback",value:function(e){var t=e.detail,n=t.element,a=t.viewport,o=t.rotation;a.rotation+=o,f.cornerstone.setViewport(n,a)}}]),t}(Y),ha=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};o()(this,t);var a=Object.assign({name:"ScaleOverlay",configuration:{minorTickLength:12.5,majorTickLength:25},mixins:["enabledOrDisabledBinaryTool"]},n);return(e=l()(this,u()(t).call(this,a))).initialConfiguration=a,e}return h()(t,e),r()(t,[{key:"enabledCallback",value:function(e){this.forceImageUpdate(e)}},{key:"disabledCallback",value:function(e){this.forceImageUpdate(e)}},{key:"forceImageUpdate",value:function(e){f.cornerstone.getEnabledElement(e).image&&f.cornerstone.updateImage(e)}},{key:"renderToolData",value:function(e){var t=e.detail,n=Je(t.canvasContext.canvas),a=t.image,o=t.viewport,i=t.element,r=a.rowPixelSpacing,s=a.columnPixelSpacing,l=f.cornerstone.metaData.get("imagePlaneModule",a.imageId);if(l&&(r=l.rowPixelSpacing||l.rowImagePixelSpacing,s=l.columnPixelSpacing||l.colImagePixelSpacing),r&&s){var c={width:n.canvas.width,height:n.canvas.height},u=10/r*o.scale,d=10/s*o.scale,h=va(c,.25,.05),v=va(c,.05,.15);if(c.width&&c.height&&h&&v){var g=_e.getToolColor(),m=Ie.getToolWidth(),p=Object.assign({},{hscaleBounds:h,vscaleBounds:v,verticalMinorTick:u,horizontalMinorTick:d,verticalLine:{start:{x:v.bottomRight.x,y:v.topLeft.y},end:{x:v.bottomRight.x,y:v.bottomRight.y}},horizontalLine:{start:{x:h.topLeft.x,y:h.bottomRight.y},end:{x:h.bottomRight.x,y:h.bottomRight.y}},color:g,lineWidth:m},this.configuration);Oe(n,function(e){$e(e,p),Le(e,i,p.verticalLine.start,p.verticalLine.end,{color:g,lineWidth:m},"canvas"),ga(e,i,p),Le(e,i,p.horizontalLine.start,p.horizontalLine.end,{color:g,lineWidth:m},"canvas"),ma(e,i,p)})}}else console.warn("unable to define rowPixelSpacing or colPixelSpacing from data on ".concat(this.name,"'s renderToolData"))}}]),t}(Y),va=function(e,t,n){var a=t*Math.min(1e3,e.width),o=n*Math.min(1e3,e.height),i={left:a,top:o,width:e.width-2*a,height:e.height-2*o};return{topLeft:{x:i.left,y:i.top},bottomRight:{x:i.left+i.width,y:i.top+i.height}}},ga=function(e,t,n){for(var a=0;n.verticalLine.start.y+a*n.verticalMinorTick<=n.vscaleBounds.bottomRight.y;){var o=n.color,i=n.lineWidth,r={x:n.verticalLine.start.x,y:n.verticalLine.start.y+a*n.verticalMinorTick},s={x:0,y:n.verticalLine.start.y+a*n.verticalMinorTick};s.x=a%5==0?n.verticalLine.start.x-n.majorTickLength:n.verticalLine.start.x-n.minorTickLength,Le(e,t,r,s,{color:o,lineWidth:i},"canvas"),a++}},ma=function(e,t,n){for(var a=0;n.horizontalLine.start.x+a*n.horizontalMinorTick<=n.hscaleBounds.bottomRight.x;){var o=n.color,i=n.lineWidth,r={x:n.horizontalLine.start.x+a*n.horizontalMinorTick,y:n.horizontalLine.start.y},s={x:n.horizontalLine.start.x+a*n.horizontalMinorTick,y:0};s.y=a%5==0?n.horizontalLine.start.y-n.majorTickLength:n.horizontalLine.start.y-n.minorTickLength,Le(e,t,r,s,{color:o,lineWidth:i},"canvas"),a++}},fa={default:6,IE:{9:6,10:8,default:8},Firefox:{default:6},Opera:{10:8,11:6,12:6,default:6},Chrome:{default:6},Safari:{default:6}};function pa(){var e,t=navigator.userAgent,n=t.match(/(opera|chrome|safari|firefox|msie|trident(?=\/))\/?\s*(\d+)/i)||[];return/trident/i.test(n[1])?(e=/\brv[ :]+(\d+)/g.exec(t)||[],"IE ".concat(e[1]||"")):"Chrome"===n[1]&&null!==(e=t.match(/\b(OPR|Edge)\/(\d+)/))?e.slice(1).join(" ").replace("OPR","Opera"):(n=n[2]?[n[1],n[2]]:[navigator.appName,navigator.appVersion,"-?"],null!==(e=t.match(/version\/(\d+)/i))&&n.splice(1,1,e[1]),n.join(" "))}function ya(){return oa||xa()}function xa(){var e=pa().split(" "),t=e[0],n=e[1],a=fa[t];return a?a[n]?a[n]:a.default:fa.default}var Ta={interaction:[],thumbnail:[],prefetch:[]},ba={interaction:0,thumbnail:0,prefetch:0},Ea={interaction:6,thumbnail:6,prefetch:5},Ma=!1,Ca=5;function wa(){Ma&&setTimeout(function(){ka()},Ca)}function Ia(e){var t=f.cornerstone,n=e.type;ba[n]++,Ma=!0;var a=e.imageId,o=e.doneCallback,i=e.failCallback,r=t.imageCache.getImageLoadObject(a);if(r)r.promise.then(function(e){ba[n]--,o(e),wa()},function(e){ba[n]--,i(e),wa()});else{var s=function(e){return"prefetch"===e.type?-5:"interactive"===e.type?0:"thumbnail"===e.type?5:void 0}(e);(!0===e.preventCache?t.loadImage(a,{priority:s,type:e.type}):t.loadAndCacheImage(a,{priority:s,type:e.type})).then(function(e){ba[n]--,o(e),wa()},function(e){ba[n]--,i(e),wa()})}}function ka(){var e=ya();Ea={interaction:Math.max(e,1),thumbnail:Math.max(e-2,1),prefetch:Math.max(e-1,1)};for(var t=e-(ba.interaction+ba.thumbnail+ba.prefetch),n=0;n<t;n++){var a=Pa();a&&Ia(a)}}function Pa(){return Ta.interaction.length&&ba.interaction<Ea.interaction?Ta.interaction.shift():Ta.thumbnail.length&&ba.thumbnail<Ea.thumbnail?Ta.thumbnail.shift():Ta.prefetch.length&&ba.prefetch<Ea.prefetch?Ta.prefetch.shift():(Ta.interaction.length||Ta.thumbnail.length||Ta.prefetch.length||(Ma=!1),!1)}var Sa,_a={addRequest:function(e,t,n,a,o,i,r){if(!Ta.hasOwnProperty(n))throw new Error("Request type must be one of interaction, thumbnail, or prefetch");if(e&&t){var s={type:n,imageId:t,preventCache:a,doneCallback:o,failCallback:i},l=f.cornerstone.imageCache.getImageLoadObject(t);l?l.promise.then(function(e){o(e)},function(e){i(e)}):(r?Ta[n].unshift(s):Ta[n].push(s),Ma=!0)}},clearRequestStack:function(e){if(!Ta.hasOwnProperty(e))throw new Error("Request type must be one of interaction, thumbnail, or prefetch");Ta[e]=[]},startGrabbing:ka,getRequestPool:function(){return Ta}},Oa=function(e,t){var n=Q(e,"stack");if(n&&n.data&&n.data.length){var a,o=f.cornerstone;if(n.data.length>1){var i=Q(e,"stackRenderer");i&&i.data&&i.data.length&&(a=i.data[0])}var r=n.data[0];t<0&&(t+=r.imageIds.length);var s=Dn.getStartLoadHandler(),l=Dn.getEndLoadHandler(),c=Dn.getErrorLoadingHandler();if(t!==r.currentImageIdIndex){s&&s(e);var u={newImageIdIndex:t,direction:t-r.currentImageIdIndex};r.currentImageIdIndex=t;var d=r.imageIds[t],h=Boolean(r.preventCache),v=o.imageCache.getImageLoadObject(d);if(v&&v.promise)v.promise.then(g,m);else{clearTimeout(Sa),Sa=setTimeout(function(){_a.addRequest(e,d,"interaction",h,g,m,!0),_a.startGrabbing()},50)}T(e,x.STACK_SCROLL,u)}}function g(i){if(r.currentImageIdIndex===t){try{o.getEnabledElement(e)}catch(e){return}a?(a.currentImageIdIndex=t,a.render(e,n.data)):o.displayImage(e,i),l&&l(e,i)}}function m(n){var a=r.imageIds[t];c&&c(e,a,n)}},Da=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2],a=!(arguments.length>3&&void 0!==arguments[3])||arguments[3],o=Q(e,"stack");if(o&&o.data&&o.data.length){var i=o.data[0];i.pending||(i.pending=[]);var r=i.currentImageIdIndex+t;if(n)r%=i.imageIds.length;else r=se(r,0,i.imageIds.length-1);if(a)Oa(e,r);else{var s={index:r};i.pending.push(s),function e(t,n,a){if(t.pending[0]===n){if(t.currentImageIdIndex===n.index)return t.pending.splice(t.pending.indexOf(n),1),void(t.pending.length>0&&e(t,t.pending[0],a));a.addEventListener(f.cornerstone.EVENTS.NEW_IMAGE,function e(o){t.imageIds.indexOf(o.detail.image.imageId)===n.index&&(t.pending.splice(t.pending.indexOf(n),1),a.removeEventListener(f.cornerstone.EVENTS.NEW_IMAGE,e),t.pending.length>0&&function e(t,n,a){if(t.pending[0]===n){if(t.currentImageIdIndex===n.index)return t.pending.splice(t.pending.indexOf(n),1),void(t.pending.length>0&&e(t,t.pending[0],a));a.addEventListener(f.cornerstone.EVENTS.NEW_IMAGE,function o(i){t.imageIds.indexOf(i.detail.image.imageId)===n.index&&(t.pending.splice(t.pending.indexOf(n),1),a.removeEventListener(f.cornerstone.EVENTS.NEW_IMAGE,o),t.pending.length>0&&e(t,t.pending[0],a))}),Oa(a,n.index)}}(t,t.pending[0],a))}),Oa(a,n.index)}}(i,s,e)}}};function La(e,t,n){if(e.pending[0]===t){if(e.currentImageIdIndex===t.index){e.pending.splice(e.pending.indexOf(t),1);if(e.pending.length>0){La(e,e.pending[0],n)}return}var a=function a(o){var i;if(e.imageIds.indexOf(o.detail.image.imageId)===t.index){e.pending.splice(e.pending.indexOf(t),1);n.removeEventListener(f.cornerstone.EVENTS.NEW_IMAGE,a);if(e.pending.length>0){La(e,e.pending[0],n)}}};n.addEventListener(f.cornerstone.EVENTS.NEW_IMAGE,a);Oa(n,t.index)}}var Aa=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};o()(this,t);var a=Object.assign({name:"StackScrollMouseWheel",supportedInteractionTypes:["MouseWheel"],configuration:{loop:!1,allowSkipping:!0}},n);return(e=l()(this,u()(t).call(this,a))).initialConfiguration=a,e}return h()(t,e),r()(t,[{key:"mouseWheelCallback",value:function(e){var t=e.detail,n=t.direction,a=t.element,o=this.configuration,i=o.loop,r=o.allowSkipping;Da(a,-n,i,r)}}]),t}(Y),Ha=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};o()(this,t);var a=Object.assign({name:"StackScrollMultiTouch",supportedInteractionTypes:["MultiTouch"],configuration:{loop:!1,allowSkipping:!0,touchPointers:3}},n);return(e=l()(this,u()(t).call(this,a))).initialConfiguration=a,e.multiTouchDragCallback=e._dragCallback.bind(ct()(ct()(e))),e}return h()(t,e),r()(t,[{key:"_dragCallback",value:function(e){var t=e.detail;if(t.numPointers===this.configuration.touchPointers){var n=t.element,a=t.deltaPoints,o=this.configuration,i=o.loop,r=o.allowSkipping,s=Rn(this.name,n),l=this._getPixelPerImage(n),c=this._getDeltaY(n,a.page.y);if(!l)return;if(Math.abs(c)>=l){var u=Math.round(c/l);Da(n,u,i,r),s.deltaY=c%l}else s.deltaY=c;Bn(this.name,n,s)}}},{key:"_getDeltaY",value:function(e,t){return(Rn(this.name,e).deltaY||0)+t}},{key:"_getPixelPerImage",value:function(e){var t=Q(e,"stack");if(t&&t.data&&t.data.length){var n=t.data[0];return this.configuration.stackScrollSpeed||Math.max(2,e.offsetHeight/Math.max(n.imageIds.length,8))}}}]),t}(Y),Ua=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};o()(this,t);var a=Object.assign({name:"StackScroll",supportedInteractionTypes:["Mouse","Touch"],configuration:{loop:!1,allowSkipping:!0}},n);return(e=l()(this,u()(t).call(this,a))).initialConfiguration=a,e.mouseDragCallback=e._dragCallback.bind(ct()(ct()(e))),e.touchDragCallback=e._dragCallback.bind(ct()(ct()(e))),e}return h()(t,e),r()(t,[{key:"_dragCallback",value:function(e){var t=e.detail,n=t.element,a=t.deltaPoints,o=this.configuration,i=o.loop,r=o.allowSkipping,s=Rn(this.name,n),l=this._getPixelPerImage(n),c=this._getDeltaY(n,a.page.y);if(l){if(Math.abs(c)>=l){var u=Math.round(c/l);Da(n,u,i,r),s.deltaY=c%l}else s.deltaY=c;Bn(this.name,n,s)}}},{key:"_getDeltaY",value:function(e,t){return(Rn(this.name,e).deltaY||0)+t}},{key:"_getPixelPerImage",value:function(e){var t=Q(e,"stack");if(t&&t.data&&t.data.length){var n=t.data[0];return this.configuration.stackScrollSpeed||Math.max(2,e.offsetHeight/Math.max(n.imageIds.length,8))}}}]),t}(Y),Na=function(e,t,n,a,o){if(!e)throw new Error("getLuminance: parameter element must not be undefined");t=Math.round(t),n=Math.round(n);var i,r,s,l=f.cornerstone.getEnabledElement(e).image,c=[],u=0,d=l.getPixelData();if(l.color)for(r=0;r<o;r++)for(s=0;s<a;s++){var h=d[i=4*((r+n)*l.columns+(s+t))],v=d[i+1],g=d[i+2];c[u++]=.2126*h+.7152*v+.0722*g}else for(r=0;r<o;r++)for(s=0;s<a;s++)i=(r+n)*l.columns+(s+t),c[u++]=d[i]*l.slope+l.intercept;return c},Ra=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};o()(this,t);var a=Object.assign({name:"WwwcRegion",supportedInteractionTypes:["Mouse","Touch"],configuration:{minWindowWidth:10}},n);return(e=l()(this,u()(t).call(this,a))).initialConfiguration=a,e._resetHandles(),e.postTouchStartCallback=e._startOutliningRegion.bind(ct()(ct()(e))),e.touchDragCallback=e._setHandlesAndUpdate.bind(ct()(ct()(e))),e.touchEndCallback=e._applyStrategy.bind(ct()(ct()(e))),e.postMouseDownCallback=e._startOutliningRegion.bind(ct()(ct()(e))),e.mouseClickCallback=e._startOutliningRegion.bind(ct()(ct()(e))),e.mouseDragCallback=e._setHandlesAndUpdate.bind(ct()(ct()(e))),e.mouseMoveCallback=e._setHandlesAndUpdate.bind(ct()(ct()(e))),e.mouseUpCallback=e._applyStrategy.bind(ct()(ct()(e))),e}return h()(t,e),r()(t,[{key:"renderToolData",value:function(e){var t=this,n=e.detail,a=n.element,o=_e.getColorIfActive({active:!0}),i=Je(n.canvasContext.canvas);Oe(i,function(e){Ze(e,a,t.handles.start,t.handles.end,{color:o})})}},{key:"_startOutliningRegion",value:function(e){var t=e.detail.element,n=e.detail.currentPoints.image;return Ba(this.handles.start)?this.handles.start=n:(this.handles.end=n,this._applyStrategy(e)),f.cornerstone.updateImage(t),!0}},{key:"_setHandlesAndUpdate",value:function(e){var t=e.detail.element,n=e.detail.currentPoints.image;this.handles.end=n,f.cornerstone.updateImage(t)}},{key:"_applyStrategy",value:function(e){Ba(this.handles.start)||Ba(this.handles.end)||(e.detail.handles=this.handles,Fa(e,this.configuration),this._resetHandles())}},{key:"_resetHandles",value:function(){this.handles={start:{},end:{}}}}]),t}(Y),Ba=function(e){return 0===Object.keys(e).length&&e.constructor===Object},Fa=function(e,t){var n=e.detail,a=n.image,o=n.element,i=e.detail.handles,r=i.start,s=i.end,l=Math.min(r.x,s.x),c=Math.min(r.y,s.y),u=Math.abs(r.x-s.x),d=Math.abs(r.y-s.y);l=se(l,0,a.width),c=se(c,0,a.height),u=Math.floor(Math.min(u,Math.abs(a.width-l))),d=Math.floor(Math.min(d,Math.abs(a.height-c)));var h=Na(o,l,c,u,d),v=Va(h,a.minPixelValue,a.maxPixelValue),g=n.viewport;void 0===t.minWindowWidth&&(t.minWindowWidth=10),g.voi.windowWidth=Math.max(Math.abs(v.max-v.min),t.minWindowWidth),g.voi.windowCenter=v.mean,f.cornerstone.setViewport(o,g),f.cornerstone.updateImage(o)},Va=function(e,t,n){var a=e.length,o=n,i=t,r=0;if(a<2)return{min:o,max:i,mean:(t+n)/2};for(var s=0;s<a;s++){var l=e[s];o=Math.min(o,l),i=Math.max(i,l),r+=l}return{min:o,max:i,mean:r/a}},ja=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};o()(this,t);var a={name:"Wwwc",strategies:{basicLevelingStrategy:Wa},supportedInteractionTypes:["Mouse","Touch"],configuration:{orientation:0}},i=Object.assign(a,n);return(e=l()(this,u()(t).call(this,i))).initialConfiguration=i,e}return h()(t,e),r()(t,[{key:"mouseDragCallback",value:function(e){this.applyActiveStrategy(e),f.cornerstone.setViewport(e.detail.element,e.detail.viewport)}},{key:"touchDragCallback",value:function(e){e.stopImmediatePropagation(),this.applyActiveStrategy(e),f.cornerstone.setViewport(e.detail.element,e.detail.viewport)}}]),t}(Y);function Wa(e,t){var n=t.orientation,a=e.detail,o=(a.image.maxPixelValue*a.image.slope+a.image.intercept-(a.image.minPixelValue*a.image.slope+a.image.intercept))/1024,i=a.deltaPoints.page.x*o,r=a.deltaPoints.page.y*o;0===n?(a.viewport.voi.windowWidth+=i,a.viewport.voi.windowCenter+=r):(a.viewport.voi.windowWidth+=r,a.viewport.voi.windowCenter+=i)}var za={changeViewportScale:function(e,t,n){var a=n.maxScale,o=n.minScale,i=Math.log(e.scale)/Math.log(1.7)+t,r=Math.pow(1.7,i);return e.scale=a&&r>a?a:o&&r<o?o:r,e},correctShift:function(e,t){var n=t.hflip,a=t.vflip,o=t.rotation;if(e.x*=n?-1:1,e.y*=a?-1:1,0!==o){var i=o*Math.PI/180,r=Math.cos(i),s=Math.sin(i),l=e.x*r-e.y*s,c=e.x*s+e.y*r;e.x=l,e.y=c}return e}},Ga=za.changeViewportScale,qa=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};o()(this,t);var a=Object.assign({name:"ZoomMouseWheel",supportedInteractionTypes:["MouseWheel"],configuration:{minScale:.25,maxScale:20,invert:!1}},n);return(e=l()(this,u()(t).call(this,a))).initialConfiguration=a,e}return h()(t,e),r()(t,[{key:"mouseWheelCallback",value:function(e){var t=e.detail,n=t.element,a=t.viewport,o=t.direction,i=this.configuration,r=i.invert,s=i.maxScale,l=i.minScale,c=Ga(a,r?o/4:-o/4,{maxScale:s,minScale:l});f.cornerstone.setViewport(n,c)}}]),t}(Y),Ya=za.correctShift,Ka=za.changeViewportScale,Xa=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};o()(this,t);var a={name:"Zoom",strategies:{default:Ja,translate:Qa,zoomToCenter:$a},defaultStrategy:"default",supportedInteractionTypes:["Mouse","Touch"],configuration:{invert:!1,preventZoomOutsideImage:!1,minScale:.25,maxScale:20}},i=Object.assign(a,n);return(e=l()(this,u()(t).call(this,i))).initialConfiguration=i,e}return h()(t,e),r()(t,[{key:"touchDragCallback",value:function(e){Za.call(this,e)}},{key:"mouseDragCallback",value:function(e){Za.call(this,e)}}]),t}(Y),Za=function(e){if(!e.detail.deltaPoints.page.y)return!1;this.applyActiveStrategy(e,this.configuration),f.cornerstone.setViewport(e.detail.element,e.detail.viewport)};function Ja(e,t){var n=t.invert,a=t.maxScale,o=t.minScale,i=e.detail.deltaPoints.page.y,r=n?-i/100:i/100,s=e.detail,l=s.element,c=s.viewport,u=[e.detail.startPoints.page.x,e.detail.startPoints.page.y,e.detail.startPoints.image.x,e.detail.startPoints.image.y],d=u[0],h=u[1],v=u[2],g=u[3],m=Ka(c,r,{maxScale:a,minScale:o});f.cornerstone.setViewport(l,m);var p=f.cornerstone.pageToPixel(l,d,h),y={x:v-p.x,y:g-p.y};y=Ya(y,m),c.translation.x-=y.x,c.translation.y-=y.y}function Qa(e,t){var n=t.invert,a=t.preventZoomOutsideImage,o=t.maxScale,i=t.minScale,r=e.detail.deltaPoints.page.y,s=n?-r/100:r/100,l=e.detail.image,c=e.detail.viewport,u=[e.detail.startPoints.image.x,e.detail.startPoints.image.y],d=u[0],h=u[1],v=Ka(c,s,{maxScale:o,minScale:i}),g={x:0,y:0};if(s<0)v.scale<3&&(Math.abs(v.translation.x)<.01?v.translation.x=0:g.x=v.translation.x/8,Math.abs(v.translation.y)<.01?v.translation.y=0:g.y=v.translation.y/8);else{a&&le(e.detail.startPoints.image,l);var m={x:l.width/2-d,y:l.height/2-h};m=Ya(m,v);var f={x:v.translation.x-m.x,y:v.translation.y-m.y};Math.abs(f.x)<.01?v.translation.x=m.x:g.x=f.x/8,Math.abs(f.y)<.01?v.translation.y=m.y:g.y=f.y/8}v.translation.x-=g.x,v.translation.y-=g.y}function $a(e,t){var n=t.invert,a=t.maxScale,o=t.minScale,i=e.detail.deltaPoints.page.y,r=n?-i/100:i/100,s=e.detail.viewport;Ka(s,r,{maxScale:a,minScale:o})}var eo=za.correctShift,to=function(e){function t(){var e,n=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};o()(this,t);var a=Object.assign({name:"ZoomTouchPinch",supportedInteractionTypes:["TouchPinch"],configuration:{minScale:.25,maxScale:20}},n);return(e=l()(this,u()(t).call(this,a))).initialConfiguration=a,e}return h()(t,e),r()(t,[{key:"touchPinchCallback",value:function(e){var t=e.detail,n=t.element,a=t.viewport,o=t.scaleChange,i=[e.detail.startPoints.page.x,e.detail.startPoints.page.y,e.detail.startPoints.image.x,e.detail.startPoints.image.y],r=i[0],s=i[1],l=i[2],c=i[3],u=this.configuration,d=u.maxScale,h=u.minScale;a.scale+=o*a.scale,d&&a.scale>d?a.scale=d:h&&a.scale<h&&(a.scale=h),f.cornerstone.setViewport(n,a);var v=f.cornerstone.pageToPixel(n,r,s),g={x:l-v.x,y:c-v.y};g=eo(g,a),a.translation.x-=g.x,a.translation.y-=g.y,f.cornerstone.setViewport(n,a)}}]),t}(Y),no=function(e){return{page:ao(e.page),image:ao(e.image),client:ao(e.client),canvas:ao(e.canvas)}};function ao(){var e=arguments.length>0&&void 0!==arguments[0]?arguments[0]:{};return{x:e.x,y:e.y}}var oo,io=!0,ro=200;function so(e){if("number"==typeof e.buttons)return e.buttons;switch(e.which){case 0:return 0;case 1:return 1;case 2:return 4;case 3:return 2}return 0}function lo(){io=!1}function co(e){var t=e.currentTarget,n=f.cornerstone.getEnabledElement(t);if(n.image){var a=x.MOUSE_DOUBLE_CLICK,o={page:f.cornerstoneMath.point.pageToPoint(e),image:f.cornerstone.pageToPixel(t,e.pageX,e.pageY),client:{x:e.clientX,y:e.clientY}};o.canvas=f.cornerstone.pixelToCanvas(t,o.image);var i=no(o);console.log("double-click: ".concat(so(e))),T(t,a,{event:e,buttons:so(e),viewport:f.cornerstone.getViewport(t),image:n.image,element:t,startPoints:o,lastPoints:i,currentPoints:o,deltaPoints:{x:0,y:0},type:a})}}function uo(e){var t=e.currentTarget,n=f.cornerstone.getEnabledElement(t);if(n.image){oo=setTimeout(lo,ro),t.removeEventListener("mousemove",ho);var a={page:f.cornerstoneMath.point.pageToPoint(e),image:f.cornerstone.pageToPixel(t,e.pageX,e.pageY),client:{x:e.clientX,y:e.clientY}};a.canvas=f.cornerstone.pixelToCanvas(t,a.image);var o=no(a),i={event:e,buttons:so(e),viewport:f.cornerstone.getViewport(t),image:n.image,element:t,startPoints:a,lastPoints:o,currentPoints:a,deltaPoints:{x:0,y:0},type:x.MOUSE_DOWN};T(i.element,x.MOUSE_DOWN,i)&&(i.type=x.MOUSE_DOWN_ACTIVATE,T(i.element,x.MOUSE_DOWN_ACTIVATE,i)),document.addEventListener("mousemove",r),document.addEventListener("mouseup",function e(i){clearTimeout(oo);var s=x.MOUSE_UP;io&&(s=x.MOUSE_CLICK);var l={page:f.cornerstoneMath.point.pageToPoint(i),image:f.cornerstone.pageToPixel(t,i.pageX,i.pageY),client:{x:i.clientX,y:i.clientY}};l.canvas=f.cornerstone.pixelToCanvas(t,l.image);var c={page:f.cornerstoneMath.point.subtract(l.page,o.page),image:f.cornerstoneMath.point.subtract(l.image,o.image),client:f.cornerstoneMath.point.subtract(l.client,o.client),canvas:f.cornerstoneMath.point.subtract(l.canvas,o.canvas)};console.log("mouseup: ".concat(so(i)));var u={event:i,buttons:so(i),viewport:f.cornerstone.getViewport(t),image:n.image,element:t,startPoints:a,lastPoints:o,currentPoints:l,deltaPoints:c,type:s};T(u.element,s,u),document.removeEventListener("mousemove",r),document.removeEventListener("mouseup",e),t.addEventListener("mousemove",ho),io=!0})}function r(e){var i=x.MOUSE_DRAG,r={page:f.cornerstoneMath.point.pageToPoint(e),image:f.cornerstone.pageToPixel(t,e.pageX,e.pageY),client:{x:e.clientX,y:e.clientY}};r.canvas=f.cornerstone.pixelToCanvas(t,r.image);var s={page:f.cornerstoneMath.point.subtract(r.page,o.page),image:f.cornerstoneMath.point.subtract(r.image,o.image),client:f.cornerstoneMath.point.subtract(r.client,o.client),canvas:f.cornerstoneMath.point.subtract(r.canvas,o.canvas)};console.log("mousemove ".concat(so(e)));var l={buttons:so(e),viewport:f.cornerstone.getViewport(t),image:n.image,element:t,startPoints:a,lastPoints:o,currentPoints:r,deltaPoints:s,type:i,ctrlKey:e.ctrlKey,metaKey:e.metaKey,shiftKey:e.shiftKey};T(l.element,i,l),o=no(r)}}function ho(e){var t=e.currentTarget,n=f.cornerstone.getEnabledElement(t);if(n.image){var a=x.MOUSE_MOVE,o={page:f.cornerstoneMath.point.pageToPoint(e),image:f.cornerstone.pageToPixel(t,e.pageX,e.pageY),client:{x:e.clientX,y:e.clientY}};o.canvas=f.cornerstone.pixelToCanvas(t,o.image);var i=no(o),r={page:f.cornerstoneMath.point.pageToPoint(e),image:f.cornerstone.pageToPixel(t,e.pageX,e.pageY),client:{x:e.clientX,y:e.clientY}};r.canvas=f.cornerstone.pixelToCanvas(t,r.image);var s={page:f.cornerstoneMath.point.subtract(r.page,i.page),image:f.cornerstoneMath.point.subtract(r.image,i.image),client:f.cornerstoneMath.point.subtract(r.client,i.client),canvas:f.cornerstoneMath.point.subtract(r.canvas,i.canvas)};T(t,a,{viewport:f.cornerstone.getViewport(t),image:n.image,element:t,startPoints:o,lastPoints:i,currentPoints:r,deltaPoints:s,type:a}),i=no(r)}}function vo(e){e.removeEventListener("mousedown",uo),e.removeEventListener("mousemove",ho),e.removeEventListener("dblclick",co)}var go={enable:function(e){vo(e),e.addEventListener("mousedown",uo),e.addEventListener("mousemove",ho),e.addEventListener("dblclick",co)},disable:vo};function mo(e){var t=e.currentTarget,n=f.cornerstone.getEnabledElement(t);if(n.image&&!("mousewheel"===e.type&&0===e.wheelDeltaY||"DOMMouseScroll"===e.type&&1===e.axis)){var a,o;e.preventDefault(),void 0!==e.pageX&&void 0!==e.pageY?(a=e.pageX,o=e.pageY):(a=e.x,o=e.y);var i=f.cornerstone.pageToPixel(t,a,o),r=((e=window.event&&window.event.wheelDelta?window.event:e).wheelDelta?e.wheelDelta:e.deltaY?-e.deltaY:e.detail?-e.detail:e.wheelDelta)<0?-1:1,s={element:t,viewport:f.cornerstone.getViewport(t),detail:e,image:n.image,direction:r,pageX:a,pageY:o,imageX:i.x,imageY:i.y};T(t,x.MOUSE_WHEEL,s)}}var fo=["mousewheel","DOMMouseScroll"];function po(e){fo.forEach(function(t){e.removeEventListener(t,mo)})}var yo,xo,To={enable:function(e){po(e),fo.forEach(function(t){e.addEventListener(t,mo,{passive:!1})})},disable:po},bo=2e3,Eo={mouse:0,touch:1};function Mo(e,t){var n=Date.now();if(e!==yo){if(n-xo<=bo)return t.preventDefault(),t.stopPropagation(),t.stopImmediatePropagation(),!1;yo=e}xo=n}var Co=Mo.bind(null,Eo.mouse),wo=Mo.bind(null,Eo.touch);function Io(e,t,n){var a=n?Co:wo;t.forEach(function(t){e.addEventListener(t,a,{passive:!1})})}function ko(e,t,n){var a=n?Co:wo;t.forEach(function(t){e.removeEventListener(t,a)})}var Po=["mousedown","mouseup"],So=["touchstart","touchend"];function _o(e){ko(e,Po,Eo.mouse),ko(e,So,Eo.touch)}var Oo,Do,Lo,Ao,Ho,Uo,No,Ro,Bo,Fo={enable:function(e){_o(e),Io(e,Po,Eo.mouse),Io(e,So,Eo.touch)},disable:_o},Vo=1,jo=0,Wo=!1,zo=!1,Go=700,qo=5,Yo="touchInput";function Ko(e){var t=e.currentTarget||e.srcEvent.currentTarget,n=f.cornerstone.getEnabledElement(t);if(n.image){var a,o,i,r;switch(e.preventDefault(),(e.pointers&&e.pointers.length>1||e.touches&&e.touches.length>1)&&(zo=!1,clearTimeout(No)),e.type){case"tap":zo=!1,clearTimeout(No),(Do={page:f.cornerstoneMath.point.pageToPoint(e.pointers[0]),image:f.cornerstone.pageToPixel(t,e.pointers[0].pageX,e.pointers[0].pageY),client:{x:e.pointers[0].clientX,y:e.pointers[0].clientY}}).canvas=f.cornerstone.pixelToCanvas(t,Do.image),a=x.TAP,Ho={event:e,viewport:f.cornerstone.getViewport(t),image:n.image,element:t,currentPoints:Do,type:a,isTouchEvent:!0},T(t,a,Ho);break;case"doubletap":zo=!1,clearTimeout(No),(Do={page:f.cornerstoneMath.point.pageToPoint(e.pointers[0]),image:f.cornerstone.pageToPixel(t,e.pointers[0].pageX,e.pointers[0].pageY),client:{x:e.pointers[0].clientX,y:e.pointers[0].clientY}}).canvas=f.cornerstone.pixelToCanvas(t,Do.image),a=x.DOUBLE_TAP,Ho={event:e,viewport:f.cornerstone.getViewport(t),image:n.image,element:t,currentPoints:Do,type:a,isTouchEvent:!0},T(t,a,Ho);break;case"pinchstart":zo=!1,clearTimeout(No),Vo=1;break;case"pinchmove":if(zo=!1,clearTimeout(No),!0===Wo){Vo=e.scale,Wo=!1;break}o=(e.scale-Vo)/Vo,(Oo={page:e.center,image:f.cornerstone.pageToPixel(t,e.center.x,e.center.y)}).canvas=f.cornerstone.pixelToCanvas(t,Oo.image),a=x.TOUCH_PINCH,Ho={event:e,startPoints:Oo,viewport:f.cornerstone.getViewport(t),image:n.image,element:t,direction:e.scale<1?1:-1,scaleChange:o,type:a,isTouchEvent:!0},T(t,a,Ho),Vo=e.scale;break;case"touchstart":Vo=1,clearTimeout(No),clearTimeout(Uo),Uo=setTimeout(function(){(Oo={page:f.cornerstoneMath.point.pageToPoint(e.touches[0]),image:f.cornerstone.pageToPixel(t,e.touches[0].pageX,e.touches[0].pageY),client:{x:e.touches[0].clientX,y:e.touches[0].clientY}}).canvas=f.cornerstone.pixelToCanvas(t,Oo.image),a=x.TOUCH_START,e.touches.length>1&&(a=x.MULTI_TOUCH_START),Ho={event:e,viewport:f.cornerstone.getViewport(t),image:n.image,element:t,startPoints:Oo,currentPoints:Oo,type:a,isTouchEvent:!0},!0===T(t,a,Ho)&&(a=x.TOUCH_START_ACTIVE,e.touches.length>1&&(a=x.MULTI_TOUCH_START_ACTIVE),Ho.type=a,T(t,a,Ho)),Lo=no(Oo)},50),zo=!0,Ro=0,No=setTimeout(function(){zo&&((Do={page:f.cornerstoneMath.point.pageToPoint(e.touches[0]),image:f.cornerstone.pageToPixel(t,e.touches[0].pageX,e.touches[0].pageY),client:{x:e.touches[0].clientX,y:e.touches[0].clientY}}).canvas=f.cornerstone.pixelToCanvas(t,Oo.image),a=x.TOUCH_PRESS,Ho={event:e,viewport:f.cornerstone.getViewport(t),image:n.image,element:t,currentPoints:Do,type:a,isTouchEvent:!0},T(t,a,Ho))},Go);break;case"touchend":Vo=1,zo=!1,clearTimeout(No),setTimeout(function(){(Oo={page:f.cornerstoneMath.point.pageToPoint(e.changedTouches[0]),image:f.cornerstone.pageToPixel(t,e.changedTouches[0].pageX,e.changedTouches[0].pageY),client:{x:e.changedTouches[0].clientX,y:e.changedTouches[0].clientY}}).canvas=f.cornerstone.pixelToCanvas(t,Oo.image),a=x.TOUCH_END,Ho={event:e,viewport:f.cornerstone.getViewport(t),image:n.image,element:t,startPoints:Oo,currentPoints:Oo,type:a,isTouchEvent:!0},T(t,a,Ho)},50);break;case"panmove":i={x:e.deltaX-Bo.x,y:e.deltaY-Bo.y},Bo={x:e.deltaX,y:e.deltaY},(Do={page:{x:Lo.page.x+i.x,y:Lo.page.y+i.y},image:f.cornerstone.pageToPixel(t,Lo.page.x+i.x,Lo.page.y+i.y),client:{x:Lo.client.x+i.x,y:Lo.client.y+i.y}}).canvas=f.cornerstone.pixelToCanvas(t,Do.image),Ao={page:f.cornerstoneMath.point.subtract(Do.page,Lo.page),image:f.cornerstoneMath.point.subtract(Do.image,Lo.image),client:f.cornerstoneMath.point.subtract(Do.client,Lo.client),canvas:f.cornerstoneMath.point.subtract(Do.canvas,Lo.canvas)},(Ro+=Math.sqrt(Ao.page.x*Ao.page.x+Ao.page.y*Ao.page.y))>qo&&(zo=!1,clearTimeout(No)),a=x.TOUCH_DRAG,e.pointers.length>1&&(a=x.MULTI_TOUCH_DRAG),Ho={viewport:f.cornerstone.getViewport(t),image:n.image,element:t,startPoints:Oo,lastPoints:Lo,currentPoints:Do,deltaPoints:Ao,numPointers:e.pointers.length,type:a,isTouchEvent:!0},T(t,a,Ho),Lo=no(Do);break;case"panstart":Bo={x:e.deltaX,y:e.deltaY},(Do={page:f.cornerstoneMath.point.pageToPoint(e.pointers[0]),image:f.cornerstone.pageToPixel(t,e.pointers[0].pageX,e.pointers[0].pageY),client:{x:e.pointers[0].clientX,y:e.pointers[0].clientY}}).canvas=f.cornerstone.pixelToCanvas(t,Do.image),Lo=no(Do);break;case"panend":if(zo=!1,clearTimeout(No),!Lo)return!1;(Do={page:f.cornerstoneMath.point.pageToPoint(e.pointers[0]),image:f.cornerstone.pageToPixel(t,e.pointers[0].pageX,e.pointers[0].pageY),client:{x:e.pointers[0].clientX,y:e.pointers[0].clientY}}).canvas=f.cornerstone.pixelToCanvas(t,Do.image),Ao={page:f.cornerstoneMath.point.subtract(Do.page,Lo.page),image:f.cornerstoneMath.point.subtract(Do.image,Lo.image),client:f.cornerstoneMath.point.subtract(Do.client,Lo.client),canvas:f.cornerstoneMath.point.subtract(Do.canvas,Lo.canvas)},a=x.TOUCH_DRAG_END,Ho={event:e.srcEvent,viewport:f.cornerstone.getViewport(t),image:n.image,element:t,startPoints:Oo,lastPoints:Lo,currentPoints:Do,deltaPoints:Ao,type:a,isTouchEvent:!0},T(t,a,Ho),2===e.pointers.length-e.changedPointers.length&&(Wo=!0);break;case"rotatemove":zo=!1,clearTimeout(No),r=e.rotation-jo,jo=e.rotation,a=x.TOUCH_ROTATE,Ho={event:e.srcEvent,viewport:f.cornerstone.getViewport(t),image:n.image,element:t,rotation:r,type:a},T(t,a,Ho)}return!1}}function Xo(e){Fo.disable(e);["touchstart","touchend"].forEach(function(t){e.removeEventListener(t,Ko)});var t=Rn(Yo,e).hammer;t&&t.off("tap doubletap panstart panmove panend pinchstart pinchmove rotatemove",Ko)}var Zo={enable:function(e){Xo(e);var t=f.Hammer,n={inputClass:t.SUPPORT_POINTER_EVENTS?t.PointerEventInput:t.TouchInput},a=new t.Manager(e,n),o={pointers:0,direction:t.DIRECTION_ALL,threshold:0},i=new t.Pan(o),r=new t.Pinch({threshold:0}),s=new t.Rotate({threshold:0});r.recognizeWith(i),r.recognizeWith(s),s.recognizeWith(i);var l=new t.Tap({event:"doubletap",taps:2,interval:1500,threshold:50,posThreshold:50});l.recognizeWith(i),a.add([l,i,s,r]),a.on("tap doubletap panstart panmove panend pinchstart pinchmove rotatemove",Ko),Fo.enable(e),["touchstart","touchend"].forEach(function(t){e.addEventListener(t,Ko,{passive:!1})});var c=Rn(Yo,e);c.hammer=a,Bn(Yo,e,c)},disable:Xo},Jo=function(e,t,n){return t.filter(function(t){return t.element===e&&"active"===t.mode&&(void 0===n||t.options["is".concat(n,"Active")])})};"createImageBitmap"in window||(window.createImageBitmap=function(){var e=ea()(Qn.a.mark(function e(t){return Qn.a.wrap(function(e){for(;;)switch(e.prev=e.next){case 0:return e.abrupt("return",new Promise(function(e){var n=document.createElement("img");n.addEventListener("load",function(){e(this)});var a=document.createElement("canvas");a.width=t.width,a.height=t.height,a.getContext("2d").putImageData(t,0,0,0,0,a.width,a.height),n.src=a.toDataURL()}));case 1:case"end":return e.stop()}},e,this)}));return function(t){return e.apply(this,arguments)}}());var Qo=_.modules.brush,$o=Qo.state,ei=Qo.getters,ti=Qo.setters;function ni(e,t,n){var a=e.detail.element,o=n.toolData,i=n.visibleSegmentations;return!!o.data[t].pixelData&&(!!i[t]||$o.drawColorId===t&&Jo(a,_.state.tools).filter(function(e){return e instanceof Mn}).length>0)}function ai(e,t,n){var a=n.toolData,o=n.imageBitmapCache,i=n.visibleSegmentations;o&&o[t]&&function(e,t,n){var a=e.detail,o=Je(a.canvasContext.canvas),i=f.cornerstone.pixelToCanvas(a.element,{x:0,y:0}),r=f.cornerstone.pixelToCanvas(a.element,{x:a.image.width,y:a.image.height}),s=r.x-i.x,l=r.y-i.y;o.imageSmoothingEnabled=!1,o.globalAlpha=function(e){if(e)return $o.alpha;return $o.hiddenButActiveAlpha}(n),o.drawImage(t,i.x,i.y,s,l),o.globalAlpha=1}(e,o[t],i[t]),a.data[t].invalidated&&function(e,t,n){var a=e.detail,o=a.element,i=f.cornerstone.getEnabledElement(o),r=t.data[n].pixelData,s=$o.colorMapId,l=[[0,0,0,0],f.cornerstone.colors.getColormap(s).getColor(n)],c=new ImageData(a.image.width,a.image.height),u={stats:{},minPixelValue:0,getPixelData:function(){return r}};f.cornerstone.storedPixelDataToCanvasImageDataColorLUT(u,l,c.data),window.createImageBitmap(c).then(function(e){ti.imageBitmapCacheForElement(i.uuid,n,e),t.data[n].invalidated=!1,f.cornerstone.updateImage(a.element)})}(e,a,t)}var oi=function(e){var t=e.detail.element,n=k.tools.filter(function(e){return e.element===t&&("active"===e.mode||"passive"===e.mode||"enabled"===e.mode)});n.filter(function(e){return e instanceof Mn}).length>0&&function(e){var t=e.detail,n=t.element,a=Mn.getNumberOfColors(),o=Q(n,Mn.getReferencedToolDataName());if(!o){for(var i=0;i<a;i++)J(n,Mn.getReferencedToolDataName(),{});o=Q(n,Mn.getReferencedToolDataName());var r=new Uint8ClampedArray(t.image.width*t.image.height);o.data[0].pixelData=r,o=Q(n,Mn.getReferencedToolDataName())}for(var s=f.cornerstone.getEnabledElement(n).uuid,l={visibleSegmentations:ei.visibleSegmentationsForElement(s),imageBitmapCache:ei.imageBitmapCacheForElement(s),toolData:o},c=0;c<a;c++)ni(e,c,l)&&ai(e,c,l)}(e),n.forEach(function(t){t.renderToolData&&t.renderToolData(e)})},ii=function(e){e.addEventListener(f.cornerstone.EVENTS.IMAGE_RENDERED,oi)},ri=function(e){e.removeEventListener(f.cornerstone.EVENTS.IMAGE_RENDERED,oi)},si=function(e,t,n){if(k.isToolLocked)return!1;var a=n.detail.element,o=k.tools.filter(function(t){return t.supportedInteractionTypes.includes(e)});if(0===(o=(o=Jo(a,o,e)).filter(function(e){return"function"==typeof e[t]})).length)return!1;o[0][t](n)},li=function(e,t,n){var a="mouse"===(arguments.length>3&&void 0!==arguments[3]?arguments[3]:"mouse")?k.clickProximity:k.touchProximity;return t.filter(function(t){for(var o=Q(e,t.name),i=0;i<o.data.length;i++)if(void 0!==oe(e,o.data[i].handles,n,a))return!0;return!1})},ci=function(e,t){return t.filter(function(t){return t.element===e&&("active"===t.mode||"passive"===t.mode)})},ui=function(e,t){return t.filter(function(t){var n=Q(e,t.name);return n&&n.data.length>0})},di=function(e){if(!k.isToolLocked){var t=e.detail,n=e.detail.element,a=e.detail.currentPoints.canvas,o=ci(n,P.mouseTools()),i=o.filter(function(e){return"active"===e.mode&&Array.isArray(e.options.mouseButtonMask)&&e.options.mouseButtonMask.includes(t.buttons)&&e.options.isMouseActive});if(i.length>0){var r=i.find(function(e){return"function"==typeof e.preMouseDownCallback});if(r)if(r.preMouseDownCallback(e))return}var s=ui(n,o),l=li(n,s,a,"mouse");if(l.length>0){var c=l[0],u=Q(n,c.name),d=be(n,u,c.name,a),h=d.handle,v=d.data;c.handleSelectedCallback(e,v,h,"mouse")}else{var g=o.filter(function(e){var t=Q(n,e.name);return t&&t.data&&e.pointNearTool&&t.data.some(function(t){return e.pointNearTool(n,t,a,"mouse")})});if(g.length>0){var m=g[0],f=Q(n,m.name).data.find(function(e){return m.pointNearTool(n,e,a)});m.toolSelectedCallback(e,f,"mouse")}else if(i.length>0){var p=i.find(function(e){return"function"==typeof e.postMouseDownCallback});if(p)if(p.postMouseDownCallback(e))return}}}},hi=function(e){if(!k.isToolLocked){var t=e.detail,n=t.element,a=Jo(n,P.mouseTools());if(0!==(a=a.filter(function(e){return Array.isArray(e.options.mouseButtonMask)&&e.options.mouseButtonMask.includes(t.buttons)&&e.options.isMouseActive})).length){var o=a[0];if("function"==typeof o.preMouseDownActivateCallback)if(o.preMouseDownActivateCallback(e))return;o.addNewMeasurement?o.addNewMeasurement(e,"mouse"):o instanceof Me&&function(e,t){e.preventDefault(),e.stopPropagation();var n=e.detail,a=n.element,o=t.createNewMeasurement(n);o&&(J(a,t.name,o),f.cornerstone.updateImage(a),(1===Object.keys(o.handles).length?me:ye)(n,t.name,o,o.handles.end,t.options,"mouse"))}(e,o)}}},vi=function(e){if(!k.isToolLocked){var t,n=e.detail,a=n.element;if(0!==(t=(t=(t=Jo(a,P.mouseTools())).filter(function(e){return Array.isArray(e.options.mouseButtonMask)&&e.options.mouseButtonMask.includes(n.buttons)&&e.options.isMouseActive})).filter(function(e){return"function"==typeof e.mouseDragCallback})).length)t[0].mouseDragCallback(e)}},gi=function(e){if(!k.isToolLocked){var t,n=e.detail,a=n.element,o=n.currentPoints;k.mousePositionImage=o.image;var i=(t=ci(a,P.mouseTools())).filter(function(e){return"active"===e.mode&&e.options.isMouseActive}),r=!1;i.length>0&&(r=i.some(function(e){return e.hasCursor})),t=ui(a,t);for(var s=0;s<t.length;s++){var l=t[s];"function"==typeof l.mouseMoveCallback&&(r=l.mouseMoveCallback(e)||r)}!0===r&&f.cornerstone.updateImage(a)}},mi=si.bind(null,"Mouse","mouseClickCallback"),fi=si.bind(null,"Mouse","doubleClickCallback"),pi=si.bind(null,"Mouse","mouseUpCallback"),yi=si.bind(null,"MouseWheel","mouseWheelCallback"),xi=function(e){e.addEventListener(x.MOUSE_CLICK,mi),e.addEventListener(x.MOUSE_DOWN,di),e.addEventListener(x.MOUSE_DOWN_ACTIVATE,hi),e.addEventListener(x.MOUSE_DOUBLE_CLICK,fi),e.addEventListener(x.MOUSE_DRAG,vi),e.addEventListener(x.MOUSE_MOVE,gi),e.addEventListener(x.MOUSE_UP,pi),e.addEventListener(x.MOUSE_WHEEL,yi)},Ti=function(e){e.removeEventListener(x.MOUSE_CLICK,mi),e.removeEventListener(x.MOUSE_DOWN,di),e.removeEventListener(x.MOUSE_DOWN_ACTIVATE,hi),e.removeEventListener(x.MOUSE_DOUBLE_CLICK,fi),e.removeEventListener(x.MOUSE_DRAG,vi),e.removeEventListener(x.MOUSE_MOVE,gi),e.removeEventListener(x.MOUSE_UP,pi),e.removeEventListener(x.MOUSE_WHEEL,yi)},bi=_.modules.brush.setters,Ei=function(e){if(k.isToolLocked)return!1;var t=e.detail.element,n=k.tools.filter(function(e){return e.element===t&&("active"===e.mode||"passive"===e.mode||"enabled"===e.mode)});if(0===n.length)return!1;n.forEach(function(t){t.newImageCallback&&t.newImageCallback(e)}),n.filter(function(e){return e instanceof Mn}).length>0&&function(e){var t=e.detail,n=t.element,a=Q(n,Mn.getReferencedToolDataName());if(!a){for(var o=Mn.getNumberOfColors(),i=0;i<o;i++)J(n,Mn.getReferencedToolDataName(),{});a=Q(n,Mn.getReferencedToolDataName());var r=new Uint8ClampedArray(t.image.width*t.image.height);a.data[0].pixelData=r,a=Q(n,Mn.getReferencedToolDataName())}var s=f.cornerstone.getEnabledElement(n),l=Mn.getNumberOfColors();bi.clearImageBitmapCacheForElement(s.uuid);for(var c=0;c<l;c++)a.data[c].invalidated=!0;f.cornerstone.updateImage(t.element)}(e)},Mi=function(e){e.addEventListener(f.cornerstone.EVENTS.NEW_IMAGE,Ei)},Ci=function(e){e.removeEventListener(f.cornerstone.EVENTS.NEW_IMAGE,Ei)},wi=function(e){if(k.isToolLocked)return!1;var t=e.detail,n=t.element,a=t.numPointers,o=k.tools.filter(function(e){return e.supportedInteractionTypes.includes("MultiTouch")});if(0===(o=(o=Jo(n,o,"MultiTouch")).filter(function(e){return"function"==typeof e.multiTouchDragCallback&&a===e.configuration.touchPointers})).length)return!1;o[0].multiTouchDragCallback(e)},Ii=function(e){if(!k.isToolLocked){var t=e.detail.element,n=Jo(t,P.touchTools());if(0!==(n=n.filter(function(e){return e.options.isTouchActive})).length){var a=n[0];a&&a.addNewMeasurement?a.addNewMeasurement(e,"touch"):a instanceof Me&&function(e,t){console.log("touch: addNewMeasurement"),e.preventDefault(),e.stopPropagation();var n=e.detail,a=n.element,o=t.createNewMeasurement(n);if(o){if(J(a,t.name,o),1===Object.keys(o.handles).length&&n.type===x.TAP)return o.active=!1,o.handles.end.active=!1,o.handles.end.highlight=!1,o.invalidated=!0,(k.deleteIfHandleOutsideImage||t.options.deleteIfHandleOutsideImage)&&re(n,o.handles)&&$(a,t.name,o),void f.cornerstone.updateImage(a);f.cornerstone.updateImage(a),ye(n,t.name,o,o.handles.end,t.options,"touch")}}(e,a)}}},ki=function(e){if(e)for(var t=0;t<e.data.length;t++){var n=e.data[t];n.active=!1,n.handles&&Pi(n.handles)}};function Pi(e){Object.keys(e).forEach(function(t){e[t].active=!1})}var Si=function(e){if(!k.isToolLocked){var t,n=e.detail.element,a=e.detail.currentPoints.canvas;t=Jo(n,P.touchTools());var o=(t=ui(n,t)).filter(function(e){for(var t=Q(n,e.name),o=0;o<t.data.length;o++)if(void 0!==oe(n,t.data[o].handles,a,28))return!0;return!1});if(o.length>0){var i=o[0],r=Q(n,i.name),s=r.data.find(function(e){return void 0!==oe(n,e.handles,a,28)});r.data.active=!0,s.active=!0,f.cornerstone.updateImage(n);var l=Object.assign({},{doneMovingCallback:function(){ki(r)}},i.options);return me(e.detail,i.name,r.data,s,l,"touch"),e.stopImmediatePropagation(),void e.preventDefault()}var c=t.filter(function(e){var t=Q(n,e.name);return t&&t.data&&e.pointNearTool&&t.data.some(function(t){return e.pointNearTool(n,t,a)})});if(c.length>0){var u=c[0],d=Q(n,u.name),h=d.data.find(function(e){return u.pointNearTool(n,e,a)});h.active=!0,f.cornerstone.updateImage(n);var v=Object.assign({},{doneMovingCallback:function(){ki(d)}},u.options);return de(e.detail,u.name,h,null,v,"touch"),e.stopImmediatePropagation(),void e.preventDefault()}var g=Jo(n,P.touchTools());return g.length>0&&g[0].touchStartActiveCallback?g[0].touchStartActiveCallback(e):Ii(e),!1}},_i=function(e){if(!k.isToolLocked){var t=e.detail,n=t.element,a=t.startPoints.canvas,o=ci(n,P.touchTools()),i=o.filter(function(e){return"active"===e.mode&&e.options.isTouchActive});if(i.length>0){var r=i.find(function(e){return"function"==typeof e.preTouchStartCallback});if(r)if(r.preTouchStartCallback(e))return}var s=ui(n,o),l=li(n,s,a,"touch");if(l.length>0){var c=l[0],u=Q(n,c.name),d=be(n,u,c.name,a,"touch"),h=d.handle,v=d.data;c.handleSelectedCallback(e,v,h,"touch")}else{var g=s.filter(function(e){var t=Q(n,e.name);return t&&t.data&&e.pointNearTool&&t.data.some(function(t){return e.pointNearTool(n,t,a,"touch")})});if(g.length>0){var m=g[0],f=Q(n,m.name).data.find(function(e){return m.pointNearTool(n,e,a)});m.toolSelectedCallback(e,f,"touch")}else if(i.length>0){var p=i.find(function(e){return"function"==typeof e.postTouchStartCallback});if(p)if(p.postTouchStartCallback(e))return}}}},Oi=si.bind(null,"DoubleTap","doubleTapCallback"),Di=si.bind(null,"Touch","touchDragCallback"),Li=si.bind(null,"Touch","touchEndCallback"),Ai=si.bind(null,"TouchPinch","touchPinchCallback"),Hi=si.bind(null,"Touch","touchPressCallback"),Ui=si.bind(null,"TouchRotate","touchRotateCallback"),Ni=function(e){e.addEventListener(x.TAP,Si),e.addEventListener(x.TOUCH_START,_i,{passive:!1}),e.addEventListener(x.TOUCH_DRAG,Di,{passive:!1}),e.addEventListener(x.TOUCH_END,Li),e.addEventListener(x.TOUCH_START_ACTIVE,Ii),e.addEventListener(x.TOUCH_PRESS,Hi),e.addEventListener(x.DOUBLE_TAP,Oi),e.addEventListener(x.TOUCH_PINCH,Ai),e.addEventListener(x.TOUCH_ROTATE,Ui),e.addEventListener(x.MULTI_TOUCH_DRAG,wi)},Ri=function(e){e.removeEventListener(x.TAP,Si),e.removeEventListener(x.TOUCH_START,_i),e.removeEventListener(x.TOUCH_DRAG,Di),e.removeEventListener(x.TOUCH_END,Li),e.removeEventListener(x.TOUCH_START_ACTIVE,Ii),e.removeEventListener(x.TOUCH_PRESS,Hi),e.removeEventListener(x.DOUBLE_TAP,Oi),e.removeEventListener(x.TOUCH_PINCH,Ai),e.removeEventListener(x.TOUCH_ROTATE,Ui),e.removeEventListener(x.MULTI_TOUCH_DRAG,wi)},Bi=function(e,t,n){var a=new t(n);O(e,a.name)?console.warn("".concat(a.name," has already been added to the target element")):(a.element=e,_.state.tools.push(a))},Fi=function(e,t){Vi(e,t),_.state.enabledElements.forEach(function(n){Bi(n,e,t)})},Vi=function(e,t){if(_.modules.globalConfiguration.state.globalToolSyncEnabled){var n=new e(t);void 0!==_.state.globalTools[n.name]?console.warn("".concat(n.name," has already been added globally")):_.state.globalTools[n.name]={tool:e,configuration:t,activeBindings:[]}}},ji=function(e){console.log("EVENT:ELEMENT_ENABLED");var t=e.detail.element;ii(t),Mi(t),_.modules.globalConfiguration.state.mouseEnabled&&(go.enable(t),To.enable(t),xi(t)),_.modules.globalConfiguration.state.touchEnabled&&(Zo.enable(t),Ni(t)),Wi(t)},Wi=function(e){_.state.enabledElements.push(e),_.modules&&function(e){var t=_.modules;Object.keys(t).forEach(function(n){"function"==typeof t[n].enabledElementCallback&&t[n].enabledElementCallback(e)})}(e),function(e){if(!_.modules.globalConfiguration.state.globalToolSyncEnabled)return;Object.keys(_.state.globalTools).forEach(function(t){var n=_.state.globalTools[t],a=n.tool,o=n.configuration;Bi(e,a,o)})}(e),function(e){if(!_.modules.globalConfiguration.state.globalToolSyncEnabled)return;var t={active:D,passive:R,enabled:U,disabled:A};_.state.globalToolChangeHistory.forEach(function(n){var a=n.args.slice(0);a.unshift(e),t[n.mode].apply(null,a)})}(e)};var zi=function(e){console.info("EVENT:ELEMENT_DISABLED");var t=e.detail.element;ri(t),Ci(t),_.modules.globalConfiguration.state.mouseEnabled&&(go.disable(t),To.disable(t),Ti(t)),_.modules.globalConfiguration.state.touchEnabled&&(Zo.disable(t),Ri(t)),Gi(t),qi(t)},Gi=function(e){_.state.tools=_.state.tools.filter(function(t){return t.element!==e})},qi=function(e){_.modules&&function(e){var t=_.modules;Object.keys(t).forEach(function(n){"function"==typeof t[n].removeEnabledElementCallback&&t[n].removeEnabledElementCallback(e)})}(e);var t=_.state.enabledElements.findIndex(function(t){return t===e});t>-1?_.state.enabledElements.splice(t,1):console.warn("unable to remove element")};var Yi,Ki=function(){window.removeEventListener("resize",Xi,!1)};function Xi(){Yi||(Yi=setTimeout(function(){Yi=null,Zi()},66))}var Zi=function(){k.enabledElements.forEach(function(e){f.cornerstone.resize(e)})},Ji=function(){Ki(),window.addEventListener("resize",Xi,!1)},Qi=function(e){var t;!function(){!function(){var e=f.cornerstone,t=e.EVENTS.ELEMENT_ENABLED,n=e.EVENTS.ELEMENT_DISABLED;e.events.removeEventListener(t,ji),e.events.removeEventListener(n,zi)}();var e=f.cornerstone,t=e.EVENTS.ELEMENT_ENABLED,n=e.EVENTS.ELEMENT_DISABLED;e.events.addEventListener(t,ji),e.events.addEventListener(n,zi)}(),t=_.modules,Object.keys(t).forEach(function(e){"function"==typeof t[e].onRegisterCallback&&t[e].onRegisterCallback()}),Ji(),_.modules.globalConfiguration.state=Object.assign({},_.modules.globalConfiguration.state,e)};var $i,er="stackPrefetch",tr="prefetch",nr={maxImagesToPrefetch:1/0},ar=10;var or=function(e){return Math.max.apply(null,e)},ir=function(e){return Math.min.apply(null,e)};function rr(e){var t=Q(e,"stack");if(t&&t.data&&t.data.length){var n=t.data[0],a=Q(e,er);if(a){var o=a.data[0]||{};if(o.indicesToRequest&&o.indicesToRequest.length||(o.enabled=!1),!1!==o.enabled)if(a.data[0].indicesToRequest.sort(function(e,t){return e-t}),o.indicesToRequest.slice().forEach(function(e){var t=n.imageIds[e];t&&(f.cornerstone.imageCache.getImageLoadObject(t)&&b(e))}),o.indicesToRequest.length){_a.clearRequestStack(tr);for(var i,r,s,l,c,u,d=(i=o.indicesToRequest,r=n.currentImageIdIndex,s=[],l=[],i.forEach(function(e){e<r?s.push(e):e>r&&l.push(e)}),{low:i.indexOf(or(s)),high:i.indexOf(ir(l))}),h=Dn.getErrorLoadingHandler(),v=d.low,g=d.high;v>=0||g<o.indicesToRequest.length;){var m=n.currentImageIdIndex,p=m-o.indicesToRequest[v]>nr.maxImagesToPrefetch,y=o.indicesToRequest[g]-m>nr.maxImagesToPrefetch,x=!p&&v>=0,T=!y&&g<o.indicesToRequest.length;if(!T&&!x)break;x&&(u=o.indicesToRequest[v--],c=n.imageIds[u],_a.addRequest(e,c,tr,!1,E,M)),T&&(u=o.indicesToRequest[g++],c=n.imageIds[u],_a.addRequest(e,c,tr,!1,E,M))}_a.startGrabbing()}}}function b(e){var t=o.indicesToRequest.indexOf(e);t>-1&&o.indicesToRequest.splice(t,1)}function E(e){b(n.imageIds.indexOf(e.imageId))}function M(t){console.log("prefetch errored: ".concat(t)),h&&h(e,c,t,"stackPrefetch")}}function sr(e){return function(t){var n,a=t.detail;try{n=Q(e,"stack")}catch(e){return}if(n&&n.data&&n.data.length){var o=n.data[0].imageIds.indexOf(a.imageId);if(!(o<0)){var i=Q(e,er);i&&i.data&&i.data.length&&i.data[0].indicesToRequest.push(o)}}}}function lr(e){clearTimeout($i),$i=setTimeout(function(){var t=e.target;try{rr(t)}catch(e){return}},ar)}var cr={enable:function(e){Q(e,er).data=[];var t=Q(e,"stack");if(t&&t.data&&t.data.length){var n=t.data[0];if(!0!==n.preventCache){var a={indicesToRequest:function(e,t){e=Math.round(e)||0;var n=[],a=(t=Math.round(t)||0)-e+1;if(a<=0)return n;for(;a--;)n[a]=t--;return n}(0,n.imageIds.length-1),enabled:!0,direction:1},o=a.indicesToRequest.indexOf(n.currentImageIdIndex);a.indicesToRequest.splice(o,1),J(e,er,a),rr(e),e.removeEventListener(f.cornerstone.EVENTS.NEW_IMAGE,lr),e.addEventListener(f.cornerstone.EVENTS.NEW_IMAGE,lr);var i=sr(e);f.cornerstone.events.removeEventListener(f.cornerstone.EVENTS.IMAGE_CACHE_PROMISE_REMOVED,i),f.cornerstone.events.addEventListener(f.cornerstone.EVENTS.IMAGE_CACHE_PROMISE_REMOVED,i)}else console.warn("A stack that should not be cached was given the stackPrefetch")}},disable:function(e){clearTimeout($i),e.removeEventListener(f.cornerstone.EVENTS.NEW_IMAGE,lr);var t=sr(e);f.cornerstone.events.removeEventListener(f.cornerstone.EVENTS.IMAGE_CACHE_PROMISE_REMOVED,t);var n=Q(e,er);n&&n.data.length&&(n.data[0].enabled=!1,_a.clearRequestStack(tr))},getConfiguration:function(){return nr},setConfiguration:function(e){var t;nr=e,e.maxSimultaneousRequests&&(t=e.maxSimultaneousRequests,oa=t)}},ur=function(){function e(){o()(this,e),this.currentImageIdIndex=0,this.layerIds=[],this.findImageFn=void 0}return r()(e,[{key:"render",value:function(e,t){var n=this;if(!Number.isInteger(this.currentImageIdIndex))throw new Error("FusionRenderer: render - Image ID Index is not an integer");if(!this.findImageFn)throw new Error("No findImage function has been defined");t||(t=Q(e,"stack").data);var a=f.cornerstone,o=t[0],i=o.imageIds[this.currentImageIdIndex],r=t.slice(1,t.length);a.loadAndCacheImage(i).then(function(t){var s=n.layerIds[0];s?a.setLayerImage(e,t,s):(s=a.addLayer(e,t,o.options),n.layerIds.push(s)),a.displayImage(e,t),r.forEach(function(t,o){var r=n.findImageFn(t.imageIds,i),l=o+1,c=n.layerIds[l];c||(c=a.addLayer(e,void 0,t.options),n.layerIds.push(c)),r?a.loadAndCacheImage(r).then(function(t){a.setLayerImage(e,t,c),a.updateImage(e)}):(a.setLayerImage(e,void 0,c),a.setActiveLayer(e,s),a.updateImage(e))})})}}]),e}(),dr={};dr.FusionRenderer=ur;var hr=dr,vr="playClip";function gr(e){var t=e.intervalId;void 0!==t&&(e.intervalId=void 0,e.usingFrameTimeVector?clearTimeout(t):clearInterval(t))}function mr(e,t){var n,a;if(void 0===e)throw new Error("playClip: element must not be undefined");var o=Q(e,"stack");if(o&&o.data&&o.data.length){var i,r=f.cornerstone;if(o.data.length>1){var s=Q(e,"stackRenderer");s&&s.data&&s.data.length&&(i=s.data[0])}var l=o.data[0],c=Q(e,vr);c&&c.data&&c.data.length?gr(n=c.data[0]):J(e,vr,n={intervalId:void 0,framesPerSecond:30,lastFrameTimeStamp:void 0,frameRate:0,frameTimeVector:void 0,ignoreFrameTimeVector:!1,usingFrameTimeVector:!1,speed:1,reverse:!1,loop:!0}),(t<0||t>0)&&(n.framesPerSecond=Number(t),n.reverse=n.framesPerSecond<0,n.ignoreFrameTimeVector=!0),!0!==n.ignoreFrameTimeVector&&n.frameTimeVector&&n.frameTimeVector.length===l.imageIds.length&&(a=function(e,t){var n,a,o,i=0,r=e.length,s=[];for(s.isTimeVarying=!1,("number"!=typeof t||t<=0)&&(t=1),n=1;n<r;n++)o=Number(e[n])/t|0,s.push(o),1===n?a=o:o!==a&&(s.isTimeVarying=!0),i+=o;return s.length>0&&(o=s.isTimeVarying?i/s.length|0:s[0],s.push(o)),s}(n.frameTimeVector,n.speed));var u=function(){var t,a,s,c=l.currentImageIdIndex,u=l.imageIds.length;if(n.reverse?c--:c++,!n.loop&&(c<0||c>=u))return gr(n),void function(e){var t={element:e};T(e,x.CLIP_STOPPED,t)}(e);c>=u&&(c=0),c<0&&(c=u-1),c!==l.currentImageIdIndex&&(t=Dn.getStartLoadHandler(),a=Dn.getEndLoadHandler(),s=Dn.getErrorLoadingHandler(),t&&t(e),(!0===l.preventCache?r.loadImage(l.imageIds[c]):r.loadAndCacheImage(l.imageIds[c])).then(function(t){try{l.currentImageIdIndex=c,i?(i.currentImageIdIndex=c,i.render(e,o.data)):r.displayImage(e,t),a&&a(e,t)}catch(e){return}},function(t){var n=l.imageIds[c];s&&s(e,n,t)}))};a&&a.length>0&&a.isTimeVarying?(n.usingFrameTimeVector=!0,n.intervalId=setTimeout(function e(){n.intervalId=setTimeout(e,a[l.currentImageIdIndex]),u()},0)):(n.usingFrameTimeVector=!1,n.intervalId=setInterval(u,1e3/Math.abs(n.framesPerSecond)))}}function fr(e){var t=Q(e,vr);t&&t.data&&t.data.length&&gr(t.data[0])}var pr=function(e,t){var n=_.state.tools.findIndex(function(n){return n.element===e&&n.name===t});n>=0&&_.state.tools.splice(n,1)},yr=function(e){xr(e),_.state.enabledElements.forEach(function(t){pr(t,e)})},xr=function(e){_.modules.globalConfiguration.state.globalToolSyncEnabled&&_.state.globalTools[e]&&delete _.state.globalTools[e]},Tr=function(e,t,n){var a=O(e,t);a&&a.mergeOptions(n)},br=function(e,t){k.enabledElements.forEach(function(e){Tr(e,t)})};function Er(e,t){var n={};return{get:function(a,o){return e.indexOf(o)>=0?(!1===n.hasOwnProperty(o)&&(n[o]={data:[]}),n[o]):t.get(a,o)},add:function(a,o,i){if(!(e.indexOf(o)>=0))return t.add(a,o,i);!1===n.hasOwnProperty(o)&&(n[o]={data:[]}),n[o].data.push(i)},saveToolState:function(){return n},restoreToolState:function(e){n=e},toolState:n}}var Mr=[];function Cr(e,t){var n=Z(e);n||(n=X);var a=["stack","stackPrefetch","playClip","volume","slab","referenceLines","crosshairs","stackRenderer"];t&&(a=a.concat(t));var o=Er(a,n);Mr.push(o),te(e,o)}var wr={newStackSpecificToolStateManager:Er,addStackStateManager:Cr};function Ir(){var e={};return{get:function(t,n){if(!1!==e.hasOwnProperty(t)){var a=e[t];if(!1!==a.hasOwnProperty(n))return a[n]}},add:function(t,n,a){!1===e.hasOwnProperty(t)&&(e[t]={});var o=e[t];!1===o.hasOwnProperty(n)&&(o[n]={data:[]}),o[n].data.push(a)},remove:function(t,n,a){if(!1!==e.hasOwnProperty(t)){var o=e[t];if(!1!==o.hasOwnProperty(n)){for(var i=o[n],r=-1,s=0;s<i.data.length;s++)i.data[s]===a&&(r=s);-1!==r&&i.data.splice(r,1)}}}}}var kr=Ir(),Pr={getOrientationString:function(e){for(var t=Ln(e),n="",a=t.x<0?"R":"L",o=t.y<0?"A":"P",i=t.z<0?"F":"H",r=new f.cornerstoneMath.Vector3(Math.abs(t.x),Math.abs(t.y),Math.abs(t.z)),s=0;s<3;s++)if(r.x>1e-4&&r.x>r.y&&r.x>r.z)n+=a,r.x=0;else if(r.y>1e-4&&r.y>r.x&&r.y>r.z)n+=o,r.y=0;else{if(!(r.z>1e-4&&r.z>r.x&&r.z>r.y))break;n+=i,r.z=0}return n},invertOrientationString:function(e){var t=e.replace("H","f");return t=(t=(t=(t=(t=(t=t.replace("F","h")).replace("R","l")).replace("L","r")).replace("A","p")).replace("P","a")).toUpperCase()}},Sr=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]?arguments[2]:"image/png",a=e.querySelector("canvas");if(a.msToBlob){var o=a.msToBlob();return window.navigator.msSaveBlob(o,t)}var i=document.createElement("a");if(i.download=t,i.href=a.toDataURL(n,1),document.createEvent){var r=document.createEvent("MouseEvents");r.initMouseEvent("click",!0,!0,window,0,0,0,0,0,!1,!1,!1,!1,0,null),i.dispatchEvent(r)}else i.fireEvent&&i.fireEvent("onclick")},_r={48:"0",49:"1",50:"2",51:"3",52:"4",53:"5",54:"6",55:"7",56:"8",57:"9",96:"0",97:"1",98:"2",99:"3",100:"4",101:"5",102:"6",103:"7",104:"8",105:"9",65:"a",66:"b",67:"c",68:"d",69:"e",70:"f",71:"g",72:"h",73:"i",74:"j",75:"k",76:"l",77:"m",78:"n",79:"o",80:"p",81:"q",82:"r",83:"s",84:"t",85:"u",86:"v",87:"w",88:"x",89:"y",90:"z",112:"F1",113:"F2",114:"F3",115:"F4",116:"F5",13:"RETURN",8:"BACKSPACE",9:"TAB",46:"DELETE",12:"DELETE",27:"ESCAPE",20:"CAPSLOCK",173:"-",189:"-",109:"-",61:"+",187:"+",107:"+",219:"[",221:"]",59:";",186:";",188:",",190:".",199:"/"},Or={"base/BaseTool":Y,"base/BaseAnnotationTool":Me,"base/BaseBrushTool":Mn,"manipulators/anyHandlesOutsideImage":re,"manipulators/getHandleNearImagePoint":oe,"manipulators/handleActivator":ie,"manipulators/moveAllHandles":de,"manipulators/moveHandle":me,"manipulators/moveNewHandle":ye,"manipulators/moveHandleNearImagePoint":Te,"manipulators/findHandleDataNearImagePoint":be,"manipulators/moveAnnotation":Ee,"mixins/activeOrDisabledBinaryTool":q.activeOrDisabledBinaryTool,"mixins/enabledOrDisabledBinaryTool":q.enabledOrDisabledBinaryTool,"drawing/getNewContext":Je,"drawing/draw":Oe,"drawing/path":De,"drawing/setShadow":$e,"drawing/drawLine":Le,"drawing/drawLines":function(e,t,n,a){var o=arguments.length>4&&void 0!==arguments[4]?arguments[4]:"pixel";De(e,a,function(e){n.forEach(function(n){var a=n.start,i=n.end;if("pixel"===o){var r=f.cornerstone;a=r.pixelToCanvas(t,a),i=r.pixelToCanvas(t,i)}e.moveTo(a.x,a.y),e.lineTo(i.x,i.y)})})},"drawing/drawJoinedLines":Ae,"drawing/drawCircle":Ue,"drawing/drawEllipse":Ne,"drawing/drawRect":Ze,"drawing/fillOutsideRect":function(e,t,n,a,o){if("pixel"===(arguments.length>5&&void 0!==arguments[5]?arguments[5]:"pixel")){var i=f.cornerstone;n=i.pixelToCanvas(t,n),a=i.pixelToCanvas(t,a)}var r=Math.min(n.x,a.x),s=Math.min(n.y,a.y),l=Math.abs(n.x-a.x),c=Math.abs(n.y-a.y);De(e,o,function(e){e.rect(0,0,e.canvas.clientWidth,e.canvas.clientHeight),e.rect(r+l,s,-l,c)})},"drawing/drawTextBox":Ke,"drawing/drawArrow":He,"drawing/fillBox":qe,"drawing/fillTextLines":Ge,"drawing/drawLink":Fe,"drawing/drawLinkedTextBox":Xe,"drawing/drawHandles":Be,"drawing/textBoxWidth":Ye,"util/getLuminance":Na,"util/copyPoints":no,"util/calculateSUV":Ht,"util/setContextToDisplayFontSize":function(e,t,n){return f.cornerstone.setToPixelCoordinateSystem(e,t,.1),{fontSize:n/e.viewport.scale/.1,lineHeight:n/e.viewport.scale/.1,fontScale:.1}},"util/scrollToIndex":Oa,"util/scroll":Da,"util/roundToDecimal":tt,"util/projectPatientPointToImagePlane":An,"util/imagePointToPatientPoint":Hn,"util/planePlaneIntersection":Un,"util/pointInsideBoundingBox":ne,"util/makeUnselectable":function(e,t){e.style.webkitUserSelect="none",e.style.webkitTouchCallout="none",e.style.mozUserSelect="none",e.style.msUserSelect="none",e.style.oUserSelect="none",e.style.khtmlUserSelect="none",e.style.userSelect="none",e.unselectable="on",e.oncontextmenu=function(){return!1},!0===t&&(e.style.pointerEvents="none")},"util/getRGBPixels":gn,"util/getDefaultSimultaneousRequests":xa,"util/getMaxSimultaneousRequests":ya,"util/getBrowserInfo":pa,"util/isMobileDevice":function(){return new RegExp("Android|webOS|iPhone|iPad|iPod|BlackBerry|IEMobile|Opera Mini").test(navigator.userAgent)},"util/angleBetweenPoints":ra,"util/getKeyFromKeyCode":function(e){return _r[e]},"util/numbersWithCommas":Nt,"util/lineSegDistance":et,"util/triggerEvent":T,"util/convertToVectro3":Ln,"util/ellipseUtils":Bt,"util/freehandUtils":on,"util/brushUtils":kn,"util/zoomUtils":za},Dr=function(e){return Or[e]},Lr=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(function(e){return Object.keys(S).some(function(t){return t===e})}(e)){if(console.warn("A module with the name ".concat(e," is already registered")),!n)return;console.warn("Overwriting module ".concat(e))}S[e]=t};var Ar=function(e,t){var n=arguments.length>2&&void 0!==arguments[2]&&arguments[2];if(function(e){return void 0!==q[e]}(e)){if(console.warn("mixins/".concat(e," is already registered")),!n)return;console.warn("Overwriting mixins/".concat(e))}q[e]=t,Or["mixins/".concat(e)]=q[e]};var Hr=function(e,t,n){var a=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(function(e,t){return void 0!==Or["".concat(e,"/").concat(t)]}(e,t)){if(console.warn("".concat(e,"/").concat(t," is already registered")),!a)return;console.warn("Overwriting ".concat(e,"/").concat(t))}Or["".concat(e,"/").concat(t)]=n};var Ur=function(e,t,n){var a=arguments.length>3&&void 0!==arguments[3]&&arguments[3];if(function(e,t,n){if(!e)return console.warn("The type must be given in order to register."),!1;if(!t)return console.warn("The ".concat(e," must have a name in order to register.")),!1;if("object"!==y()(n)&&"function"!=typeof n)return console.warn("The ".concat(n," is a ").concat(y()(n),", it should be an Object or a function.")),!1;return!0}(e,t,n))switch(e){case"module":Lr(t,n,a);break;case"mixin":Ar(t,n,a);break;default:Hr(e,t,n,a),console.warn("unrecognised type ".concat(e,", not registering ").concat(t))}};var Nr=function(e){for(var t=arguments.length>1&&void 0!==arguments[1]&&arguments[1],n=0;n<e.length;n++){var a=e[n],o=a.type,i=a.name,r=a.item;Ur(o,i,r,t)}},Rr=function(e,t,n){if(n!==t){var a=f.cornerstone,o=a.getViewport(t),i=a.getViewport(n);i.voi.windowWidth===o.voi.windowWidth&&i.voi.windowCenter===o.voi.windowCenter&&i.invert===o.invert||(i.voi.windowWidth=o.voi.windowWidth,i.voi.windowCenter=o.voi.windowCenter,i.invert=o.invert,e.setViewport(n,i))}},Br=function(e,t,n){n!==t&&f.cornerstone.updateImage(n)};function Fr(e){return e.filter(function(e,t,n){return n.indexOf(e)===t})}var Vr=function(e,t){var n=f.cornerstone,a=this,o=[],i=[],r=!1,s={},l=t;function c(e,t){var n=!a.enabled,c=!o.length||!i.length;n||c||(r=!0,i.forEach(function(n){var r=i.indexOf(n);if(-1!==r){var c=s.imageIds.targetElements[r],u=o.indexOf(e);if(-1!==u){var d,h=s.imageIds.sourceElements[u];h===c?d=0:void 0!==s.distances[h]&&(d=s.distances[h][c]),l(a,e,n,t,d)}}}),r=!1)}function u(e){var t=e.detail;!0!==r&&c(e.currentTarget,t)}function d(e){var t=e.detail.element;a.remove(t),function(e){for(var t in Nn)Nn[t]=Nn[t].filter(function(t){return t.element!==e})}(t)}this.enabled=!0,this.setHandler=function(e){l=e},this.getHandler=function(){return l},this.getDistances=function(){o.length&&i.length&&(s.distances={},s.imageIds={sourceElements:[],targetElements:[]},o.forEach(function(e){var t=n.getEnabledElement(e);if(t&&t.image){var a=t.image.imageId,o=n.metaData.get("imagePlaneModule",a);if(o&&o.imagePositionPatient){var r=Ln(o.imagePositionPatient);s.hasOwnProperty(t)||(s.distances[a]={},s.imageIds.sourceElements.push(a),i.forEach(function(t){var o=n.getEnabledElement(t);if(o&&o.image){var i=o.image.imageId;if(s.imageIds.targetElements.push(i),e!==t&&a!==i&&!s.distances[a].hasOwnProperty(i)){var l=n.metaData.get("imagePlaneModule",i);if(l&&l.imagePositionPatient){var c=Ln(l.imagePositionPatient);s.distances[a][i]=c.clone().sub(r)}}}}),Object.keys(s.distances[a]).length||delete s.distances[a])}}}))},this.addSource=function(t){-1===o.indexOf(t)&&(o.push(t),e.split(" ").forEach(function(e){t.addEventListener(e,u)}),a.getDistances(),a.updateDisableHandlers())},this.addTarget=function(e){-1===i.indexOf(e)&&(i.push(e),a.getDistances(),l(a,e,e,0),a.updateDisableHandlers())},this.add=function(e){a.addSource(e),a.addTarget(e)},this.removeSource=function(t){var n=o.indexOf(t);-1!==n&&(o.splice(n,1),e.split(" ").forEach(function(e){t.removeEventListener(e,u)}),a.getDistances(),c(t),a.updateDisableHandlers())},this.removeTarget=function(e){var t=i.indexOf(e);-1!==t&&(i.splice(t,1),a.getDistances(),l(a,e,e,0),a.updateDisableHandlers())},this.remove=function(e){a.removeTarget(e),a.removeSource(e)},this.getSourceElements=function(){return o},this.getTargetElements=function(){return i},this.displayImage=function(e,t,a){r=!0,n.displayImage(e,t,a),r=!1},this.setViewport=function(e,t){r=!0,n.setViewport(e,t),r=!1},this.updateDisableHandlers=function(){Fr(o.concat(i)).forEach(function(e){e.removeEventListener(f.cornerstone.EVENTS.ELEMENT_DISABLED,d),e.addEventListener(f.cornerstone.EVENTS.ELEMENT_DISABLED,d)})},this.destroy=function(){Fr(o.concat(i)).forEach(function(e){a.remove(e)})}},jr=function(e,t,n,a){if(t!==n&&a&&a.direction){var o=f.cornerstone,i=Q(n,"stack").data[0],r=i.currentImageIdIndex+a.direction;if(r=se(r,0,i.imageIds.length-1),i.currentImageIdIndex!==r){var s=Dn.getStartLoadHandler(),l=Dn.getEndLoadHandler(),c=Dn.getErrorLoadingHandler();i.currentImageIdIndex=r;var u=i.imageIds[r];s&&s(n),(!0===i.preventCache?o.loadImage(u):o.loadAndCacheImage(u)).then(function(t){var a=o.getViewport(n);i.currentImageIdIndex===r&&(e.displayImage(n,t,a),l&&l(n,t))},function(e){var t=i.imageIds[r];c&&c(n,t,e)})}}},Wr=function(e,t,n){if(n!==t){var a=f.cornerstone,o=Q(t,"stack").data[0],i=o.imageIds[o.currentImageIdIndex],r=a.metaData.get("imagePlaneModule",i);if(void 0!==r&&void 0!==r.imagePositionPatient){var s=Ln(r.imagePositionPatient),l=Q(n,"stack").data[0],c=Number.MAX_VALUE,u=-1;if(l.imageIds.forEach(function(e,t){var n=a.metaData.get("imagePlaneModule",e);if(void 0!==n&&void 0!==n.imagePositionPatient){var o=Ln(n.imagePositionPatient).distanceToSquared(s);o<c&&(c=o,u=t)}}),u!==l.currentImageIdIndex){var d=Dn.getStartLoadHandler(),h=Dn.getEndLoadHandler(),v=Dn.getErrorLoadingHandler();l.currentImageIdIndex=u;var g=l.imageIds[u];if(d&&d(n),-1!==u)(!0===l.preventCache?a.loadImage(g):a.loadAndCacheImage(g)).then(function(t){var o=a.getViewport(n);l.currentImageIdIndex===u&&(e.displayImage(n,t,o),h&&h(n,t))},function(e){var t=l.imageIds[u];v&&v(n,t,e)})}}}},zr=function(e,t,n,a,o){if(n!==t){var i=f.cornerstone,r=Q(t,"stack").data[0],s=r.imageIds[r.currentImageIdIndex],l=i.metaData.get("imagePlaneModule",s);if(void 0!==l&&void 0!==l.imagePositionPatient){var c=Ln(l.imagePositionPatient),u=Q(n,"stack").data[0],d=Number.MAX_VALUE,h=-1;if(o){var v=c.clone().add(o);if(u.imageIds.forEach(function(e,t){var n=i.metaData.get("imagePlaneModule",e);if(void 0!==n&&void 0!==n.imagePositionPatient){var a=Ln(n.imagePositionPatient),o=v.distanceToSquared(a);o<d&&(d=o,h=t)}}),h!==u.currentImageIdIndex&&-1!==h){var g=Dn.getStartLoadHandler(),m=Dn.getEndLoadHandler(),p=Dn.getErrorLoadingHandler();u.currentImageIdIndex=h;var y=u.imageIds[h];g&&g(n),(!0===u.preventCache?i.loadImage(y):i.loadAndCacheImage(y)).then(function(t){var a=i.getViewport(n);u.currentImageIdIndex===h&&(e.displayImage(n,t,a),m&&m(n,t))},function(e){var t=u.imageIds[h];p&&p(n,t,e)})}}}}},Gr=function(e,t,n){if(n!==t){var a=f.cornerstone,o=Q(t,"stack").data[0],i=Q(n,"stack").data[0],r=o.currentImageIdIndex;if((r=se(r,0,i.imageIds.length-1))!==i.currentImageIdIndex){var s=Dn.getStartLoadHandler(),l=Dn.getEndLoadHandler(),c=Dn.getErrorLoadingHandler();s&&s(n),(!0===i.preventCache?a.loadImage(i.imageIds[r]):a.loadAndCacheImage(i.imageIds[r])).then(function(t){var o=a.getViewport(n);i.currentImageIdIndex=r,e.displayImage(n,t,o),l&&l(n,t)},function(e){var t=i.imageIds[r];c&&c(n,t,e)})}}},qr=function(e,t,n){if(n!==t){var a=f.cornerstone,o=a.getViewport(t),i=a.getViewport(n);i.scale===o.scale&&i.translation.x===o.translation.x&&i.translation.y===o.translation.y||(i.scale=o.scale,i.translation.x=o.translation.x,i.translation.y=o.translation.y,e.setViewport(n,i))}};n.d(t,"AngleTool",function(){return at}),n.d(t,"ArrowAnnotateTool",function(){return ot}),n.d(t,"BidirectionalTool",function(){return Lt}),n.d(t,"CobbAngleTool",function(){return At}),n.d(t,"EllipticalRoiTool",function(){return jt}),n.d(t,"FreehandMouseTool",function(){return dn}),n.d(t,"LengthTool",function(){return vn}),n.d(t,"ProbeTool",function(){return mn}),n.d(t,"RectangleRoiTool",function(){return fn}),n.d(t,"TextMarkerTool",function(){return yn}),n.d(t,"BrushTool",function(){return On}),n.d(t,"CrosshairsTool",function(){return Fn}),n.d(t,"DoubleTapFitToWindowTool",function(){return Vn}),n.d(t,"DragProbeTool",function(){return jn}),n.d(t,"EraserTool",function(){return Gn}),n.d(t,"FreehandSculpterMouseTool",function(){return Yn}),n.d(t,"MagnifyTool",function(){return Kn}),n.d(t,"PanMultiTouchTool",function(){return Xn}),n.d(t,"PanTool",function(){return Zn}),n.d(t,"ReferenceLinesTool",function(){return ia}),n.d(t,"RotateTool",function(){return sa}),n.d(t,"RotateTouchTool",function(){return da}),n.d(t,"ScaleOverlayTool",function(){return ha}),n.d(t,"StackScrollMouseWheelTool",function(){return Aa}),n.d(t,"StackScrollMultiTouchTool",function(){return Ha}),n.d(t,"StackScrollTool",function(){return Ua}),n.d(t,"WwwcRegionTool",function(){return Ra}),n.d(t,"WwwcTool",function(){return ja}),n.d(t,"ZoomMouseWheelTool",function(){return qa}),n.d(t,"ZoomTool",function(){return Xa}),n.d(t,"ZoomTouchPinchTool",function(){return to}),n.d(t,"init",function(){return Qi}),n.d(t,"stackPrefetch",function(){return cr}),n.d(t,"stackRenderers",function(){return hr}),n.d(t,"playClip",function(){return mr}),n.d(t,"stopClip",function(){return fr}),n.d(t,"store",function(){return _}),n.d(t,"getToolForElement",function(){return O}),n.d(t,"addTool",function(){return Fi}),n.d(t,"addToolForElement",function(){return Bi}),n.d(t,"removeTool",function(){return yr}),n.d(t,"removeToolForElement",function(){return pr}),n.d(t,"setToolOptions",function(){return br}),n.d(t,"setToolOptionsForElement",function(){return Tr}),n.d(t,"setToolActive",function(){return L}),n.d(t,"setToolActiveForElement",function(){return D}),n.d(t,"setToolEnabled",function(){return N}),n.d(t,"setToolEnabledForElement",function(){return U}),n.d(t,"setToolDisabled",function(){return H}),n.d(t,"setToolDisabledForElement",function(){return A}),n.d(t,"setToolPassive",function(){return B}),n.d(t,"setToolPassiveForElement",function(){return R}),n.d(t,"addToolState",function(){return J}),n.d(t,"getToolState",function(){return Q}),n.d(t,"removeToolState",function(){return $}),n.d(t,"clearToolState",function(){return ee}),n.d(t,"setElementToolStateManager",function(){return te}),n.d(t,"getElementToolStateManager",function(){return Z}),n.d(t,"textStyle",function(){return ze}),n.d(t,"toolStyle",function(){return Ie}),n.d(t,"toolColors",function(){return _e}),n.d(t,"toolCoordinates",function(){return yt}),n.d(t,"stackSpecificStateManager",function(){return wr}),n.d(t,"newStackSpecificToolStateManager",function(){return Er}),n.d(t,"addStackStateManager",function(){return Cr}),n.d(t,"loadHandlerManager",function(){return Dn}),n.d(t,"newImageIdSpecificToolStateManager",function(){return K}),n.d(t,"globalImageIdSpecificToolStateManager",function(){return X}),n.d(t,"newFrameOfReferenceSpecificToolStateManager",function(){return Ir}),n.d(t,"globalFrameOfReferenceSpecificToolStateManager",function(){return kr}),n.d(t,"forceEnabledElementResize",function(){return Zi}),n.d(t,"orientation",function(){return Pr}),n.d(t,"SaveAs",function(){return Sr}),n.d(t,"import",function(){return Dr}),n.d(t,"register",function(){return Ur}),n.d(t,"registerSome",function(){return Nr}),n.d(t,"wwwcSynchronizer",function(){return Rr}),n.d(t,"updateImageSynchronizer",function(){return Br}),n.d(t,"Synchronizer",function(){return Vr}),n.d(t,"stackScrollSynchronizer",function(){return jr}),n.d(t,"stackImagePositionSynchronizer",function(){return Wr}),n.d(t,"stackImagePositionOffsetSynchronizer",function(){return zr}),n.d(t,"stackImageIndexSynchronizer",function(){return Gr}),n.d(t,"panZoomSynchronizer",function(){return qr}),n.d(t,"requestPoolManager",function(){return _a}),n.d(t,"external",function(){return f}),n.d(t,"EVENTS",function(){return x}),n.d(t,"version",function(){return"3.0.0-b.0"})},function(e,t){!function(t){"use strict";var n,a=Object.prototype,o=a.hasOwnProperty,i="function"==typeof Symbol?Symbol:{},r=i.iterator||"@@iterator",s=i.asyncIterator||"@@asyncIterator",l=i.toStringTag||"@@toStringTag",c="object"==typeof e,u=t.regeneratorRuntime;if(u)c&&(e.exports=u);else{(u=t.regeneratorRuntime=c?e.exports:{}).wrap=T;var d="suspendedStart",h="suspendedYield",v="executing",g="completed",m={},f={};f[r]=function(){return this};var p=Object.getPrototypeOf,y=p&&p(p(O([])));y&&y!==a&&o.call(y,r)&&(f=y);var x=C.prototype=E.prototype=Object.create(f);M.prototype=x.constructor=C,C.constructor=M,C[l]=M.displayName="GeneratorFunction",u.isGeneratorFunction=function(e){var t="function"==typeof e&&e.constructor;return!!t&&(t===M||"GeneratorFunction"===(t.displayName||t.name))},u.mark=function(e){return Object.setPrototypeOf?Object.setPrototypeOf(e,C):(e.__proto__=C,l in e||(e[l]="GeneratorFunction")),e.prototype=Object.create(x),e},u.awrap=function(e){return{__await:e}},w(I.prototype),I.prototype[s]=function(){return this},u.AsyncIterator=I,u.async=function(e,t,n,a){var o=new I(T(e,t,n,a));return u.isGeneratorFunction(t)?o:o.next().then(function(e){return e.done?e.value:o.next()})},w(x),x[l]="Generator",x[r]=function(){return this},x.toString=function(){return"[object Generator]"},u.keys=function(e){var t=[];for(var n in e)t.push(n);return t.reverse(),function n(){for(;t.length;){var a=t.pop();if(a in e)return n.value=a,n.done=!1,n}return n.done=!0,n}},u.values=O,_.prototype={constructor:_,reset:function(e){if(this.prev=0,this.next=0,this.sent=this._sent=n,this.done=!1,this.delegate=null,this.method="next",this.arg=n,this.tryEntries.forEach(S),!e)for(var t in this)"t"===t.charAt(0)&&o.call(this,t)&&!isNaN(+t.slice(1))&&(this[t]=n)},stop:function(){this.done=!0;var e=this.tryEntries[0].completion;if("throw"===e.type)throw e.arg;return this.rval},dispatchException:function(e){if(this.done)throw e;var t=this;function a(a,o){return s.type="throw",s.arg=e,t.next=a,o&&(t.method="next",t.arg=n),!!o}for(var i=this.tryEntries.length-1;i>=0;--i){var r=this.tryEntries[i],s=r.completion;if("root"===r.tryLoc)return a("end");if(r.tryLoc<=this.prev){var l=o.call(r,"catchLoc"),c=o.call(r,"finallyLoc");if(l&&c){if(this.prev<r.catchLoc)return a(r.catchLoc,!0);if(this.prev<r.finallyLoc)return a(r.finallyLoc)}else if(l){if(this.prev<r.catchLoc)return a(r.catchLoc,!0)}else{if(!c)throw new Error("try statement without catch or finally");if(this.prev<r.finallyLoc)return a(r.finallyLoc)}}}},abrupt:function(e,t){for(var n=this.tryEntries.length-1;n>=0;--n){var a=this.tryEntries[n];if(a.tryLoc<=this.prev&&o.call(a,"finallyLoc")&&this.prev<a.finallyLoc){var i=a;break}}i&&("break"===e||"continue"===e)&&i.tryLoc<=t&&t<=i.finallyLoc&&(i=null);var r=i?i.completion:{};return r.type=e,r.arg=t,i?(this.method="next",this.next=i.finallyLoc,m):this.complete(r)},complete:function(e,t){if("throw"===e.type)throw e.arg;return"break"===e.type||"continue"===e.type?this.next=e.arg:"return"===e.type?(this.rval=this.arg=e.arg,this.method="return",this.next="end"):"normal"===e.type&&t&&(this.next=t),m},finish:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.finallyLoc===e)return this.complete(n.completion,n.afterLoc),S(n),m}},catch:function(e){for(var t=this.tryEntries.length-1;t>=0;--t){var n=this.tryEntries[t];if(n.tryLoc===e){var a=n.completion;if("throw"===a.type){var o=a.arg;S(n)}return o}}throw new Error("illegal catch attempt")},delegateYield:function(e,t,a){return this.delegate={iterator:O(e),resultName:t,nextLoc:a},"next"===this.method&&(this.arg=n),m}}}function T(e,t,n,a){var o=t&&t.prototype instanceof E?t:E,i=Object.create(o.prototype),r=new _(a||[]);return i._invoke=function(e,t,n){var a=d;return function(o,i){if(a===v)throw new Error("Generator is already running");if(a===g){if("throw"===o)throw i;return D()}for(n.method=o,n.arg=i;;){var r=n.delegate;if(r){var s=k(r,n);if(s){if(s===m)continue;return s}}if("next"===n.method)n.sent=n._sent=n.arg;else if("throw"===n.method){if(a===d)throw a=g,n.arg;n.dispatchException(n.arg)}else"return"===n.method&&n.abrupt("return",n.arg);a=v;var l=b(e,t,n);if("normal"===l.type){if(a=n.done?g:h,l.arg===m)continue;return{value:l.arg,done:n.done}}"throw"===l.type&&(a=g,n.method="throw",n.arg=l.arg)}}}(e,n,r),i}function b(e,t,n){try{return{type:"normal",arg:e.call(t,n)}}catch(e){return{type:"throw",arg:e}}}function E(){}function M(){}function C(){}function w(e){["next","throw","return"].forEach(function(t){e[t]=function(e){return this._invoke(t,e)}})}function I(e){var t;this._invoke=function(n,a){function i(){return new Promise(function(t,i){!function t(n,a,i,r){var s=b(e[n],e,a);if("throw"!==s.type){var l=s.arg,c=l.value;return c&&"object"==typeof c&&o.call(c,"__await")?Promise.resolve(c.__await).then(function(e){t("next",e,i,r)},function(e){t("throw",e,i,r)}):Promise.resolve(c).then(function(e){l.value=e,i(l)},function(e){return t("throw",e,i,r)})}r(s.arg)}(n,a,t,i)})}return t=t?t.then(i,i):i()}}function k(e,t){var a=e.iterator[t.method];if(a===n){if(t.delegate=null,"throw"===t.method){if(e.iterator.return&&(t.method="return",t.arg=n,k(e,t),"throw"===t.method))return m;t.method="throw",t.arg=new TypeError("The iterator does not provide a 'throw' method")}return m}var o=b(a,e.iterator,t.arg);if("throw"===o.type)return t.method="throw",t.arg=o.arg,t.delegate=null,m;var i=o.arg;return i?i.done?(t[e.resultName]=i.value,t.next=e.nextLoc,"return"!==t.method&&(t.method="next",t.arg=n),t.delegate=null,m):i:(t.method="throw",t.arg=new TypeError("iterator result is not an object"),t.delegate=null,m)}function P(e){var t={tryLoc:e[0]};1 in e&&(t.catchLoc=e[1]),2 in e&&(t.finallyLoc=e[2],t.afterLoc=e[3]),this.tryEntries.push(t)}function S(e){var t=e.completion||{};t.type="normal",delete t.arg,e.completion=t}function _(e){this.tryEntries=[{tryLoc:"root"}],e.forEach(P,this),this.reset(!0)}function O(e){if(e){var t=e[r];if(t)return t.call(e);if("function"==typeof e.next)return e;if(!isNaN(e.length)){var a=-1,i=function t(){for(;++a<e.length;)if(o.call(e,a))return t.value=e[a],t.done=!1,t;return t.value=n,t.done=!0,t};return i.next=i}}return{next:D}}function D(){return{value:n,done:!0}}}(function(){return this||"object"==typeof self&&self}()||Function("return this")())},function(e,t,n){var a=function(){return this||"object"==typeof self&&self}()||Function("return this")(),o=a.regeneratorRuntime&&Object.getOwnPropertyNames(a).indexOf("regeneratorRuntime")>=0,i=o&&a.regeneratorRuntime;if(a.regeneratorRuntime=void 0,e.exports=n(11),o)a.regeneratorRuntime=i;else try{delete a.regeneratorRuntime}catch(e){a.regeneratorRuntime=void 0}},function(e,t){e.exports=function(){throw new TypeError("Invalid attempt to spread non-iterable instance")}},function(e,t){e.exports=function(e){if(Symbol.iterator in Object(e)||"[object Arguments]"===Object.prototype.toString.call(e))return Array.from(e)}},function(e,t){e.exports=function(e){if(Array.isArray(e)){for(var t=0,n=new Array(e.length);t<e.length;t++)n[t]=e[t];return n}}},function(e,t){function n(t,a){return e.exports=n=Object.setPrototypeOf||function(e,t){return e.__proto__=t,e},n(t,a)}e.exports=n}])});
//# sourceMappingURL=cornerstoneTools.min.js.map